/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * @copyright Famous Industries, Inc. 2014
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof global?i=global:"undefined"!=typeof self&&(i=self),i.famous=t()}}(function(){return function t(i,e,n){function s(r,a){if(!e[r]){if(!i[r]){var h="function"==typeof require&&require;if(!a&&h)return h(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+r+"'")}var c=e[r]={exports:{}};i[r][0].call(c.exports,function(t){var e=i[r][1][t];return s(e?e:t)},c,c.exports,t,i,e,n)}return e[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(t,i){function e(t){return[t.clientWidth,t.clientHeight]}function n(t){this.container=t,this._allocator=new r(t),this._node=new s,this._eventOutput=new o,this._size=e(this.container),this._perspectiveState=new h(0),this._perspective=void 0,this._nodeContext={allocator:this._allocator,transform:a.identity,opacity:1,origin:c,align:null,size:this._size},this._eventOutput.on("resize",function(){this.setSize(e(this.container))}.bind(this))}var s=t("./RenderNode"),o=t("./EventHandler"),r=t("./ElementAllocator"),a=t("./Transform"),h=t("../transitions/Transitionable"),c=[0,0];n.prototype.getAllocator=function(){return this._allocator},n.prototype.add=function(t){return this._node.add(t)},n.prototype.migrate=function(t){t!==this.container&&(this.container=t,this._allocator.migrate(t))},n.prototype.getSize=function(){return this._size},n.prototype.setSize=function(t){t||(t=e(this.container)),this._size[0]=t[0],this._size[1]=t[1]},n.prototype.update=function(t){t&&(t.transform&&(this._nodeContext.transform=t.transform),t.opacity&&(this._nodeContext.opacity=t.opacity),t.origin&&(this._nodeContext.origin=t.origin),t.align&&(this._nodeContext.align=t.align),t.size&&(this._nodeContext.size=t.size));var i=this._perspectiveState.get();i!==this._perspective&&(this.container.style.perspective=i?i.toFixed()+"px":"",this.container.style.webkitPerspective=i?i.toFixed():"",this._perspective=i),this._node.commit(this._nodeContext)},n.prototype.getPerspective=function(){return this._perspectiveState.get()},n.prototype.setPerspective=function(t,i,e){return this._perspectiveState.set(t,i,e)},n.prototype.emit=function(t,i){return this._eventOutput.emit(t,i)},n.prototype.on=function(t,i){return this._eventOutput.on(t,i)},n.prototype.removeListener=function(t,i){return this._eventOutput.removeListener(t,i)},n.prototype.pipe=function(t){return this._eventOutput.pipe(t)},n.prototype.unpipe=function(t){return this._eventOutput.unpipe(t)},i.exports=n},{"../transitions/Transitionable":87,"./ElementAllocator":2,"./EventHandler":6,"./RenderNode":10,"./Transform":14}],2:[function(t,i){function e(t){t||(t=document.createDocumentFragment()),this.container=t,this.detachedNodes={},this.nodeCount=0}e.prototype.migrate=function(t){var i=this.container;if(t!==i){if(i instanceof DocumentFragment)t.appendChild(i);else for(;i.hasChildNodes();)t.appendChild(i.removeChild(i.firstChild));this.container=t}},e.prototype.allocate=function(t){t=t.toLowerCase(),t in this.detachedNodes||(this.detachedNodes[t]=[]);var i,e=this.detachedNodes[t];return e.length>0?i=e.pop():(i=document.createElement(t),this.container.appendChild(i)),this.nodeCount++,i},e.prototype.deallocate=function(t){var i=t.nodeName.toLowerCase(),e=this.detachedNodes[i];e.push(t),this.nodeCount--},e.prototype.getNodeCount=function(){return this.nodeCount},i.exports=e},{}],3:[function(t,i){function e(){g.runLoop?(c.step(),window.requestAnimationFrame(e)):d=!1}function n(){for(var t=0;t<p.length;t++)p[t].emit("resize");_.emit("resize")}var s,o,r=t("./Context"),a=t("./EventHandler"),h=t("./OptionsManager"),c={},p=[],u=[],l=[],f=Date.now(),d=!0,y={},_=new a,g={containerType:"div",containerClass:"famous-container",fpsCap:void 0,runLoop:!0},v=new h(g),m=10;c.step=function(){var t=Date.now();if(!(o&&o>t-f)){var i=0;for(s=t-f,f=t,_.emit("prerender"),i=0;i<u.length;i++)u[i].call(this);for(u.splice(0);l.length&&Date.now()-t<m;)l.shift().call(this);for(i=0;i<p.length;i++)p[i].update();_.emit("postrender")}},window.requestAnimationFrame(e),window.addEventListener("resize",n,!1),n(),window.addEventListener("touchmove",function(t){t.preventDefault()},!0),c.pipe=function(t){return t.subscribe instanceof Function?t.subscribe(c):_.pipe(t)},c.unpipe=function(t){return t.unsubscribe instanceof Function?t.unsubscribe(c):_.unpipe(t)},c.on=function(t,i){return t in y||(y[t]=_.emit.bind(_,t),document.body?document.body.addEventListener(t,y[t]):c.nextTick(function(t,i){document.body.addEventListener(t,i)}.bind(this,t,y[t]))),_.on(t,i)},c.emit=function(t,i){return _.emit(t,i)},c.removeListener=function(t,i){return _.removeListener(t,i)},c.getFPS=function(){return 1e3/s},c.setFPSCap=function(t){o=Math.floor(1e3/t)},c.getOptions=function(){return v.getOptions.apply(v,arguments)},c.setOptions=function(){return v.setOptions.apply(v,arguments)},c.createContext=function(t){var i=!1;t||(t=document.createElement(g.containerType),t.classList.add(g.containerClass),i=!0);var e=new r(t);return c.registerContext(e),i&&c.nextTick(function(t,i){document.body.appendChild(i),t.emit("resize")}.bind(this,e,t)),e},c.registerContext=function(t){return p.push(t),t},c.nextTick=function(t){u.push(t)},c.defer=function(t){l.push(t)},v.on("change",function(t){"fpsCap"===t.id?c.setFPSCap(t.value):"runLoop"===t.id&&!d&&t.value&&(d=!0,window.requestAnimationFrame(e))}),i.exports=c},{"./Context":1,"./EventHandler":6,"./OptionsManager":9}],4:[function(t,i){function e(t){return r[t]}function n(t,i){r[t]=i}function s(t){var i=r.length;return n(i,t),i}function o(t){n(t,null)}var r=[];i.exports={register:s,unregister:o,get:e,set:n}},{}],5:[function(t,i){function e(){this.listeners={},this._owner=this}e.prototype.emit=function(t,i){var e=this.listeners[t];if(e)for(var n=0;n<e.length;n++)e[n].call(this._owner,i);return this},e.prototype.on=function(t,i){t in this.listeners||(this.listeners[t]=[]);var e=this.listeners[t].indexOf(i);return 0>e&&this.listeners[t].push(i),this},e.prototype.addListener=e.prototype.on,e.prototype.removeListener=function(t,i){var e=this.listeners[t].indexOf(i);return e>=0&&this.listeners[t].splice(e,1),this},e.prototype.bindThis=function(t){this._owner=t},i.exports=e},{}],6:[function(t,i){function e(){n.apply(this,arguments),this.downstream=[],this.downstreamFn=[],this.upstream=[],this.upstreamListeners={}}var n=t("./EventEmitter");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.setInputHandler=function(t,i){t.trigger=i.trigger.bind(i),i.subscribe&&i.unsubscribe&&(t.subscribe=i.subscribe.bind(i),t.unsubscribe=i.unsubscribe.bind(i))},e.setOutputHandler=function(t,i){i instanceof e&&i.bindThis(t),t.pipe=i.pipe.bind(i),t.unpipe=i.unpipe.bind(i),t.on=i.on.bind(i),t.addListener=t.on,t.removeListener=i.removeListener.bind(i)},e.prototype.emit=function(t,i){n.prototype.emit.apply(this,arguments);var e=0;for(e=0;e<this.downstream.length;e++)this.downstream[e].trigger&&this.downstream[e].trigger(t,i);for(e=0;e<this.downstreamFn.length;e++)this.downstreamFn[e](t,i);return this},e.prototype.trigger=e.prototype.emit,e.prototype.pipe=function(t){if(t.subscribe instanceof Function)return t.subscribe(this);var i=t instanceof Function?this.downstreamFn:this.downstream,e=i.indexOf(t);return 0>e&&i.push(t),t instanceof Function?t("pipe",null):t.trigger&&t.trigger("pipe",null),t},e.prototype.unpipe=function(t){if(t.unsubscribe instanceof Function)return t.unsubscribe(this);var i=t instanceof Function?this.downstreamFn:this.downstream,e=i.indexOf(t);return e>=0?(i.splice(e,1),t instanceof Function?t("unpipe",null):t.trigger&&t.trigger("unpipe",null),t):!1},e.prototype.on=function(t){if(n.prototype.on.apply(this,arguments),!(t in this.upstreamListeners)){var i=this.trigger.bind(this,t);this.upstreamListeners[t]=i;for(var e=0;e<this.upstream.length;e++)this.upstream[e].on(t,i)}return this},e.prototype.addListener=e.prototype.on,e.prototype.subscribe=function(t){var i=this.upstream.indexOf(t);if(0>i){this.upstream.push(t);for(var e in this.upstreamListeners)t.on(e,this.upstreamListeners[e])}return this},e.prototype.unsubscribe=function(t){var i=this.upstream.indexOf(t);if(i>=0){this.upstream.splice(i,1);for(var e in this.upstreamListeners)t.removeListener(e,this.upstreamListeners[e])}return this},i.exports=e},{"./EventEmitter":5}],7:[function(t,i){function e(t){o.call(this,t),this._shouldRecalculateSize=!1,this._container=document.createDocumentFragment(),this.context=new n(this._container),this.setContent(this._container),this._groupSize=[void 0,void 0]}var n=t("./Context"),s=t("./Transform"),o=t("./Surface");e.SIZE_ZERO=[0,0],e.prototype=Object.create(o.prototype),e.prototype.elementType="div",e.prototype.elementClass="famous-group",e.prototype.add=function(){return this.context.add.apply(this.context,arguments)},e.prototype.render=function(){return o.prototype.render.call(this)},e.prototype.deploy=function(t){this.context.migrate(t)},e.prototype.recall=function(){this._container=document.createDocumentFragment(),this.context.migrate(this._container)},e.prototype.commit=function(t){var i=t.transform,n=t.origin,r=t.opacity,a=t.size,h=o.prototype.commit.call(this,{allocator:t.allocator,transform:s.thenMove(i,[-n[0]*a[0],-n[1]*a[1],0]),opacity:r,origin:n,size:e.SIZE_ZERO});return(a[0]!==this._groupSize[0]||a[1]!==this._groupSize[1])&&(this._groupSize[0]=a[0],this._groupSize[1]=a[1],this.context.setSize(a)),this.context.update({transform:s.translate(-n[0]*a[0],-n[1]*a[1],0),origin:n,size:a}),h},i.exports=e},{"./Context":1,"./Surface":13,"./Transform":14}],8:[function(t,i){function e(t){this._transformGetter=null,this._opacityGetter=null,this._originGetter=null,this._alignGetter=null,this._sizeGetter=null,this._legacyStates={},this._output={transform:s.identity,opacity:1,origin:null,align:null,size:null,target:null},t&&(t.transform&&this.transformFrom(t.transform),void 0!==t.opacity&&this.opacityFrom(t.opacity),t.origin&&this.originFrom(t.origin),t.align&&this.alignFrom(t.align),t.size&&this.sizeFrom(t.size))}function n(){this._transformGetter&&(this._output.transform=this._transformGetter()),this._opacityGetter&&(this._output.opacity=this._opacityGetter()),this._originGetter&&(this._output.origin=this._originGetter()),this._alignGetter&&(this._output.align=this._alignGetter()),this._sizeGetter&&(this._output.size=this._sizeGetter())}var s=t("./Transform"),o=t("../transitions/Transitionable"),r=t("../transitions/TransitionableTransform");e.prototype.transformFrom=function(t){return t instanceof Function?this._transformGetter=t:t instanceof Object&&t.get?this._transformGetter=t.get.bind(t):(this._transformGetter=null,this._output.transform=t),this},e.prototype.opacityFrom=function(t){return t instanceof Function?this._opacityGetter=t:t instanceof Object&&t.get?this._opacityGetter=t.get.bind(t):(this._opacityGetter=null,this._output.opacity=t),this},e.prototype.originFrom=function(t){return t instanceof Function?this._originGetter=t:t instanceof Object&&t.get?this._originGetter=t.get.bind(t):(this._originGetter=null,this._output.origin=t),this},e.prototype.alignFrom=function(t){return t instanceof Function?this._alignGetter=t:t instanceof Object&&t.get?this._alignGetter=t.get.bind(t):(this._alignGetter=null,this._output.align=t),this},e.prototype.sizeFrom=function(t){return t instanceof Function?this._sizeGetter=t:t instanceof Object&&t.get?this._sizeGetter=t.get.bind(t):(this._sizeGetter=null,this._output.size=t),this},e.prototype.setTransform=function(t,i,e){return i||this._legacyStates.transform?(this._legacyStates.transform||(this._legacyStates.transform=new r(this._output.transform)),this._transformGetter||this.transformFrom(this._legacyStates.transform),this._legacyStates.transform.set(t,i,e),this):this.transformFrom(t)},e.prototype.setOpacity=function(t,i,e){return i||this._legacyStates.opacity?(this._legacyStates.opacity||(this._legacyStates.opacity=new o(this._output.opacity)),this._opacityGetter||this.opacityFrom(this._legacyStates.opacity),this._legacyStates.opacity.set(t,i,e)):this.opacityFrom(t)},e.prototype.setOrigin=function(t,i,e){return i||this._legacyStates.origin?(this._legacyStates.origin||(this._legacyStates.origin=new o(this._output.origin||[0,0])),this._originGetter||this.originFrom(this._legacyStates.origin),this._legacyStates.origin.set(t,i,e),this):this.originFrom(t)},e.prototype.setAlign=function(t,i,e){return i||this._legacyStates.align?(this._legacyStates.align||(this._legacyStates.align=new o(this._output.align||[0,0])),this._alignGetter||this.alignFrom(this._legacyStates.align),this._legacyStates.align.set(t,i,e),this):this.alignFrom(t)},e.prototype.setSize=function(t,i,e){return t&&(i||this._legacyStates.size)?(this._legacyStates.size||(this._legacyStates.size=new o(this._output.size||[0,0])),this._sizeGetter||this.sizeFrom(this._legacyStates.size),this._legacyStates.size.set(t,i,e),this):this.sizeFrom(t)},e.prototype.halt=function(){this._legacyStates.transform&&this._legacyStates.transform.halt(),this._legacyStates.opacity&&this._legacyStates.opacity.halt(),this._legacyStates.origin&&this._legacyStates.origin.halt(),this._legacyStates.align&&this._legacyStates.align.halt(),this._legacyStates.size&&this._legacyStates.size.halt(),this._transformGetter=null,this._opacityGetter=null,this._originGetter=null,this._alignGetter=null,this._sizeGetter=null},e.prototype.getTransform=function(){return this._transformGetter()},e.prototype.getFinalTransform=function(){return this._legacyStates.transform?this._legacyStates.transform.getFinal():this._output.transform},e.prototype.getOpacity=function(){return this._opacityGetter()},e.prototype.getOrigin=function(){return this._originGetter()},e.prototype.getAlign=function(){return this._alignGetter()},e.prototype.getSize=function(){return this._sizeGetter?this._sizeGetter():this._output.size},e.prototype.modify=function(t){return n.call(this),this._output.target=t,this._output},i.exports=e},{"../transitions/Transitionable":87,"../transitions/TransitionableTransform":88,"./Transform":14}],9:[function(t,i){function e(t){this._value=t,this.eventOutput=null}function n(){this.eventOutput=new s,this.eventOutput.bindThis(this),s.setOutputHandler(this,this.eventOutput)}var s=t("./EventHandler");e.patch=function(t){for(var i=new e(t),n=1;n<arguments.length;n++)i.patch(arguments[n]);return t},e.prototype.patch=function(){for(var t=this._value,i=0;i<arguments.length;i++){var e=arguments[i];for(var n in e)n in t&&e[n]&&e[n].constructor===Object&&t[n]&&t[n].constructor===Object?(t.hasOwnProperty(n)||(t[n]=Object.create(t[n])),this.key(n).patch(e[n]),this.eventOutput&&this.eventOutput.emit("change",{id:n,value:this.key(n).value()})):this.set(n,e[n])}return this},e.prototype.setOptions=e.prototype.patch,e.prototype.key=function(t){var i=new e(this._value[t]);return(!(i._value instanceof Object)||i._value instanceof Array)&&(i._value={}),i},e.prototype.get=function(t){return this._value[t]},e.prototype.getOptions=e.prototype.get,e.prototype.set=function(t,i){var e=this.get(t);return this._value[t]=i,this.eventOutput&&i!==e&&this.eventOutput.emit("change",{id:t,value:i}),this},e.prototype.value=function(){return this._value},e.prototype.on=function(){return n.call(this),this.on.apply(this,arguments)},e.prototype.removeListener=function(){return n.call(this),this.removeListener.apply(this,arguments)},e.prototype.pipe=function(){return n.call(this),this.pipe.apply(this,arguments)},e.prototype.unpipe=function(){return n.call(this),this.unpipe.apply(this,arguments)},i.exports=e},{"./EventHandler":6}],10:[function(t,i){function e(t){this._object=null,this._child=null,this._hasMultipleChildren=!1,this._isRenderable=!1,this._isModifier=!1,this._resultCache={},this._prevResults={},this._childResult=null,t&&this.set(t)}function n(t,i,e){for(var r=o.parse(t,i),a=Object.keys(r),h=0;h<a.length;h++){var c=a[h],p=s.get(c),u=r[c];u.allocator=i.allocator;var l=p.commit(u);l?n(l,i,e):e[c]=u}}var s=t("./Entity"),o=t("./SpecParser");e.prototype.add=function(t){var i=t instanceof e?t:new e(t);return this._child instanceof Array?this._child.push(i):this._child?(this._child=[this._child,i],this._hasMultipleChildren=!0,this._childResult=[]):this._child=i,i},e.prototype.get=function(){return this._object||(this._hasMultipleChildren?null:this._child?this._child.get():null)},e.prototype.set=function(t){return this._childResult=null,this._hasMultipleChildren=!1,this._isRenderable=t.render?!0:!1,this._isModifier=t.modify?!0:!1,this._object=t,this._child=null,t instanceof e?t:this},e.prototype.getSize=function(){var t=null,i=this.get();return i&&i.getSize&&(t=i.getSize()),!t&&this._child&&this._child.getSize&&(t=this._child.getSize()),t},e.prototype.commit=function(t){for(var i=Object.keys(this._prevResults),e=0;e<i.length;e++){var o=i[e];if(void 0===this._resultCache[o]){var r=s.get(o);r.cleanup&&r.cleanup(t.allocator)}}this._prevResults=this._resultCache,this._resultCache={},n(this.render(),t,this._resultCache)},e.prototype.render=function(){if(this._isRenderable)return this._object.render();var t=null;if(this._hasMultipleChildren){t=this._childResult;for(var i=this._child,e=0;e<i.length;e++)t[e]=i[e].render()}else this._child&&(t=this._child.render());return this._isModifier?this._object.modify(t):t},i.exports=e},{"./Entity":4,"./SpecParser":12}],11:[function(t,i){function e(t){this.id=null,this._objects=null,this.node=new c,this._definition=null,t&&this.load(t)}function n(t){for(var i in p)if(i in t){var e=t[i];return e instanceof Array||(e=[e]),p[i].apply(this,e)}}function s(t){var i=t.transform,e=t.opacity,s=t.origin,o=t.align,r=t.size,c=a.identity;if(i instanceof Array)if(16===i.length&&"number"==typeof i[0])c=i;else for(var p=0;p<i.length;p++)c=a.multiply(c,n(i[p]));else i instanceof Object&&(c=n(i));var u=new h({transform:c,opacity:e,origin:s,align:o,size:r});return u}function o(t){for(var i=new c,e=0;e<t.length;e++){var n=r.call(this,t[e]);n&&i.add(n)}return i}function r(t){var i,e;if(t instanceof Array)i=o.call(this,t);else if(e=this._objects.length,t.render&&t.render instanceof Function)i=t;else if(t.target){var n=r.call(this,t.target),a=s.call(this,t);i=new c(a),i.add(n),t.id&&(this.id[t.id]=a)}else t.id&&(i=new c,this.id[t.id]=i);return this._objects[e]=i,i}var a=t("./Transform"),h=t("./Modifier"),c=t("./RenderNode"),p={translate:a.translate,rotate:a.rotate,rotateX:a.rotateX,rotateY:a.rotateY,rotateZ:a.rotateZ,rotateAxis:a.rotateAxis,scale:a.scale,skew:a.skew,matrix3d:function(){return arguments}};e.prototype.create=function(){return new e(this._definition)},e.prototype.load=function(t){this._definition=t,this.id={},this._objects=[],this.node.set(r.call(this,t))},e.prototype.add=function(){return this.node.add.apply(this.node,arguments)},e.prototype.render=function(){return this.node.render.apply(this.node,arguments)},i.exports=e},{"./Modifier":8,"./RenderNode":10,"./Transform":14}],12:[function(t,i){function e(){this.result={}}function n(t,i){return[t[0]*i[0]+t[1]*i[4]+t[2]*i[8],t[0]*i[1]+t[1]*i[5]+t[2]*i[9],t[0]*i[2]+t[1]*i[6]+t[2]*i[10]]}var s=t("./Transform");e._instance=new e,e.parse=function(t,i){return e._instance.parse(t,i)},e.prototype.parse=function(t,i){return this.reset(),this._parseSpec(t,i,s.identity),this.result},e.prototype.reset=function(){this.result={}};var o=[0,0];e.prototype._parseSpec=function(t,i,e){var r,a,h,c,p,u,l;if("number"==typeof t){if(r=t,h=i.transform,u=i.align||i.origin,i.size&&u&&(u[0]||u[1])){var f=[u[0]*i.size[0],u[1]*i.size[1],0];h=s.thenMove(h,n(f,e))}this.result[r]={transform:h,opacity:i.opacity,origin:i.origin||o,align:i.align||i.origin||o,size:i.size}}else{if(!t)return;if(t instanceof Array)for(var d=0;d<t.length;d++)this._parseSpec(t[d],i,e);else{a=t.target,h=i.transform,c=i.opacity,p=i.origin,u=i.align,l=i.size;var y=e;if(void 0!==t.opacity&&(c=i.opacity*t.opacity),t.transform&&(h=s.multiply(i.transform,t.transform)),t.origin&&(p=t.origin,y=i.transform),t.align&&(u=t.align),t.size){var _=i.size;l=[void 0!==t.size[0]?t.size[0]:_[0],void 0!==t.size[1]?t.size[1]:_[1]],_&&(u||(u=p),u&&(u[0]||u[1])&&(h=s.thenMove(h,n([u[0]*_[0],u[1]*_[1],0],e))),p&&(p[0]||p[1])&&(h=s.moveThen([-p[0]*l[0],-p[1]*l[1],0],h))),y=i.transform,p=null,u=null}this._parseSpec(a,{transform:h,opacity:c,origin:p,align:u,size:l},y)}}},i.exports=e},{"./Transform":14}],13:[function(t,i){function e(t){this.options={},this.properties={},this.content="",this.classList=[],this.size=null,this._classesDirty=!0,this._stylesDirty=!0,this._sizeDirty=!0,this._contentDirty=!0,this._dirtyClasses=[],this._matrix=null,this._opacity=1,this._origin=null,this._size=null,this.eventForwarder=function(t){this.emit(t.type,t)}.bind(this),this.eventHandler=new l,this.eventHandler.bindThis(this),this.id=u.register(this),t&&this.setOptions(t),this._currTarget=null}function n(t){for(var i in this.eventHandler.listeners)t.addEventListener(i,this.eventForwarder)}function s(t){for(var i in this.eventHandler.listeners)t.removeEventListener(i,this.eventForwarder)}function o(t){for(var i=0;i<this._dirtyClasses.length;i++)t.classList.remove(this._dirtyClasses[i]);this._dirtyClasses=[]}function r(t){for(var i in this.properties)t.style[i]=this.properties[i]}function a(t){for(var i in this.properties)t.style[i]=""}function h(t){t[12]=Math.round(t[12]*d)/d,t[13]=Math.round(t[13]*d)/d;for(var i="matrix3d(",e=0;15>e;e++)i+=t[e]<1e-6&&t[e]>-1e-6?"0,":t[e]+",";return i+=t[15]+")"}function c(t){return 100*t[0]+"% "+100*t[1]+"%"}function p(t,i){return t&&i?t[0]!==i[0]||t[1]!==i[1]:t!==i}var u=t("./Entity"),l=t("./EventHandler"),f=t("./Transform"),d=window.devicePixelRatio||1,y=void 0!==document.createElement("div").style.webkitTransform;e.prototype.elementType="div",e.prototype.elementClass="famous-surface",e.prototype.on=function(t,i){this._currTarget&&this._currTarget.addEventListener(t,this.eventForwarder),this.eventHandler.on(t,i)},e.prototype.removeListener=function(t,i){this.eventHandler.removeListener(t,i)},e.prototype.emit=function(t,i){i&&!i.origin&&(i.origin=this);var e=this.eventHandler.emit(t,i);return e&&i&&i.stopPropagation&&i.stopPropagation(),e},e.prototype.pipe=function(t){return this.eventHandler.pipe(t)},e.prototype.unpipe=function(t){return this.eventHandler.unpipe(t)},e.prototype.render=function(){return this.id},e.prototype.setProperties=function(t){for(var i in t)this.properties[i]=t[i];this._stylesDirty=!0},e.prototype.getProperties=function(){return this.properties},e.prototype.addClass=function(t){this.classList.indexOf(t)<0&&(this.classList.push(t),this._classesDirty=!0)},e.prototype.removeClass=function(t){var i=this.classList.indexOf(t);i>=0&&(this._dirtyClasses.push(this.classList.splice(i,1)[0]),this._classesDirty=!0)},e.prototype.setClasses=function(t){var i=0,e=[];for(i=0;i<this.classList.length;i++)t.indexOf(this.classList[i])<0&&e.push(this.classList[i]);for(i=0;i<e.length;i++)this.removeClass(e[i]);for(i=0;i<t.length;i++)this.addClass(t[i])},e.prototype.getClassList=function(){return this.classList},e.prototype.setContent=function(t){this.content!==t&&(this.content=t,this._contentDirty=!0)},e.prototype.getContent=function(){return this.content},e.prototype.setOptions=function(t){t.size&&this.setSize(t.size),t.classes&&this.setClasses(t.classes),t.properties&&this.setProperties(t.properties),t.content&&this.setContent(t.content)};var _;_=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?function(t,i){t.style.zIndex=1e6*i[14]|0,t.style.transform=h(i)}:y?function(t,i){t.style.webkitTransform=h(i)}:function(t,i){t.style.transform=h(i)};var g=y?function(t,i){t.style.webkitTransformOrigin=c(i)}:function(t,i){t.style.transformOrigin=c(i)},v=y?function(t){t.style.webkitTransform="scale3d(0.0001,0.0001,1)",t.style.opacity=0}:function(t){t.style.transform="scale3d(0.0001,0.0001,1)",t.style.opacity=0};e.prototype.setup=function(t){var i=t.allocate(this.elementType);if(this.elementClass)if(this.elementClass instanceof Array)for(var e=0;e<this.elementClass.length;e++)i.classList.add(this.elementClass[e]);else i.classList.add(this.elementClass);i.style.display="",n.call(this,i),this._currTarget=i,this._stylesDirty=!0,this._classesDirty=!0,this._sizeDirty=!0,this._contentDirty=!0,this._matrix=null,this._opacity=void 0,this._origin=null,this._size=null},e.prototype.commit=function(t){this._currTarget||this.setup(t.allocator);var i=this._currTarget,e=t.transform,n=t.opacity,s=t.origin,a=t.size;if(this._classesDirty){o.call(this,i);for(var h=this.getClassList(),c=0;c<h.length;c++)i.classList.add(h[c]);this._classesDirty=!1}if(this._stylesDirty&&(r.call(this,i),this._stylesDirty=!1),this._contentDirty&&(this.deploy(i),this.eventHandler.emit("deploy"),this._contentDirty=!1),this.size){var u=a;a=[this.size[0],this.size[1]],void 0===a[0]&&u[0]&&(a[0]=u[0]),void 0===a[1]&&u[1]&&(a[1]=u[1])}if(a[0]===!0&&(a[0]=i.clientWidth),a[1]===!0&&(a[1]=i.clientHeight),p(this._size,a)&&(this._size||(this._size=[0,0]),this._size[0]=a[0],this._size[1]=a[1],this._sizeDirty=!0),!e&&this._matrix)return this._matrix=null,this._opacity=0,void v(i);if(this._opacity!==n&&(this._opacity=n,i.style.opacity=n>=1?"0.999999":n),p(this._origin,s)||f.notEquals(this._matrix,e)||this._sizeDirty){e||(e=f.identity),this._matrix=e;var l=e;s&&(this._origin||(this._origin=[0,0]),this._origin[0]=s[0],this._origin[1]=s[1],l=f.thenMove(e,[-this._size[0]*s[0],-this._size[1]*s[1],0]),g(i,s)),_(i,l)}this._sizeDirty&&(this._size&&(i.style.width=this.size&&this.size[0]===!0?"":this._size[0]+"px",i.style.height=this.size&&this.size[1]===!0?"":this._size[1]+"px"),this._sizeDirty=!1)},e.prototype.cleanup=function(t){var i=0,e=this._currTarget;this.eventHandler.emit("recall"),this.recall(e),e.style.display="none",e.style.width="",e.style.height="",this._size=null,a.call(this,e);var n=this.getClassList();for(o.call(this,e),i=0;i<n.length;i++)e.classList.remove(n[i]);if(this.elementClass)if(this.elementClass instanceof Array)for(i=0;i<this.elementClass.length;i++)e.classList.remove(this.elementClass[i]);else e.classList.remove(this.elementClass);s.call(this,e),this._currTarget=null,t.deallocate(e),v(e)},e.prototype.deploy=function(t){var i=this.getContent();if(i instanceof Node){for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(i)}else t.innerHTML=i},e.prototype.recall=function(t){for(var i=document.createDocumentFragment();t.hasChildNodes();)i.appendChild(t.firstChild);this.setContent(i)},e.prototype.getSize=function(t){return t?this._size:this.size||this._size},e.prototype.setSize=function(t){this.size=t?[t[0],t[1]]:null,this._sizeDirty=!0},i.exports=e},{"./Entity":4,"./EventHandler":6,"./Transform":14}],14:[function(t,i){function e(t){return 2===t.length?t[0]*t[0]+t[1]*t[1]:t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function n(t){return Math.sqrt(e(t))}function s(t){return 0>t?-1:1}var o={};o.precision=1e-6,o.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o.multiply4x4=function(t,i){return[t[0]*i[0]+t[4]*i[1]+t[8]*i[2]+t[12]*i[3],t[1]*i[0]+t[5]*i[1]+t[9]*i[2]+t[13]*i[3],t[2]*i[0]+t[6]*i[1]+t[10]*i[2]+t[14]*i[3],t[3]*i[0]+t[7]*i[1]+t[11]*i[2]+t[15]*i[3],t[0]*i[4]+t[4]*i[5]+t[8]*i[6]+t[12]*i[7],t[1]*i[4]+t[5]*i[5]+t[9]*i[6]+t[13]*i[7],t[2]*i[4]+t[6]*i[5]+t[10]*i[6]+t[14]*i[7],t[3]*i[4]+t[7]*i[5]+t[11]*i[6]+t[15]*i[7],t[0]*i[8]+t[4]*i[9]+t[8]*i[10]+t[12]*i[11],t[1]*i[8]+t[5]*i[9]+t[9]*i[10]+t[13]*i[11],t[2]*i[8]+t[6]*i[9]+t[10]*i[10]+t[14]*i[11],t[3]*i[8]+t[7]*i[9]+t[11]*i[10]+t[15]*i[11],t[0]*i[12]+t[4]*i[13]+t[8]*i[14]+t[12]*i[15],t[1]*i[12]+t[5]*i[13]+t[9]*i[14]+t[13]*i[15],t[2]*i[12]+t[6]*i[13]+t[10]*i[14]+t[14]*i[15],t[3]*i[12]+t[7]*i[13]+t[11]*i[14]+t[15]*i[15]]},o.multiply=function(t,i){return[t[0]*i[0]+t[4]*i[1]+t[8]*i[2],t[1]*i[0]+t[5]*i[1]+t[9]*i[2],t[2]*i[0]+t[6]*i[1]+t[10]*i[2],0,t[0]*i[4]+t[4]*i[5]+t[8]*i[6],t[1]*i[4]+t[5]*i[5]+t[9]*i[6],t[2]*i[4]+t[6]*i[5]+t[10]*i[6],0,t[0]*i[8]+t[4]*i[9]+t[8]*i[10],t[1]*i[8]+t[5]*i[9]+t[9]*i[10],t[2]*i[8]+t[6]*i[9]+t[10]*i[10],0,t[0]*i[12]+t[4]*i[13]+t[8]*i[14]+t[12],t[1]*i[12]+t[5]*i[13]+t[9]*i[14]+t[13],t[2]*i[12]+t[6]*i[13]+t[10]*i[14]+t[14],1]},o.thenMove=function(t,i){return i[2]||(i[2]=0),[t[0],t[1],t[2],0,t[4],t[5],t[6],0,t[8],t[9],t[10],0,t[12]+i[0],t[13]+i[1],t[14]+i[2],1]},o.moveThen=function(t,i){t[2]||(t[2]=0);var e=t[0]*i[0]+t[1]*i[4]+t[2]*i[8],n=t[0]*i[1]+t[1]*i[5]+t[2]*i[9],s=t[0]*i[2]+t[1]*i[6]+t[2]*i[10];return o.thenMove(i,[e,n,s])},o.translate=function(t,i,e){return void 0===e&&(e=0),[1,0,0,0,0,1,0,0,0,0,1,0,t,i,e,1]},o.thenScale=function(t,i){return[i[0]*t[0],i[1]*t[1],i[2]*t[2],0,i[0]*t[4],i[1]*t[5],i[2]*t[6],0,i[0]*t[8],i[1]*t[9],i[2]*t[10],0,i[0]*t[12],i[1]*t[13],i[2]*t[14],1]},o.scale=function(t,i,e){return void 0===e&&(e=1),[t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1]},o.rotateX=function(t){var i=Math.cos(t),e=Math.sin(t);return[1,0,0,0,0,i,e,0,0,-e,i,0,0,0,0,1]},o.rotateY=function(t){var i=Math.cos(t),e=Math.sin(t);return[i,0,-e,0,0,1,0,0,e,0,i,0,0,0,0,1]},o.rotateZ=function(t){var i=Math.cos(t),e=Math.sin(t);return[i,e,0,0,-e,i,0,0,0,0,1,0,0,0,0,1]},o.rotate=function(t,i,e){var n=Math.cos(t),s=Math.sin(t),o=Math.cos(i),r=Math.sin(i),a=Math.cos(e),h=Math.sin(e),c=[o*a,n*h+s*r*a,s*h-n*r*a,0,-o*h,n*a-s*r*h,s*a+n*r*h,0,r,-s*o,n*o,0,0,0,0,1];return c},o.rotateAxis=function(t,i){var e=Math.sin(i),n=Math.cos(i),s=1-n,o=t[0]*t[0]*s,r=t[0]*t[1]*s,a=t[0]*t[2]*s,h=t[1]*t[1]*s,c=t[1]*t[2]*s,p=t[2]*t[2]*s,u=t[0]*e,l=t[1]*e,f=t[2]*e,d=[o+n,r+f,a-l,0,r-f,h+n,c+u,0,a+l,c-u,p+n,0,0,0,0,1];return d},o.aboutOrigin=function(t,i){var e=t[0]-(t[0]*i[0]+t[1]*i[4]+t[2]*i[8]),n=t[1]-(t[0]*i[1]+t[1]*i[5]+t[2]*i[9]),s=t[2]-(t[0]*i[2]+t[1]*i[6]+t[2]*i[10]);return o.thenMove(i,[e,n,s])},o.skew=function(t,i,e){return[1,0,0,0,Math.tan(e),1,0,0,Math.tan(i),Math.tan(t),1,0,0,0,0,1]},o.skewX=function(t){return[1,0,0,0,Math.tan(t),1,0,0,0,0,1,0,0,0,0,1]},o.skewY=function(t){return[1,Math.tan(t),0,0,0,1,0,0,0,0,1,0,0,0,0,1]},o.perspective=function(t){return[1,0,0,0,0,1,0,0,0,0,1,-1/t,0,0,0,1]},o.getTranslate=function(t){return[t[12],t[13],t[14]]},o.inverse=function(t){var i=t[5]*t[10]-t[6]*t[9],e=t[4]*t[10]-t[6]*t[8],n=t[4]*t[9]-t[5]*t[8],s=t[1]*t[10]-t[2]*t[9],o=t[0]*t[10]-t[2]*t[8],r=t[0]*t[9]-t[1]*t[8],a=t[1]*t[6]-t[2]*t[5],h=t[0]*t[6]-t[2]*t[4],c=t[0]*t[5]-t[1]*t[4],p=t[0]*i-t[1]*e+t[2]*n,u=1/p,l=[u*i,-u*s,u*a,0,-u*e,u*o,-u*h,0,u*n,-u*r,u*c,0,0,0,0,1];return l[12]=-t[12]*l[0]-t[13]*l[4]-t[14]*l[8],l[13]=-t[12]*l[1]-t[13]*l[5]-t[14]*l[9],l[14]=-t[12]*l[2]-t[13]*l[6]-t[14]*l[10],l},o.transpose=function(t){return[t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]},o.interpret=function(t){var i=[t[0],t[1],t[2]],r=s(i[0]),a=n(i),h=[i[0]+r*a,i[1],i[2]],c=2/e(h);if(c>=1/0)return{translate:o.getTranslate(t),rotate:[0,0,0],scale:[0,0,0],skew:[0,0,0]};var p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];p[0]=1-c*h[0]*h[0],p[5]=1-c*h[1]*h[1],p[10]=1-c*h[2]*h[2],p[1]=-c*h[0]*h[1],p[2]=-c*h[0]*h[2],p[6]=-c*h[1]*h[2],p[4]=p[1],p[8]=p[2],p[9]=p[6];var u=o.multiply(p,t),l=[u[5],u[6]],f=s(l[0]),d=n(l),y=[l[0]+f*d,l[1]],_=2/e(y),g=[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];g[5]=1-_*y[0]*y[0],g[10]=1-_*y[1]*y[1],g[6]=-_*y[0]*y[1],g[9]=g[6];var v=o.multiply(g,p),m=o.multiply(v,t),O=o.scale(m[0]<0?-1:1,m[5]<0?-1:1,m[10]<0?-1:1);m=o.multiply(m,O),v=o.multiply(O,v);var T={};return T.translate=o.getTranslate(t),T.rotate=[Math.atan2(-v[6],v[10]),Math.asin(v[2]),Math.atan2(-v[1],v[0])],T.rotate[0]||(T.rotate[0]=0,T.rotate[2]=Math.atan2(v[4],v[5])),T.scale=[m[0],m[5],m[10]],T.skew=[Math.atan2(m[9],T.scale[2]),Math.atan2(m[8],T.scale[2]),Math.atan2(m[4],T.scale[0])],Math.abs(T.rotate[0])+Math.abs(T.rotate[2])>1.5*Math.PI&&(T.rotate[1]=Math.PI-T.rotate[1],T.rotate[1]>Math.PI&&(T.rotate[1]-=2*Math.PI),T.rotate[1]<-Math.PI&&(T.rotate[1]+=2*Math.PI),T.rotate[0]<0?T.rotate[0]+=Math.PI:T.rotate[0]-=Math.PI,T.rotate[2]<0?T.rotate[2]+=Math.PI:T.rotate[2]-=Math.PI),T},o.average=function(t,i,e){e=void 0===e?.5:e;for(var n=o.interpret(t),s=o.interpret(i),r={translate:[0,0,0],rotate:[0,0,0],scale:[0,0,0],skew:[0,0,0]},a=0;3>a;a++)r.translate[a]=(1-e)*n.translate[a]+e*s.translate[a],r.rotate[a]=(1-e)*n.rotate[a]+e*s.rotate[a],r.scale[a]=(1-e)*n.scale[a]+e*s.scale[a],r.skew[a]=(1-e)*n.skew[a]+e*s.skew[a];
return o.build(r)},o.build=function(t){var i=o.scale(t.scale[0],t.scale[1],t.scale[2]),e=o.skew(t.skew[0],t.skew[1],t.skew[2]),n=o.rotate(t.rotate[0],t.rotate[1],t.rotate[2]);return o.thenMove(o.multiply(o.multiply(n,e),i),t.translate)},o.equals=function(t,i){return!o.notEquals(t,i)},o.notEquals=function(t,i){return t===i?!1:!(t&&i)||t[12]!==i[12]||t[13]!==i[13]||t[14]!==i[14]||t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[4]!==i[4]||t[5]!==i[5]||t[6]!==i[6]||t[8]!==i[8]||t[9]!==i[9]||t[10]!==i[10]},o.normalizeRotation=function(t){var i=t.slice(0);for((i[0]===.5*Math.PI||i[0]===.5*-Math.PI)&&(i[0]=-i[0],i[1]=Math.PI-i[1],i[2]-=Math.PI),i[0]>.5*Math.PI&&(i[0]=i[0]-Math.PI,i[1]=Math.PI-i[1],i[2]-=Math.PI),i[0]<.5*-Math.PI&&(i[0]=i[0]+Math.PI,i[1]=-Math.PI-i[1],i[2]-=Math.PI);i[1]<-Math.PI;)i[1]+=2*Math.PI;for(;i[1]>=Math.PI;)i[1]-=2*Math.PI;for(;i[2]<-Math.PI;)i[2]+=2*Math.PI;for(;i[2]>=Math.PI;)i[2]-=2*Math.PI;return i},o.inFront=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,.001,1],o.behind=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,-.001,1],i.exports=o},{}],15:[function(t,i){function e(t){this._node=new o,this._eventInput=new n,this._eventOutput=new n,n.setInputHandler(this,this._eventInput),n.setOutputHandler(this,this._eventOutput),this.options=Object.create(this.constructor.DEFAULT_OPTIONS||e.DEFAULT_OPTIONS),this._optionsManager=new s(this.options),t&&this.setOptions(t)}var n=t("./EventHandler"),s=t("./OptionsManager"),o=t("./RenderNode");e.DEFAULT_OPTIONS={},e.prototype.getOptions=function(){return this._optionsManager.value()},e.prototype.setOptions=function(t){this._optionsManager.patch(t)},e.prototype.add=function(){return this._node.add.apply(this._node,arguments)},e.prototype._add=e.prototype.add,e.prototype.render=function(){return this._node.render()},e.prototype.getSize=function(){return this._node&&this._node.getSize?this._node.getSize.apply(this._node,arguments)||this.options.size:this.options.size},i.exports=e},{"./EventHandler":6,"./OptionsManager":9,"./RenderNode":10}],16:[function(t,i){function e(t){t||(t=[]),t instanceof Array&&(t={array:t}),this._=null,this.index=t.index||0,t.array?this._=new this.constructor.Backing(t.array):t._&&(this._=t._),this.index===this._.firstIndex&&(this._.firstNode=this),this.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=this),void 0!==t.loop&&(this._.loop=t.loop),this._previousNode=null,this._nextNode=null}e.Backing=function(t){this.array=t,this.firstIndex=0,this.loop=!1,this.firstNode=null,this.lastNode=null},e.Backing.prototype.getValue=function(t){var i=t-this.firstIndex;return 0>i||i>=this.array.length?null:this.array[i]},e.Backing.prototype.setValue=function(t,i){this.array[t-this.firstIndex]=i},e.Backing.prototype.reindex=function(t,i,e){if(this.array[0]){for(var n=0,s=this.firstIndex,o=e-i,r=this.firstNode;t-1>s;)r=r.getNext(),s++;var a=r;for(n=0;i>n;n++)r=r.getNext(),r&&(r._previousNode=a);var h=r?r.getNext():null;for(a._nextNode=null,r=a,n=0;e>n;n++)r=r.getNext();if(s+=e,r!==h&&(r._nextNode=h,h&&(h._previousNode=r)),h)for(r=h,s++;r&&s<this.array.length+this.firstIndex;)r._nextNode?r.index+=o:r.index=s,r=r.getNext(),s++}},e.prototype.getPrevious=function(){return this.index===this._.firstIndex?this._.loop?(this._previousNode=this._.lastNode||new this.constructor({_:this._,index:this._.firstIndex+this._.array.length-1}),this._previousNode._nextNode=this):this._previousNode=null:this._previousNode||(this._previousNode=new this.constructor({_:this._,index:this.index-1}),this._previousNode._nextNode=this),this._previousNode},e.prototype.getNext=function(){return this.index===this._.firstIndex+this._.array.length-1?this._.loop?(this._nextNode=this._.firstNode||new this.constructor({_:this._,index:this._.firstIndex}),this._nextNode._previousNode=this):this._nextNode=null:this._nextNode||(this._nextNode=new this.constructor({_:this._,index:this.index+1}),this._nextNode._previousNode=this),this._nextNode},e.prototype.getIndex=function(){return this.index},e.prototype.toString=function(){return""+this.index},e.prototype.unshift=function(){this._.array.unshift.apply(this._.array,arguments),this._.firstIndex-=arguments.length},e.prototype.push=function(){this._.array.push.apply(this._.array,arguments)},e.prototype.splice=function(t,i){var e=Array.prototype.slice.call(arguments,2);this._.array.splice.apply(this._.array,[t-this._.firstIndex,i].concat(e)),this._.reindex(t,i,e.length)},e.prototype.swap=function(t){var i=t.get(),e=this.get();this._.setValue(this.index,i),this._.setValue(t.index,e);var n=this._previousNode,s=this._nextNode,o=this.index,r=t._previousNode,a=t._nextNode,h=t.index;this.index=h,this._previousNode=r===this?t:r,this._previousNode&&(this._previousNode._nextNode=this),this._nextNode=a===this?t:a,this._nextNode&&(this._nextNode._previousNode=this),t.index=o,t._previousNode=n===t?this:n,t._previousNode&&(t._previousNode._nextNode=t),t._nextNode=s===t?this:s,t._nextNode&&(t._nextNode._previousNode=t),this.index===this._.firstIndex?this._.firstNode=this:this.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=this),t.index===this._.firstIndex?this._.firstNode=t:t.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=t)},e.prototype.get=function(){return this._.getValue(this.index)},e.prototype.getSize=function(){var t=this.get();return t?t.getSize():null},e.prototype.render=function(){var t=this.get();return t?t.render.apply(t,arguments):null},i.exports=e},{}],17:[function(t,i){i.exports={Context:t("./Context"),ElementAllocator:t("./ElementAllocator"),Engine:t("./Engine"),Entity:t("./Entity"),EventEmitter:t("./EventEmitter"),Group:t("./Group"),EventHandler:t("./EventHandler"),Modifier:t("./Modifier"),RenderNode:t("./RenderNode"),OptionsManager:t("./OptionsManager"),Scene:t("./Scene"),SpecParser:t("./SpecParser"),Surface:t("./Surface"),View:t("./View"),Transform:t("./Transform"),ViewSequence:t("./ViewSequence")}},{"./Context":1,"./ElementAllocator":2,"./Engine":3,"./Entity":4,"./EventEmitter":5,"./EventHandler":6,"./Group":7,"./Modifier":8,"./OptionsManager":9,"./RenderNode":10,"./Scene":11,"./SpecParser":12,"./Surface":13,"./Transform":14,"./View":15,"./ViewSequence":16}],18:[function(t,i){function e(t){this.dispatchers={},this.currMode=void 0,this.setMode(t)}var n=t("../core/EventHandler");e.prototype.setMode=function(t){if(t!==this.currMode){var i=this.currMode;this.dispatchers[this.currMode]&&this.dispatchers[this.currMode].trigger("unpipe"),this.currMode=t,this.dispatchers[t]&&this.dispatchers[t].emit("pipe"),this.emit("change",{from:i,to:t})}},e.prototype.forMode=function(t){return this.dispatchers[t]||(this.dispatchers[t]=new n),this.dispatchers[t]},e.prototype.emit=function(t,i){if(void 0===this.currMode)return!1;i||(i={});var e=this.dispatchers[this.currMode];return e?e.trigger(t,i):void 0},i.exports=e},{"../core/EventHandler":6}],19:[function(t,i){function e(t){n.call(this),this._condition=t}var n=t("../core/EventHandler");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.emit=function(t,i){return this._condition(t,i)?n.prototype.emit.apply(this,arguments):void 0},e.prototype.trigger=e.prototype.emit,i.exports=e},{"../core/EventHandler":6}],20:[function(t,i){function e(t){n.call(this),this._mappingFunction=t}var n=t("../core/EventHandler");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.subscribe=null,e.prototype.unsubscribe=null,e.prototype.emit=function(t,i){var e=this._mappingFunction.apply(this,arguments);e&&e.emit instanceof Function&&e.emit(t,i)},e.prototype.trigger=e.prototype.emit,i.exports=e},{"../core/EventHandler":6}],21:[function(t,i){i.exports={EventArbiter:t("./EventArbiter"),EventFilter:t("./EventFilter"),EventMapper:t("./EventMapper")}},{"./EventArbiter":18,"./EventFilter":19,"./EventMapper":20}],22:[function(t,i){i.exports={core:t("./core"),math:t("./math"),inputs:t("./inputs"),modifiers:t("./modifiers"),events:t("./events"),utilities:t("./utilities"),physics:t("./physics"),transitions:t("./transitions"),views:t("./views"),surfaces:t("./surfaces"),widgets:t("./widgets")}},{"./core":17,"./events":21,"./inputs":35,"./math":41,"./modifiers":46,"./physics":70,"./surfaces":81,"./transitions":91,"./utilities":95,"./views":109,"./widgets":114}],23:[function(t,i){function e(t,i){void 0===i&&(i="update"),this._state=t&&t.get&&t.set?t:new o(t||0),this._eventInput=new s,s.setInputHandler(this,this._eventInput),this._eventInput.on(i,n.bind(this))}function n(t){var i=t.delta,e=this.get();if(i.constructor===e.constructor){var n=i instanceof Array?[e[0]+i[0],e[1]+i[1]]:e+i;this.set(n)}}var s=t("../core/EventHandler"),o=t("../transitions/Transitionable");e.prototype.get=function(){return this._state.get()},e.prototype.set=function(t){this._state.set(t)},i.exports=e},{"../core/EventHandler":6,"../transitions/Transitionable":87}],24:[function(){function t(t){window.addEventListener(t,function(t){return t.stopPropagation(),!1},!0)}var i="ontouchstart"in window;i&&(t("mousedown"),t("mousemove"),t("mouseup"),t("mouseleave"))},{}],25:[function(){if(window.CustomEvent){var t=300,i=500,e={},n={},s=Date.now;window.addEventListener("touchstart",function(t){for(var i=s(),n=0;n<t.changedTouches.length;n++){var o=t.changedTouches[n];e[o.identifier]=i}}),window.addEventListener("touchmove",function(t){for(var i=0;i<t.changedTouches.length;i++){var n=t.changedTouches[i];delete e[n.identifier]}}),window.addEventListener("touchend",function(i){for(var o=s(),r=0;r<i.changedTouches.length;r++){var a=i.changedTouches[r],h=e[a.identifier];if(h&&t>o-h){var c=new window.CustomEvent("click",{bubbles:!0,detail:a});n[o]=i,i.target.dispatchEvent(c)}delete e[a.identifier]}}),window.addEventListener("click",function(t){var e=s();for(var o in n){var r=n[o];i>e-o?t instanceof window.MouseEvent&&t.target===r.target&&t.stopPropagation():delete n[o]}},!0)}},{}],26:[function(t,i){function e(t,i){this._eventInput=new s,this._eventOutput=new s,s.setInputHandler(this,this._eventInput),s.setOutputHandler(this,this._eventOutput),this._syncs={},t&&this.addSync(t),i&&this.setOptions(i)}function n(t,i){o[t]&&(this._syncs[t]=new o[t](i),this.pipeSync(t))}var s=t("../core/EventHandler");e.DIRECTION_X=0,e.DIRECTION_Y=1,e.DIRECTION_Z=2;var o={};e.register=function(t){for(var i in t){if(o[i]){if(o[i]===t[i])return;throw new Error("this key is registered to a different sync class")}o[i]=t[i]}},e.prototype.setOptions=function(t){for(var i in this._syncs)this._syncs[i].setOptions(t)},e.prototype.pipeSync=function(t){var i=this._syncs[t];this._eventInput.pipe(i),i.pipe(this._eventOutput)},e.prototype.unpipeSync=function(t){var i=this._syncs[t];this._eventInput.unpipe(i),i.unpipe(this._eventOutput)},e.prototype.addSync=function(t){if(t instanceof Array)for(var i=0;i<t.length;i++)n.call(this,t[i]);else if(t instanceof Object)for(var e in t)n.call(this,e,t[e])},i.exports=e},{"../core/EventHandler":6}],27:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),this._eventInput=new a,this._eventOutput=new a,a.setInputHandler(this,this._eventInput),a.setOutputHandler(this,this._eventOutput),this._eventInput.on("mousedown",n.bind(this)),this._eventInput.on("mousemove",s.bind(this)),this._eventInput.on("mouseup",o.bind(this)),this.options.propogate?this._eventInput.on("mouseleave",r.bind(this)):this._eventInput.on("mouseleave",o.bind(this)),this._payload={delta:null,position:null,velocity:null,clientX:0,clientY:0,offsetX:0,offsetY:0},this._position=null,this._prevCoord=void 0,this._prevTime=void 0,this._down=!1,this._moved=!1}function n(t){var i,e;t.preventDefault();var n=t.clientX,s=t.clientY;this._prevCoord=[n,s],this._prevTime=c(),this._down=!0,this._move=!1,void 0!==this.options.direction?(this._position=0,i=0,e=0):(this._position=[0,0],i=[0,0],e=[0,0]);var o=this._payload;o.delta=i,o.position=this._position,o.velocity=e,o.clientX=n,o.clientY=s,o.offsetX=t.offsetX,o.offsetY=t.offsetY,this._eventOutput.emit("start",o)}function s(t){if(this._prevCoord){var i=this._prevCoord,n=this._prevTime,s=t.clientX,o=t.clientY,r=c(),a=s-i[0],p=o-i[1];this.options.rails&&(Math.abs(a)>Math.abs(p)?p=0:a=0);var u,l,f=Math.max(r-n,h),d=a/f,y=p/f,_=this.options.scale;this.options.direction===e.DIRECTION_X?(l=_*a,u=_*d,this._position+=l):this.options.direction===e.DIRECTION_Y?(l=_*p,u=_*y,this._position+=l):(l=[_*a,_*p],u=[_*d,_*y],this._position[0]+=l[0],this._position[1]+=l[1]);var g=this._payload;g.delta=l,g.position=this._position,g.velocity=u,g.clientX=s,g.clientY=o,g.offsetX=t.offsetX,g.offsetY=t.offsetY,this._eventOutput.emit("update",g),this._prevCoord=[s,o],this._prevTime=r,this._move=!0}}function o(){this._down&&(this._eventOutput.emit("end",this._payload),this._prevCoord=void 0,this._prevTime=void 0,this._down=!1,this._move=!1)}function r(t){if(this._down&&this._move){var i=s.bind(this),e=function(t){o.call(this,t),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",e)}.bind(this,t);document.addEventListener("mousemove",i),document.addEventListener("mouseup",e)}}var a=t("../core/EventHandler");e.DEFAULT_OPTIONS={direction:void 0,rails:!1,scale:1,propogate:!0},e.DIRECTION_X=0,e.DIRECTION_Y=1;var h=8,c=Date.now;e.prototype.getOptions=function(){return this.options},e.prototype.setOptions=function(t){void 0!==t.direction&&(this.options.direction=t.direction),void 0!==t.rails&&(this.options.rails=t.rails),void 0!==t.scale&&(this.options.scale=t.scale),void 0!==t.propogate&&(this.options.propogate=t.propogate)},i.exports=e},{"../core/EventHandler":6}],28:[function(t,i){function e(t){n.call(this),this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),this._displacement=0,this._previousDistance=0}var n=t("./TwoFingerSync");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.DEFAULT_OPTIONS={scale:1},e.prototype._startUpdate=function(t){this._previousDistance=n.calculateDistance(this.posA,this.posB),this._displacement=0,this._eventOutput.emit("start",{count:t.touches.length,touches:[this.touchAId,this.touchBId],distance:this._dist,center:n.calculateCenter(this.posA,this.posB)})},e.prototype._moveUpdate=function(t){var i=n.calculateDistance(this.posA,this.posB),e=n.calculateCenter(this.posA,this.posB),s=this.options.scale,o=s*(i-this._previousDistance),r=o/t;this._previousDistance=i,this._displacement+=o,this._eventOutput.emit("update",{delta:o,velocity:r,distance:i,displacement:this._displacement,center:e,touches:[this.touchAId,this.touchBId]})},e.prototype.getOptions=function(){return this.options},e.prototype.setOptions=function(t){void 0!==t.scale&&(this.options.scale=t.scale)},i.exports=e},{"./TwoFingerSync":34}],29:[function(t,i){function e(t){n.call(this),this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),this._angle=0,this._previousAngle=0}var n=t("./TwoFingerSync");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.DEFAULT_OPTIONS={scale:1},e.prototype._startUpdate=function(t){this._angle=0,this._previousAngle=n.calculateAngle(this.posA,this.posB);var i=n.calculateCenter(this.posA,this.posB);this._eventOutput.emit("start",{count:t.touches.length,angle:this._angle,center:i,touches:[this.touchAId,this.touchBId]})},e.prototype._moveUpdate=function(t){var i=this.options.scale,e=n.calculateAngle(this.posA,this.posB),s=n.calculateCenter(this.posA,this.posB),o=i*(e-this._previousAngle),r=o/t;this._angle+=o,this._eventOutput.emit("update",{delta:o,velocity:r,angle:this._angle,center:s,touches:[this.touchAId,this.touchBId]}),this._previousAngle=e},e.prototype.getOptions=function(){return this.options},e.prototype.setOptions=function(t){void 0!==t.scale&&(this.options.scale=t.scale)},i.exports=e},{"./TwoFingerSync":34}],30:[function(t,i){function e(t){s.call(this),this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),this._scaleFactor=1,this._startDist=0,this._eventInput.on("pipe",n.bind(this))}function n(){this.touchAId=void 0,this.touchBId=void 0}var s=t("./TwoFingerSync");e.prototype=Object.create(s.prototype),e.prototype.constructor=e,e.DEFAULT_OPTIONS={scale:1},e.prototype._startUpdate=function(t){this._scaleFactor=1,this._startDist=s.calculateDistance(this.posA,this.posB),this._eventOutput.emit("start",{count:t.touches.length,touches:[this.touchAId,this.touchBId],distance:this._startDist,center:s.calculateCenter(this.posA,this.posB)})},e.prototype._moveUpdate=function(t){var i=this.options.scale,e=s.calculateDistance(this.posA,this.posB),n=s.calculateCenter(this.posA,this.posB),o=(e-this._startDist)/this._startDist,r=Math.max(1+i*o,0),a=(r-this._scaleFactor)/t;this._eventOutput.emit("update",{delta:o,scale:r,velocity:a,distance:e,center:n,touches:[this.touchAId,this.touchBId]}),this._scaleFactor=r},e.prototype.getOptions=function(){return this.options},e.prototype.setOptions=function(t){void 0!==t.scale&&(this.options.scale=t.scale)},i.exports=e},{"./TwoFingerSync":34}],31:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),this._payload={delta:null,position:null,velocity:null,slip:!0},this._eventInput=new o,this._eventOutput=new o,o.setInputHandler(this,this._eventInput),o.setOutputHandler(this,this._eventOutput),this._position=void 0===this.options.direction?[0,0]:0,this._prevTime=void 0,this._prevVel=void 0,this._eventInput.on("mousewheel",s.bind(this)),this._eventInput.on("wheel",s.bind(this)),this._inProgress=!1,this._loopBound=!1}function n(){if(this._inProgress&&h()-this._prevTime>this.options.stallTime){this._inProgress=!1;var t=Math.abs(this._prevVel)>=this.options.minimumEndSpeed?this._prevVel:0,i=this._payload;i.position=this._position,i.velocity=t,i.slip=!0,this._eventOutput.emit("end",i)}}function s(t){t.preventDefault(),this._inProgress||(this._inProgress=!0,this._position=void 0===this.options.direction?[0,0]:0,_=this._payload,_.slip=!0,_.position=this._position,_.clientX=t.clientX,_.clientY=t.clientY,_.offsetX=t.offsetX,_.offsetY=t.offsetY,this._eventOutput.emit("start",_),this._loopBound||(r.on("prerender",n.bind(this)),this._loopBound=!0));var i=h(),s=this._prevTime||i,o=void 0!==t.wheelDeltaX?t.wheelDeltaX:-t.deltaX,c=void 0!==t.wheelDeltaY?t.wheelDeltaY:-t.deltaY;1===t.deltaMode&&(o*=this.options.lineHeight,c*=this.options.lineHeight),this.options.rails&&(Math.abs(o)>Math.abs(c)?c=0:o=0);var p,u,l=Math.max(i-s,a),f=o/l,d=c/l,y=this.options.scale;this.options.direction===e.DIRECTION_X?(u=y*o,p=y*f,this._position+=u):this.options.direction===e.DIRECTION_Y?(u=y*c,p=y*d,this._position+=u):(u=[y*o,y*c],p=[y*f,y*d],this._position[0]+=u[0],this._position[1]+=u[1]);var _=this._payload;_.delta=u,_.velocity=p,_.position=this._position,_.slip=!0,this._eventOutput.emit("update",_),this._prevTime=i,this._prevVel=p}var o=t("../core/EventHandler"),r=t("../core/Engine");e.DEFAULT_OPTIONS={direction:void 0,minimumEndSpeed:1/0,rails:!1,scale:1,stallTime:50,lineHeight:40},e.DIRECTION_X=0,e.DIRECTION_Y=1;var a=8,h=Date.now;e.prototype.getOptions=function(){return this.options},e.prototype.setOptions=function(t){void 0!==t.direction&&(this.options.direction=t.direction),void 0!==t.minimumEndSpeed&&(this.options.minimumEndSpeed=t.minimumEndSpeed),void 0!==t.rails&&(this.options.rails=t.rails),void 0!==t.scale&&(this.options.scale=t.scale),void 0!==t.stallTime&&(this.options.stallTime=t.stallTime)},i.exports=e},{"../core/Engine":3,"../core/EventHandler":6}],32:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),this._eventOutput=new a,this._touchTracker=new r,a.setOutputHandler(this,this._eventOutput),a.setInputHandler(this,this._touchTracker),this._touchTracker.on("trackstart",n.bind(this)),this._touchTracker.on("trackmove",s.bind(this)),this._touchTracker.on("trackend",o.bind(this)),this._payload={delta:null,position:null,velocity:null,clientX:void 0,clientY:void 0,count:0,touch:void 0},this._position=null}function n(t){var i,e;void 0!==this.options.direction?(this._position=0,i=0,e=0):(this._position=[0,0],i=[0,0],e=[0,0]);var n=this._payload;n.delta=e,n.position=this._position,n.velocity=i,n.clientX=t.x,n.clientY=t.y,n.count=t.count,n.touch=t.identifier,this._eventOutput.emit("start",n)}function s(t){var i=t.history,n=i[i.length-1],s=i[i.length-2],o=s.timestamp,r=n.timestamp,a=n.x-s.x,c=n.y-s.y;this.options.rails&&(Math.abs(a)>Math.abs(c)?c=0:a=0);var p,u,l=Math.max(r-o,h),f=a/l,d=c/l,y=this.options.scale;this.options.direction===e.DIRECTION_X?(u=y*a,p=y*f,this._position+=u):this.options.direction===e.DIRECTION_Y?(u=y*c,p=y*d,this._position+=u):(u=[y*a,y*c],p=[y*f,y*d],this._position[0]+=u[0],this._position[1]+=u[1]);var _=this._payload;_.delta=u,_.velocity=p,_.position=this._position,_.clientX=t.x,_.clientY=t.y,_.count=t.count,_.touch=t.identifier,this._eventOutput.emit("update",_)}function o(t){this._payload.count=t.count,this._eventOutput.emit("end",this._payload)}var r=t("./TouchTracker"),a=t("../core/EventHandler");e.DEFAULT_OPTIONS={direction:void 0,rails:!1,scale:1},e.DIRECTION_X=0,e.DIRECTION_Y=1;var h=8;e.prototype.setOptions=function(t){void 0!==t.direction&&(this.options.direction=t.direction),void 0!==t.rails&&(this.options.rails=t.rails),void 0!==t.scale&&(this.options.scale=t.scale)},e.prototype.getOptions=function(){return this.options},i.exports=e},{"../core/EventHandler":6,"./TouchTracker":33}],33:[function(t,i){function e(t,i,e){return{x:t.clientX,y:t.clientY,identifier:t.identifier,origin:i.origin,timestamp:c(),count:i.touches.length,history:e}}function n(t){for(var i=0;i<t.changedTouches.length;i++){var n=t.changedTouches[i],s=e(n,t,null);this.eventOutput.emit("trackstart",s),this.selective||this.touchHistory[n.identifier]||this.track(s)}}function s(t){for(var i=0;i<t.changedTouches.length;i++){var n=t.changedTouches[i],s=this.touchHistory[n.identifier];if(s){var o=e(n,t,s);this.touchHistory[n.identifier].push(o),this.eventOutput.emit("trackmove",o)}}}function o(t){for(var i=0;i<t.changedTouches.length;i++){var n=t.changedTouches[i],s=this.touchHistory[n.identifier];if(s){var o=e(n,t,s);this.eventOutput.emit("trackend",o),delete this.touchHistory[n.identifier]}}}function r(){for(var t in this.touchHistory){var i=this.touchHistory[t];this.eventOutput.emit("trackend",{touch:i[i.length-1].touch,timestamp:Date.now(),count:0,history:i}),delete this.touchHistory[t]}}function a(t){this.selective=t,this.touchHistory={},this.eventInput=new h,this.eventOutput=new h,h.setInputHandler(this,this.eventInput),h.setOutputHandler(this,this.eventOutput),this.eventInput.on("touchstart",n.bind(this)),this.eventInput.on("touchmove",s.bind(this)),this.eventInput.on("touchend",o.bind(this)),this.eventInput.on("touchcancel",o.bind(this)),this.eventInput.on("unpipe",r.bind(this))}var h=t("../core/EventHandler"),c=Date.now;a.prototype.track=function(t){this.touchHistory[t.identifier]=[t]},i.exports=a},{"../core/EventHandler":6}],34:[function(t,i){function e(){this._eventInput=new n,this._eventOutput=new n,n.setInputHandler(this,this._eventInput),n.setOutputHandler(this,this._eventOutput),this.touchAEnabled=!1,this.touchAId=0,this.posA=null,this.timestampA=0,this.touchBEnabled=!1,this.touchBId=0,this.posB=null,this.timestampB=0,this._eventInput.on("touchstart",this.handleStart.bind(this)),this._eventInput.on("touchmove",this.handleMove.bind(this)),this._eventInput.on("touchend",this.handleEnd.bind(this)),this._eventInput.on("touchcancel",this.handleEnd.bind(this))}var n=t("../core/EventHandler");e.calculateAngle=function(t,i){var e=i[0]-t[0],n=i[1]-t[1];return Math.atan2(n,e)},e.calculateDistance=function(t,i){var e=i[0]-t[0],n=i[1]-t[1];return Math.sqrt(e*e+n*n)},e.calculateCenter=function(t,i){return[(t[0]+i[0])/2,(t[1]+i[1])/2]};var s=Date.now;e.prototype.handleStart=function(t){for(var i=0;i<t.changedTouches.length;i++){var e=t.changedTouches[i];this.touchAEnabled?this.touchBEnabled||(this.touchBId=e.identifier,this.touchBEnabled=!0,this.posB=[e.pageX,e.pageY],this.timestampB=s(),this._startUpdate(t)):(this.touchAId=e.identifier,this.touchAEnabled=!0,this.posA=[e.pageX,e.pageY],this.timestampA=s())}},e.prototype.handleMove=function(t){if(this.touchAEnabled&&this.touchBEnabled){for(var i,e=this.timestampA,n=this.timestampB,o=0;o<t.changedTouches.length;o++){var r=t.changedTouches[o];r.identifier===this.touchAId?(this.posA=[r.pageX,r.pageY],this.timestampA=s(),i=this.timestampA-e):r.identifier===this.touchBId&&(this.posB=[r.pageX,r.pageY],this.timestampB=s(),i=this.timestampB-n)}i&&this._moveUpdate(i)}},e.prototype.handleEnd=function(t){for(var i=0;i<t.changedTouches.length;i++){var e=t.changedTouches[i];(e.identifier===this.touchAId||e.identifier===this.touchBId)&&(this.touchAEnabled&&this.touchBEnabled&&this._eventOutput.emit("end",{touches:[this.touchAId,this.touchBId],angle:this._angle}),this.touchAEnabled=!1,this.touchAId=0,this.touchBEnabled=!1,this.touchBId=0)}},i.exports=e},{"../core/EventHandler":6}],35:[function(t,i){i.exports={Accumulator:t("./Accumulator"),DesktopEmulationMode:t("./DesktopEmulationMode"),FastClick:t("./FastClick"),GenericSync:t("./GenericSync"),MouseSync:t("./MouseSync"),PinchSync:t("./PinchSync"),RotateSync:t("./RotateSync"),ScaleSync:t("./ScaleSync"),ScrollSync:t("./ScrollSync"),TouchSync:t("./TouchSync"),TouchTracker:t("./TouchTracker"),TwoFingerSync:t("./TwoFingerSync")}},{"./Accumulator":23,"./DesktopEmulationMode":24,"./FastClick":25,"./GenericSync":26,"./MouseSync":27,"./PinchSync":28,"./RotateSync":29,"./ScaleSync":30,"./ScrollSync":31,"./TouchSync":32,"./TouchTracker":33,"./TwoFingerSync":34}],36:[function(t,i){function e(t){return this.values=t||[[1,0,0],[0,1,0],[0,0,1]],this}var n=t("./Vector"),s=new e,o=new n;e.prototype.get=function(){return this.values},e.prototype.set=function(t){this.values=t},e.prototype.vectorMultiply=function(t){var i=this.get(),e=t.x,n=t.y,s=t.z,r=i[0],a=i[1],h=i[2],c=r[0],p=r[1],u=r[2],l=a[0],f=a[1],d=a[2],y=h[0],_=h[1],g=h[2];return o.setXYZ(c*e+p*n+u*s,l*e+f*n+d*s,y*e+_*n+g*s)},e.prototype.multiply=function(t){for(var i=this.get(),e=[[]],n=0;3>n;n++){e[n]=[];for(var o=0;3>o;o++){for(var r=0,a=0;3>a;a++)r+=i[n][a]*t[a][o];e[n][o]=r}}return s.set(e)},e.prototype.transpose=function(){for(var t=[],i=this.get(),e=0;3>e;e++)for(var n=0;3>n;n++)t[e][n]=i[n][e];return s.set(t)},e.prototype.clone=function(){for(var t=this.get(),i=[],n=0;3>n;n++)i[n]=t[n].slice();return new e(i)},i.exports=e},{"./Vector":40}],37:[function(t,i){function e(t,i,e,n){return 1===arguments.length?this.set(t):(this.w=void 0!==t?t:1,this.x=void 0!==i?i:0,this.y=void 0!==e?e:0,this.z=void 0!==n?n:0),this}var n=t("./Matrix"),s=new e(1,0,0,0);e.prototype.add=function(t){return s.setWXYZ(this.w+t.w,this.x+t.x,this.y+t.y,this.z+t.z)},e.prototype.sub=function(t){return s.setWXYZ(this.w-t.w,this.x-t.x,this.y-t.y,this.z-t.z)},e.prototype.scalarDivide=function(t){return this.scalarMultiply(1/t)},e.prototype.scalarMultiply=function(t){return s.setWXYZ(this.w*t,this.x*t,this.y*t,this.z*t)},e.prototype.multiply=function(t){var i=this.x,e=this.y,n=this.z,o=this.w,r=t.x,a=t.y,h=t.z,c=t.w||0;return s.setWXYZ(o*c-i*r-e*a-n*h,i*c+r*o+a*n-e*h,e*c+a*o+i*h-r*n,n*c+h*o+r*e-i*a)};var o=new e(1,0,0,0);e.prototype.rotateVector=function(t){return o.set(this.conj()),s.set(this.multiply(t).multiply(o))},e.prototype.inverse=function(){return s.set(this.conj().scalarDivide(this.normSquared()))},e.prototype.negate=function(){return this.scalarMultiply(-1)},e.prototype.conj=function(){return s.setWXYZ(this.w,-this.x,-this.y,-this.z)},e.prototype.normalize=function(t){return t=void 0===t?1:t,this.scalarDivide(t*this.norm())},e.prototype.makeFromAngleAndAxis=function(t,i){var e=i.normalize(),n=.5*t,s=-Math.sin(n);return this.x=s*e.x,this.y=s*e.y,this.z=s*e.z,this.w=Math.cos(n),this},e.prototype.setWXYZ=function(t,i,e,n){return s.clear(),this.w=t,this.x=i,this.y=e,this.z=n,this},e.prototype.set=function(t){return t instanceof Array?(this.w=t[0],this.x=t[1],this.y=t[2],this.z=t[3]):(this.w=t.w,this.x=t.x,this.y=t.y,this.z=t.z),this!==s&&s.clear(),this},e.prototype.put=function(t){t.set(s)},e.prototype.clone=function(){return new e(this)},e.prototype.clear=function(){return this.w=1,this.x=0,this.y=0,this.z=0,this},e.prototype.isEqual=function(t){return t.w===this.w&&t.x===this.x&&t.y===this.y&&t.z===this.z},e.prototype.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},e.prototype.normSquared=function(){return this.dot(this)},e.prototype.norm=function(){return Math.sqrt(this.normSquared())},e.prototype.isZero=function(){return!(this.x||this.y||this.z)},e.prototype.getTransform=function(){var t=this.normalize(1),i=t.x,e=t.y,n=t.z,s=t.w;return[1-2*e*e-2*n*n,2*i*e-2*n*s,2*i*n+2*e*s,0,2*i*e+2*n*s,1-2*i*i-2*n*n,2*e*n-2*i*s,0,2*i*n-2*e*s,2*e*n+2*i*s,1-2*i*i-2*e*e,0,0,0,0,1]};var r=new n;e.prototype.getMatrix=function(){var t=this.normalize(1),i=t.x,e=t.y,n=t.z,s=t.w;return r.set([[1-2*e*e-2*n*n,2*i*e+2*n*s,2*i*n-2*e*s],[2*i*e-2*n*s,1-2*i*i-2*n*n,2*e*n+2*i*s],[2*i*n+2*e*s,2*e*n-2*i*s,1-2*i*i-2*e*e]])};var a=1e-5;e.prototype.slerp=function(t,i){var e,n,o,r,h;return n=this.dot(t),1-n>a?(e=Math.acos(n),o=Math.sin(e),r=Math.sin((1-i)*e)/o,h=Math.sin(i*e)/o):(r=1-i,h=i),s.set(this.scalarMultiply(r/h).add(t).multiply(h))},i.exports=e},{"./Matrix":36}],38:[function(t,i){function e(t,i){return t+s()*(i-t)}function n(t,i){return t+s()*(i-t+1)>>0}var s=Math.random,o={};o.integer=function(t,i,e){if(t=void 0!==t?t:0,i=void 0!==i?i:1,void 0!==e){for(var s=[],o=0;e>o;o++)s.push(n(t,i));return s}return n(t,i)},o.range=function(t,i,n){if(t=void 0!==t?t:0,i=void 0!==i?i:1,void 0!==n){for(var s=[],o=0;n>o;o++)s.push(e(t,i));return s}return e(t,i)},o.sign=function(t){return t=void 0!==t?t:.5,s()<t?1:-1},o.bool=function(t){return t=void 0!==t?t:.5,s()<t},i.exports=o},{}],39:[function(t,i){var e={};e.clamp=function(t,i){return Math.max(Math.min(t,i[1]),i[0])},e.length=function(t){for(var i=0,e=0;e<t.length;e++)i+=t[e]*t[e];return Math.sqrt(i)},i.exports=e},{}],40:[function(t,i){function e(t,i,e){return 1===arguments.length?this.set(t):(this.x=t||0,this.y=i||0,this.z=e||0),this}function n(t,i,e){return this.x=t,this.y=i,this.z=e,this}function s(t){return n.call(this,t[0],t[1],t[2]||0)}function o(t){return n.call(this,t.x,t.y,t.z)}function r(t){return n.call(this,t,0,0)}var a=new e(0,0,0);e.prototype.add=function(t){return n.call(a,this.x+t.x,this.y+t.y,this.z+t.z)},e.prototype.sub=function(t){return n.call(a,this.x-t.x,this.y-t.y,this.z-t.z)},e.prototype.mult=function(t){return n.call(a,t*this.x,t*this.y,t*this.z)},e.prototype.div=function(t){return this.mult(1/t)},e.prototype.cross=function(t){var i=this.x,e=this.y,s=this.z,o=t.x,r=t.y,h=t.z;return n.call(a,s*r-e*h,i*h-s*o,e*o-i*r)},e.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},e.prototype.rotateX=function(t){var i=this.x,e=this.y,s=this.z,o=Math.cos(t),r=Math.sin(t);return n.call(a,i,e*o-s*r,e*r+s*o)},e.prototype.rotateY=function(t){var i=this.x,e=this.y,s=this.z,o=Math.cos(t),r=Math.sin(t);return n.call(a,s*r+i*o,e,s*o-i*r)},e.prototype.rotateZ=function(t){var i=this.x,e=this.y,s=this.z,o=Math.cos(t),r=Math.sin(t);return n.call(a,i*o-e*r,i*r+e*o,s)},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},e.prototype.normSquared=function(){return this.dot(this)},e.prototype.norm=function(){return Math.sqrt(this.normSquared())},e.prototype.normalize=function(t){0===arguments.length&&(t=1);var i=this.norm();return i>1e-7?o.call(a,this.mult(t/i)):n.call(a,t,0,0)},e.prototype.clone=function(){return new e(this)},e.prototype.isZero=function(){return!(this.x||this.y||this.z)},e.prototype.set=function(t){return t instanceof Array?s.call(this,t):t instanceof e?o.call(this,t):"number"==typeof t?r.call(this,t):void 0},e.prototype.setXYZ=function(){return n.apply(this,arguments)},e.prototype.set1D=function(t){return r.call(this,t)},e.prototype.put=function(t){this===a?o.call(t,a):o.call(t,this)},e.prototype.clear=function(){return n.call(this,0,0,0)},e.prototype.cap=function h(h){if(1/0===h)return o.call(a,this);
var t=this.norm();return t>h?o.call(a,this.mult(h/t)):o.call(a,this)},e.prototype.project=function(t){return t.mult(this.dot(t))},e.prototype.reflectAcross=function(t){return t.normalize().put(t),o(a,this.sub(this.project(t).mult(2)))},e.prototype.get=function(){return[this.x,this.y,this.z]},e.prototype.get1D=function(){return this.x},i.exports=e},{}],41:[function(t,i){i.exports={Matrix:t("./Matrix"),Random:t("./Random"),Quaternion:t("./Quaternion"),Utilities:t("./Utilities"),Vector:t("./Vector")}},{"./Matrix":36,"./Quaternion":37,"./Random":38,"./Utilities":39,"./Vector":40}],42:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),this._positionState=new c([0,0]),this._differential=[0,0],this._active=!0,this.sync=new l(["mouse","touch"],{scale:this.options.scale}),this.eventOutput=new p,p.setInputHandler(this,this.sync),p.setOutputHandler(this,this.eventOutput),a.call(this)}function n(t){var i=this.options,e=i.projection,n=i.snapX,s=i.snapY,o=e&y.x?t[0]:0,r=e&y.y?t[1]:0;return n>0&&(o-=o%n),s>0&&(r-=r%s),[o,r]}function s(){this._active&&(this._positionState.isActive()&&this._positionState.halt(),this.eventOutput.emit("start",{position:this.getPosition()}))}function o(t){if(this._active){var i=this.options;this._differential=t.position;var e=n.call(this,this._differential);this._differential[0]-=e[0],this._differential[1]-=e[1];var s=this.getPosition();if(s[0]+=e[0],s[1]+=e[1],i.xRange){var o=[i.xRange[0]+.5*i.snapX,i.xRange[1]-.5*i.snapX];s[0]=_(s[0],o)}if(i.yRange){var r=[i.yRange[0]+.5*i.snapY,i.yRange[1]-.5*i.snapY];s[1]=_(s[1],r)}this.eventOutput.emit("update",{position:s})}}function r(){this._active&&this.eventOutput.emit("end",{position:this.getPosition()})}function a(){this.sync.on("start",s.bind(this)),this.sync.on("update",o.bind(this)),this.sync.on("end",r.bind(this))}var h=t("../core/Transform"),c=t("../transitions/Transitionable"),p=t("../core/EventHandler"),u=t("../math/Utilities"),l=t("../inputs/GenericSync"),f=t("../inputs/MouseSync"),d=t("../inputs/TouchSync");l.register({mouse:f,touch:d});var y={x:1,y:2};e.DIRECTION_X=y.x,e.DIRECTION_Y=y.y;var _=u.clamp;e.DEFAULT_OPTIONS={projection:y.x|y.y,scale:1,xRange:null,yRange:null,snapX:0,snapY:0,transition:{duration:0}},e.prototype.setOptions=function(t){var i=this.options;if(void 0!==t.projection){var e=t.projection;this.options.projection=0,["x","y"].forEach(function(t){-1!==e.indexOf(t)&&(i.projection|=y[t])})}void 0!==t.scale&&(i.scale=t.scale,this.sync.setOptions({scale:t.scale})),void 0!==t.xRange&&(i.xRange=t.xRange),void 0!==t.yRange&&(i.yRange=t.yRange),void 0!==t.snapX&&(i.snapX=t.snapX),void 0!==t.snapY&&(i.snapY=t.snapY)},e.prototype.getPosition=function(){return this._positionState.get()},e.prototype.setRelativePosition=function(t,i,e){var n=this.getPosition(),s=[n[0]+t[0],n[1]+t[1]];this.setPosition(s,i,e)},e.prototype.setPosition=function(t,i,e){this._positionState.isActive()&&this._positionState.halt(),this._positionState.set(t,i,e)},e.prototype.activate=function(){this._active=!0},e.prototype.deactivate=function(){this._active=!1},e.prototype.toggle=function(){this._active=!this._active},e.prototype.modify=function(t){var i=this.getPosition();return{transform:h.translate(i[0],i[1]),target:t}},i.exports=e},{"../core/EventHandler":6,"../core/Transform":14,"../inputs/GenericSync":26,"../inputs/MouseSync":27,"../inputs/TouchSync":32,"../math/Utilities":39,"../transitions/Transitionable":87}],43:[function(t,i){function e(t,i){this.options=Object.create(e.DEFAULT_OPTIONS),this._optionsManager=new s(this.options),t&&this.setOptions(t),i||(i=0),this.transitionHelper=new n(i)}var n=t("../transitions/Transitionable"),s=t("../core/OptionsManager");e.DEFAULT_OPTIONS={cull:!1,transition:!0,pulseInTransition:!0,pulseOutTransition:!0},e.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},e.prototype.show=function(t,i){t=t||this.options.transition,this.set(1,t,i)},e.prototype.hide=function(t,i){t=t||this.options.transition,this.set(0,t,i)},e.prototype.set=function(t,i,e){this.halt(),this.transitionHelper.set(t,i,e)},e.prototype.halt=function(){this.transitionHelper.halt()},e.prototype.isVisible=function(){return this.transitionHelper.get()>0},e.prototype.modify=function(t){var i=this.transitionHelper.get();return this.options.cull&&!i?void 0:{opacity:i,target:t}},i.exports=e},{"../core/OptionsManager":9,"../transitions/Transitionable":87}],44:[function(t,i){function e(){this._chain=[],arguments.length&&this.addModifier.apply(this,arguments)}e.prototype.addModifier=function(){Array.prototype.push.apply(this._chain,arguments)},e.prototype.removeModifier=function(t){var i=this._chain.indexOf(t);0>i||this._chain.splice(i,1)},e.prototype.modify=function(t){for(var i=this._chain,e=t,n=0;n<i.length;n++)e=i[n].modify(e);return e},i.exports=e},{}],45:[function(t,i){function e(t){this._transformState=new r(s.identity),this._opacityState=new o(1),this._originState=new o([0,0]),this._alignState=new o([0,0]),this._sizeState=new o([0,0]),this._modifier=new n({transform:this._transformState,opacity:this._opacityState,origin:null,align:null,size:null}),this._hasOrigin=!1,this._hasAlign=!1,this._hasSize=!1,t&&(t.transform&&this.setTransform(t.transform),void 0!==t.opacity&&this.setOpacity(t.opacity),t.origin&&this.setOrigin(t.origin),t.align&&this.setAlign(t.align),t.size&&this.setSize(t.size))}var n=t("../core/Modifier"),s=t("../core/Transform"),o=t("../transitions/Transitionable"),r=t("../transitions/TransitionableTransform");e.prototype.setTransform=function(t,i,e){return this._transformState.set(t,i,e),this},e.prototype.setOpacity=function(t,i,e){return this._opacityState.set(t,i,e),this},e.prototype.setOrigin=function(t,i,e){return null===t?(this._hasOrigin&&(this._modifier.originFrom(null),this._hasOrigin=!1),this):(this._hasOrigin||(this._hasOrigin=!0,this._modifier.originFrom(this._originState)),this._originState.set(t,i,e),this)},e.prototype.setAlign=function(t,i,e){return null===t?(this._hasAlign&&(this._modifier.alignFrom(null),this._hasAlign=!1),this):(this._hasAlign||(this._hasAlign=!0,this._modifier.alignFrom(this._alignState)),this._alignState.set(t,i,e),this)},e.prototype.setSize=function(t,i,e){return null===t?(this._hasSize&&(this._modifier.sizeFrom(null),this._hasSize=!1),this):(this._hasSize||(this._hasSize=!0,this._modifier.sizeFrom(this._sizeState)),this._sizeState.set(t,i,e),this)},e.prototype.halt=function(){this._transformState.halt(),this._opacityState.halt(),this._originState.halt(),this._alignState.halt(),this._sizeState.halt()},e.prototype.getTransform=function(){return this._transformState.get()},e.prototype.getFinalTransform=function(){return this._transformState.getFinal()},e.prototype.getOpacity=function(){return this._opacityState.get()},e.prototype.getOrigin=function(){return this._hasOrigin?this._originState.get():null},e.prototype.getAlign=function(){return this._hasAlign?this._alignState.get():null},e.prototype.getSize=function(){return this._hasSize?this._sizeState.get():null},e.prototype.modify=function(t){return this._modifier.modify(t)},i.exports=e},{"../core/Modifier":8,"../core/Transform":14,"../transitions/Transitionable":87,"../transitions/TransitionableTransform":88}],46:[function(t,i){i.exports={Draggable:t("./Draggable"),Fader:t("./Fader"),ModifierChain:t("./ModifierChain"),StateModifier:t("./StateModifier")}},{"./Draggable":42,"./Fader":43,"./ModifierChain":44,"./StateModifier":45}],47:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),this._particles=[],this._bodies=[],this._agents={},this._forces=[],this._constraints=[],this._buffer=0,this._prevTime=S(),this._isSleeping=!1,this._eventHandler=null,this._currAgentId=0,this._hasBodies=!1}function n(t){return t.applyForce?this._forces:t.applyConstraint?this._constraints:void 0}function s(t,i,e){return void 0===i&&(i=this.getParticlesAndBodies()),i instanceof Array||(i=[i]),this._agents[this._currAgentId]={agent:t,targets:i,source:e},n.call(this,t).push(this._currAgentId),this._currAgentId++}function o(t){return this._agents[t]}function r(t){var i=o.call(this,this._forces[t]);i.agent.applyForce(i.targets,i.source)}function a(){for(var t=this._forces.length-1;t>-1;t--)r.call(this,t)}function h(t,i){var e=this._agents[this._constraints[t]];return e.agent.applyConstraint(e.targets,e.source,i)}function c(t){for(var i=0;i<this.options.constraintSteps;){for(var e=this._constraints.length-1;e>-1;e--)h.call(this,e,t);i++}}function p(t,i){t.integrateVelocity(i)}function u(t,i){t.integrateAngularMomentum(i),t.updateAngularVelocity()}function l(t,i){t.integrateOrientation(i)}function f(t,i){t.integratePosition(i),t.emit("update",t)}function d(t){a.call(this,t),this.forEach(p,t),this.forEachBody(u,t),c.call(this,t),this.forEachBody(l,t),this.forEach(f,t)}function y(){var t=0,i=0;return this.forEach(function(e){i=e.getEnergy(),t+=i,i<e.sleepTolerance&&e.sleep()}),t}function _(){for(var t=0,i=this._forces.length-1;i>-1;i--)t+=this._forces[i].getEnergy()||0;return t}function g(){for(var t=0,i=this._constraints.length-1;i>-1;i--)t+=this._constraints[i].getEnergy()||0;return t}var v=t("../core/EventHandler"),m=17,O=1e3/120,T=17;e.DEFAULT_OPTIONS={constraintSteps:1,sleepTolerance:1e-7};var S=function(){return Date.now}();e.prototype.setOptions=function(t){for(var i in t)this.options[i]&&(this.options[i]=t[i])},e.prototype.addBody=function(t){return t._engine=this,t.isBody?(this._bodies.push(t),this._hasBodies=!0):this._particles.push(t),t},e.prototype.removeBody=function(t){var i=t.isBody?this._bodies:this._particles,e=i.indexOf(t);if(e>-1){for(var n=0;n<Object.keys(this._agents).length;n++)this.detachFrom(n,t);i.splice(e,1)}0===this.getBodies().length&&(this._hasBodies=!1)},e.prototype.attach=function(t,i,e){if(t instanceof Array){for(var n=[],o=0;o<t.length;o++)n[o]=s.call(this,t[o],i,e);return n}return s.call(this,t,i,e)},e.prototype.attachTo=function(t,i){o.call(this,t).targets.push(i)},e.prototype.detach=function(t){var i=this.getAgent(t),e=n.call(this,i),s=e.indexOf(t);e.splice(s,1),delete this._agents[t]},e.prototype.detachFrom=function(t,i){var e=o.call(this,t);if(e.source===i)this.detach(t);else{var n=e.targets,s=n.indexOf(i);s>-1&&n.splice(s,1)}},e.prototype.detachAll=function(){this._agents={},this._forces=[],this._constraints=[],this._currAgentId=0},e.prototype.getAgent=function(t){return o.call(this,t).agent},e.prototype.getParticles=function(){return this._particles},e.prototype.getBodies=function(){return this._bodies},e.prototype.getParticlesAndBodies=function(){return this.getParticles().concat(this.getBodies())},e.prototype.forEachParticle=function(t,i){for(var e=this.getParticles(),n=0,s=e.length;s>n;n++)t.call(this,e[n],i)},e.prototype.forEachBody=function(t,i){if(this._hasBodies)for(var e=this.getBodies(),n=0,s=e.length;s>n;n++)t.call(this,e[n],i)},e.prototype.forEach=function(t,i){this.forEachParticle(t,i),this.forEachBody(t,i)},e.prototype.getEnergy=function(){return y.call(this)+_.call(this)+g.call(this)},e.prototype.step=function(){var t=S(),i=t-this._prevTime;this._prevTime=t,O>i||(i>T&&(i=T),d.call(this,m))},e.prototype.isSleeping=function(){return this._isSleeping},e.prototype.sleep=function(){this.emit("end",this),this._isSleeping=!0},e.prototype.wake=function(){this._prevTime=S(),this.emit("start",this),this._isSleeping=!1},e.prototype.emit=function(t,i){null!==this._eventHandler&&this._eventHandler.emit(t,i)},e.prototype.on=function(t,i){null===this._eventHandler&&(this._eventHandler=new v),this._eventHandler.on(t,i)},i.exports=e},{"../core/EventHandler":6}],48:[function(t,i){function e(t){n.call(this,t),t=t||{},this.orientation=new r,this.angularVelocity=new o,this.angularMomentum=new o,this.torque=new o,t.orientation&&this.orientation.set(t.orientation),t.angularVelocity&&this.angularVelocity.set(t.angularVelocity),t.angularMomentum&&this.angularMomentum.set(t.angularMomentum),t.torque&&this.torque.set(t.torque),this.setMomentsOfInertia(),this.angularVelocity.w=0,this.pWorld=new o}var n=t("./Particle"),s=t("../../core/Transform"),o=t("../../math/Vector"),r=t("../../math/Quaternion"),a=t("../../math/Matrix");e.DEFAULT_OPTIONS=n.DEFAULT_OPTIONS,e.DEFAULT_OPTIONS.orientation=[0,0,0,1],e.DEFAULT_OPTIONS.angularVelocity=[0,0,0],e.AXES=n.AXES,e.SLEEP_TOLERANCE=n.SLEEP_TOLERANCE,e.INTEGRATOR=n.INTEGRATOR,e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.isBody=!0,e.prototype.setMass=function(){n.prototype.setMass.apply(this,arguments),this.setMomentsOfInertia()},e.prototype.setMomentsOfInertia=function(){this.inertia=new a,this.inverseInertia=new a},e.prototype.updateAngularVelocity=function(){this.angularVelocity.set(this.inverseInertia.vectorMultiply(this.angularMomentum))},e.prototype.toWorldCoordinates=function(t){return this.pWorld.set(this.orientation.rotateVector(t))},e.prototype.getEnergy=function(){return n.prototype.getEnergy.call(this)+.5*this.inertia.vectorMultiply(this.angularVelocity).dot(this.angularVelocity)},e.prototype.reset=function(t,i,e,s){n.prototype.reset.call(this,t,i),this.angularVelocity.clear(),this.setOrientation(e||[1,0,0,0]),this.setAngularMomentum(s||[0,0,0])},e.prototype.setOrientation=function(t){this.orientation.set(t)},e.prototype.setAngularVelocity=function(t){this.wake(),this.angularVelocity.set(t)},e.prototype.setAngularMomentum=function(t){this.wake(),this.angularMomentum.set(t)},e.prototype.applyForce=function(t,i){n.prototype.applyForce.call(this,t),void 0!==i&&this.applyTorque(i.cross(t))},e.prototype.applyTorque=function(t){this.wake(),this.torque.set(this.torque.add(t))},e.prototype.getTransform=function(){return s.thenMove(this.orientation.getTransform(),s.getTranslate(n.prototype.getTransform.call(this)))},e.prototype._integrate=function(t){n.prototype._integrate.call(this,t),this.integrateAngularMomentum(t),this.updateAngularVelocity(t),this.integrateOrientation(t)},e.prototype.integrateAngularMomentum=function(t){e.INTEGRATOR.integrateAngularMomentum(this,t)},e.prototype.integrateOrientation=function(t){e.INTEGRATOR.integrateOrientation(this,t)},i.exports=e},{"../../core/Transform":14,"../../math/Matrix":36,"../../math/Quaternion":37,"../../math/Vector":40,"./Particle":50}],49:[function(t,i){function e(t){t=t||{},this.setRadius(t.radius||0),n.call(this,t)}var n=t("./Body"),s=t("../../math/Matrix");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.setRadius=function(t){this.radius=t,this.size=[2*this.radius,2*this.radius],this.setMomentsOfInertia()},e.prototype.setMomentsOfInertia=function(){var t=this.mass,i=this.radius;this.inertia=new s([[.25*t*i*i,0,0],[0,.25*t*i*i,0],[0,0,.5*t*i*i]]),this.inverseInertia=new s([[4/(t*i*i),0,0],[0,4/(t*i*i),0],[0,0,2/(t*i*i)]])},i.exports=e},{"../../math/Matrix":36,"./Body":48}],50:[function(t,i){function e(t){t=t||{},this.position=new s,this.velocity=new s,this.force=new s;var i=e.DEFAULT_OPTIONS;this.setPosition(t.position||i.position),this.setVelocity(t.velocity||i.velocity),this.force.set(t.force||[0,0,0]),this.mass=void 0!==t.mass?t.mass:i.mass,this.axis=void 0!==t.axis?t.axis:i.axis,this.inverseMass=1/this.mass,this._isSleeping=!1,this._engine=null,this._eventOutput=null,this._positionGetter=null,this.transform=o.identity.slice(),this._spec={transform:this.transform,target:null}}function n(){this._eventOutput=new r,this._eventOutput.bindThis(this),r.setOutputHandler(this,this._eventOutput)}var s=t("../../math/Vector"),o=t("../../core/Transform"),r=t("../../core/EventHandler"),a=t("../integrators/SymplecticEuler");e.DEFAULT_OPTIONS={position:[0,0,0],velocity:[0,0,0],mass:1,axis:void 0},e.SLEEP_TOLERANCE=1e-7,e.AXES={X:0,Y:1,Z:2},e.INTEGRATOR=new a;var h={start:"start",update:"update",end:"end"},c=function(){return Date.now}();e.prototype.sleep=function(){this._isSleeping||(this.emit(h.end,this),this._isSleeping=!0)},e.prototype.wake=function(){this._isSleeping&&(this.emit(h.start,this),this._isSleeping=!1,this._prevTime=c())},e.prototype.isBody=!1,e.prototype.setPosition=function(t){this.position.set(t)},e.prototype.setPosition1D=function(t){this.position.x=t},e.prototype.getPosition=function(){return this._positionGetter instanceof Function&&this.setPosition(this._positionGetter()),this._engine.step(),this.position.get()},e.prototype.getPosition1D=function(){return this._engine.step(),this.position.x},e.prototype.positionFrom=function(t){this._positionGetter=t},e.prototype.setVelocity=function(t){this.velocity.set(t),this.wake()},e.prototype.setVelocity1D=function(t){this.velocity.x=t,this.wake()},e.prototype.getVelocity=function(){return this.velocity.get()},e.prototype.getVelocity1D=function(){return this.velocity.x},e.prototype.setMass=function(t){this.mass=t,this.inverseMass=1/t},e.prototype.getMass=function(){return this.mass},e.prototype.reset=function(t,i){this.setPosition(t||[0,0,0]),this.setVelocity(i||[0,0,0])},e.prototype.applyForce=function(t){t.isZero()||(this.force.add(t).put(this.force),this.wake())},e.prototype.applyImpulse=function(t){if(!t.isZero()){var i=this.velocity;i.add(t.mult(this.inverseMass)).put(i)}},e.prototype.integrateVelocity=function(t){e.INTEGRATOR.integrateVelocity(this,t)},e.prototype.integratePosition=function(t){e.INTEGRATOR.integratePosition(this,t)},e.prototype._integrate=function(t){this.integrateVelocity(t),this.integratePosition(t)},e.prototype.getEnergy=function(){return.5*this.mass*this.velocity.normSquared()},e.prototype.getTransform=function(){this._engine.step();var t=this.position,i=this.axis,n=this.transform;return void 0!==i&&(i&~e.AXES.X&&(t.x=0),i&~e.AXES.Y&&(t.y=0),i&~e.AXES.Z&&(t.z=0)),n[12]=t.x,n[13]=t.y,n[14]=t.z,n},e.prototype.modify=function(t){var i=this._spec;return i.transform=this.getTransform(),i.target=t,i},e.prototype.emit=function(t,i){this._eventOutput&&this._eventOutput.emit(t,i)},e.prototype.on=function(){return n.call(this),this.on.apply(this,arguments)},e.prototype.removeListener=function(){return n.call(this),this.removeListener.apply(this,arguments)},e.prototype.pipe=function(){return n.call(this),this.pipe.apply(this,arguments)},e.prototype.unpipe=function(){return n.call(this),this.unpipe.apply(this,arguments)},i.exports=e},{"../../core/EventHandler":6,"../../core/Transform":14,"../../math/Vector":40,"../integrators/SymplecticEuler":71}],51:[function(t,i){function e(t){t=t||{},this.size=t.size||[0,0],n.call(this,t)}var n=t("./Body"),s=t("../../math/Matrix");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.setSize=function(t){this.size=t,this.setMomentsOfInertia()},e.prototype.setMomentsOfInertia=function(){var t=this.mass,i=this.size[0],e=this.size[1];this.inertia=new s([[t*e*e/12,0,0],[0,t*i*i/12,0],[0,0,t*(i*i+e*e)/12]]),this.inverseInertia=new s([[12/(t*e*e),0,0],[0,12/(t*i*i),0],[0,0,12/(t*(i*i+e*e))]])},i.exports=e},{"../../math/Matrix":36,"./Body":48}],52:[function(t,i){i.exports={Body:t("./Body"),Circle:t("./Circle"),Particle:t("./Particle"),Rectangle:t("./Rectangle")}},{"./Body":48,"./Circle":49,"./Particle":50,"./Rectangle":51}],53:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),this.normal=new s,this.pDiff=new s,this.vDiff=new s,this.impulse1=new s,this.impulse2=new s,n.call(this)}var n=t("./Constraint"),s=t("../../math/Vector");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.DEFAULT_OPTIONS={restitution:.5,drift:.5,slop:0},e.prototype.setOptions=function(t){for(var i in t)this.options[i]=t[i]},e.prototype.applyConstraint=function(t,i,e){if(void 0!==i)for(var n=i.velocity,s=i.position,o=i.inverseMass,r=i.radius,a=this.options,h=a.drift,c=-a.slop,p=a.restitution,u=this.normal,l=this.pDiff,f=this.vDiff,d=this.impulse1,y=this.impulse2,_=0;_<t.length;_++){var g=t[_];if(g!==i){var v=g.velocity,m=g.position,O=g.inverseMass,T=g.radius;l.set(m.sub(s)),f.set(v.sub(n));var S=l.norm(),w=S-(r+T),b=1/(o+O),E=0;if(0>w){if(u.set(l.normalize()),this._eventOutput){var I={target:g,source:i,overlap:w,normal:u};this._eventOutput.emit("preCollision",I),this._eventOutput.emit("collision",I)}var x=c>=w?((1+p)*u.dot(f)+h/e*(w-c))/(E+e/b):(1+p)*u.dot(f)/(E+e/b);u.mult(e*x).put(d),d.mult(-1).put(y),i.applyImpulse(d),g.applyImpulse(y),this._eventOutput&&this._eventOutput.emit("postCollision",I)}}}},i.exports=e},{"../../math/Vector":40,"./Constraint":54}],54:[function(t,i){function e(){this.options=this.options||{},this._energy=0,this._eventOutput=null}function n(){this._eventOutput=new s,this._eventOutput.bindThis(this),s.setOutputHandler(this,this._eventOutput)}var s=t("../../core/EventHandler");e.prototype.setOptions=function(t){for(var i in t)this.options[i]=t[i]},e.prototype.applyConstraint=function(){},e.prototype.getEnergy=function(){return this._energy},e.prototype.setEnergy=function(t){this._energy=t},e.prototype.on=function(){return n.call(this),this.on.apply(this,arguments)},e.prototype.addListener=function(){return n.call(this),this.addListener.apply(this,arguments)},e.prototype.pipe=function(){return n.call(this),this.pipe.apply(this,arguments)},e.prototype.removeListener=function(){return this.removeListener.apply(this,arguments)},e.prototype.unpipe=function(){return this.unpipe.apply(this,arguments)},i.exports=e},{"../../core/EventHandler":6}],55:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),this.J=new s,this.impulse=new s,n.call(this)}var n=t("./Constraint"),s=t("../../math/Vector");e.prototype=Object.create(n.prototype),e.prototype.constructor=e;var o=1e-7,r=Math.PI;e.DEFAULT_OPTIONS={equation:function(){return 0},plane:function(t,i,e){return e},period:0,dampingRatio:0},e.prototype.setOptions=function(t){for(var i in t)this.options[i]=t[i]},e.prototype.applyConstraint=function(t,i,e){for(var n=this.options,s=this.impulse,a=this.J,h=n.equation,c=n.plane,p=n.dampingRatio,u=n.period,l=0;l<t.length;l++){var f,d,y=t[l],_=y.velocity,g=y.position,v=y.mass;if(0===u)f=0,d=1;else{var m=4*v*r*p/u,O=4*v*r*r/(u*u);f=1/(m+e*O),d=e*O/(m+e*O)}var T=g.x,S=g.y,w=g.z,b=h(T,S,w),E=(h(T+o,g,g)-b)/o,I=(h(T,S+o,g)-b)/o,x=(h(T,S,g+o)-b)/o,C=c(T,S,w),M=(c(T+o,S,w)-C)/o,z=(c(T,S+o,w)-C)/o,F=(c(T,S,w+o)-C)/o;a.setXYZ(E+M,I+z,x+F);var P=d/e*(b+C),N=-(a.dot(_)+P)/(f+e*a.normSquared()/v);s.set(a.mult(e*N)),y.applyImpulse(s)}},i.exports=e},{"../../math/Vector":40,"./Constraint":54}],56:[function(t,i){function e(t){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),t&&this.setOptions(t),this.impulse=new s,this.normal=new s,this.diffP=new s,this.diffV=new s,n.call(this)}var n=t("./Constraint"),s=t("../../math/Vector");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.DEFAULT_OPTIONS={anchor:null,length:0,minLength:0,period:0,dampingRatio:0};var o=Math.PI;e.prototype.setOptions=function(t){t.anchor&&(t.anchor.position instanceof s&&(this.options.anchor=t.anchor.position),t.anchor instanceof s&&(this.options.anchor=t.anchor),t.anchor instanceof Array&&(this.options.anchor=new s(t.anchor))),void 0!==t.length&&(this.options.length=t.length),void 0!==t.dampingRatio&&(this.options.dampingRatio=t.dampingRatio),void 0!==t.period&&(this.options.period=t.period),void 0!==t.minLength&&(this.options.minLength=t.minLength)},e.prototype.setAnchor=function(t){this.options.anchor||(this.options.anchor=new s),this.options.anchor.set(t)},e.prototype.applyConstraint=function(t,i,e){var n,s,r=this.normal,a=this.diffP,h=this.diffV,c=this.impulse,p=this.options,u=p.dampingRatio,l=p.period,f=p.minLength;if(i){var d=i.velocity;n=i.position,s=i.inverseMass}else n=this.options.anchor,s=0;for(var y=this.options.length,_=0;_<t.length;_++){var g=t[_],v=g.velocity,m=g.position,O=g.inverseMass;a.set(m.sub(n)),r.set(a.normalize());var T=a.norm()-y;if(Math.abs(T)<f)return;h.set(i?v.sub(d):v);var S,w,b=1/(O+s);if(0===l)S=0,w=1;else{var E=4*b*o*u/l,I=4*b*o*o/(l*l);S=1/(E+e*I),w=e*I/(E+e*I)}var x=w/e*T,C=-(r.dot(h)+x)/(S+e/b);c.set(r.mult(e*C)),g.applyImpulse(c),i&&i.applyImpulse(c.mult(-1))}},i.exports=e},{"../../math/Vector":40,"./Constraint":54}],57:[function(t,i){function e(t){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),t&&this.setOptions(t),this.pDiff=new o,this.vDiff=new o,this.impulse1=new o,this.impulse2=new o,s.call(this)}function n(t,i,e){return Math.abs(t.dot(i)/e)}var s=t("./Constraint"),o=t("../../math/Vector");e.prototype=Object.create(s.prototype),e.prototype.constructor=e,e.DEFAULT_OPTIONS={period:300,dampingRatio:.1,length:0,anchor:void 0};var r=Math.PI;e.prototype.setOptions=function(t){void 0!==t.anchor&&(t.anchor instanceof o&&(this.options.anchor=t.anchor),t.anchor.position instanceof o&&(this.options.anchor=t.anchor.position),t.anchor instanceof Array&&(this.options.anchor=new o(t.anchor))),void 0!==t.length&&(this.options.length=t.length),void 0!==t.dampingRatio&&(this.options.dampingRatio=t.dampingRatio),void 0!==t.period&&(this.options.period=t.period)},e.prototype.setAnchor=function(t){void 0!==this.options.anchor&&(this.options.anchor=new o),this.options.anchor.set(t)},e.prototype.getEnergy=function(t,i){var e=this.options,n=e.length,s=e.anchor||i.position,o=Math.pow(2*r/e.period,2),a=s.sub(t.position).norm()-n;return.5*o*a*a},e.prototype.applyConstraint=function(t,i,e){for(var s=this.options,o=this.pDiff,a=this.vDiff,h=this.impulse1,c=this.impulse2,p=s.length,u=s.anchor||i.position,l=s.period,f=s.dampingRatio,d=0;d<t.length;d++){var y=t[d],_=y.position,g=y.velocity,v=y.mass,m=y.inverseMass;o.set(_.sub(u));var O,T=o.norm()-p;if(i){var S=i.inverseMass,w=i.velocity;a.set(g.sub(w)),O=1/(m+S)}else a.set(g),O=v;var b,E;if(0===this.options.period)b=0,E=1;else{var I=4*O*r*r/(l*l),x=4*O*r*f/l;E=e*I/(x+e*I),b=1/(x+e*I)}var C=E/e*T;o.normalize(-C).sub(a).mult(e/(b+e/O)).put(h),y.applyImpulse(h),i&&(h.mult(-1).put(c),i.applyImpulse(c)),this.setEnergy(n(h,o,e))}},i.exports=e},{"../../math/Vector":40,"./Constraint":54}],58:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),this.J=new s,this.impulse=new s,n.call(this)}var n=t("./Constraint"),s=t("../../math/Vector");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.DEFAULT_OPTIONS={equation:void 0,period:0,dampingRatio:0};var o=1e-7,r=Math.PI;e.prototype.setOptions=function(t){for(var i in t)this.options[i]=t[i]},e.prototype.applyConstraint=function(t,i,e){for(var n=this.impulse,s=this.J,a=this.options,h=a.equation,c=a.dampingRatio,p=a.period,u=0;u<t.length;u++){var l,f,d=t[u],y=d.velocity,_=d.position,g=d.mass;if(0===p)l=0,f=1;else{var v=4*g*r*c/p,m=4*g*r*r/(p*p);l=1/(v+e*m),f=e*m/(v+e*m)}var O=_.x,T=_.y,S=_.z,w=h(O,T,S),b=(h(O+o,_,_)-w)/o,E=(h(O,T+o,_)-w)/o,I=(h(O,T,_+o)-w)/o;s.setXYZ(b,E,I);var x=f/e*w,C=-(s.dot(y)+x)/(l+e*s.normSquared()/g);n.set(s.mult(e*C)),d.applyImpulse(n)}},i.exports=e},{"../../math/Vector":40,"./Constraint":54}],59:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),this.diff=new h,this.impulse=new h,a.call(this)}function n(t,i){return i.dot(t)}function s(t){var i=this.options.normal,e=this.options.distance;return t.dot(i)+e}function o(t,i,n){var s=t.position,o=t.velocity,r=t.mass,a=this.options.normal,h=this.options.onContact,c=this.options.restitution,p=this.impulse,u=this.options.drift,l=-this.options.slop,f=0;if(this._eventOutput){var d={particle:t,wall:this,overlap:i,normal:a};this._eventOutput.emit("preCollision",d),this._eventOutput.emit("collision",d)}switch(h){case e.ON_CONTACT.REFLECT:var y=l>i?-((1+c)*a.dot(o)+u/n*(i-l))/(r*n+f):-((1+c)*a.dot(o))/(r*n+f);p.set(a.mult(n*y)),t.applyImpulse(p),t.setPosition(s.add(a.mult(-i)))}this._eventOutput&&this._eventOutput.emit("postCollision",d)}function r(t,i){var n=this.options.onContact,s=t.position,o=this.options.normal;n===e.ON_CONTACT.REFLECT&&t.setPosition(s.add(o.mult(-i)))}var a=t("./Constraint"),h=t("../../math/Vector");e.prototype=Object.create(a.prototype),e.prototype.constructor=e,e.ON_CONTACT={REFLECT:0,SILENT:1},e.DEFAULT_OPTIONS={restitution:.5,drift:.5,slop:0,normal:[1,0,0],distance:0,onContact:e.ON_CONTACT.REFLECT},e.prototype.setOptions=function(t){void 0!==t.normal&&(t.normal instanceof h&&(this.options.normal=t.normal.clone()),t.normal instanceof Array&&(this.options.normal=new h(t.normal))),void 0!==t.restitution&&(this.options.restitution=t.restitution),void 0!==t.drift&&(this.options.drift=t.drift),void 0!==t.slop&&(this.options.slop=t.slop),void 0!==t.distance&&(this.options.distance=t.distance),void 0!==t.onContact&&(this.options.onContact=t.onContact)},e.prototype.applyConstraint=function(t,i,e){for(var a=this.options.normal,h=0;h<t.length;h++){var c=t[h],p=c.position,u=c.velocity,l=c.radius||0,f=s.call(this,p.add(a.mult(-l))),d=n.call(this,a,u);0>=f&&(0>d?o.call(this,c,f,e):r.call(this,c,f,e))}},i.exports=e},{"../../math/Vector":40,"./Constraint":54}],60:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),s.call(this,t.sides||this.options.sides),r.call(this)}function n(t,i,n){var s,o=e.SIDES;switch(parseInt(t)){case o.LEFT:s=i[0]*n[0];break;case o.TOP:s=i[1]*n[1];break;case o.FRONT:s=i[2]*n[2];break;case o.RIGHT:s=i[0]*(1-n[0]);break;case o.BOTTOM:s=i[1]*(1-n[1]);break;case o.BACK:s=i[2]*(1-n[2])}return s}function s(t){this.components={};for(var i=this.components,e=0;e<t.length;e++){var s=t[e];i[e]=new a({normal:c[s].clone(),distance:n(s,this.options.size,this.options.origin)})}}function o(t){this.forEach(function(i){i.setOptions(t)});for(var i in t)this.options[i]=t[i]}var r=t("./Constraint"),a=t("./Wall"),h=t("../../math/Vector");e.prototype=Object.create(r.prototype),e.prototype.constructor=e,e.ON_CONTACT=a.ON_CONTACT,e.SIDES={LEFT:0,RIGHT:1,TOP:2,BOTTOM:3,FRONT:4,BACK:5,TWO_DIMENSIONAL:[0,1,2,3],THREE_DIMENSIONAL:[0,1,2,3,4,5]},e.DEFAULT_OPTIONS={sides:e.SIDES.TWO_DIMENSIONAL,size:[window.innerWidth,window.innerHeight,0],origin:[.5,.5,.5],drift:.5,slop:0,restitution:.5,onContact:e.ON_CONTACT.REFLECT};var c={0:new h(1,0,0),1:new h(-1,0,0),2:new h(0,1,0),3:new h(0,-1,0),4:new h(0,0,1),5:new h(0,0,-1)};e.prototype.setOptions=function(t){var i=!1;void 0!==t.restitution&&o.call(this,{restitution:t.restitution}),void 0!==t.drift&&o.call(this,{drift:t.drift}),void 0!==t.slop&&o.call(this,{slop:t.slop}),void 0!==t.onContact&&o.call(this,{onContact:t.onContact}),void 0!==t.size&&(i=!0),void 0!==t.sides&&(this.options.sides=t.sides),void 0!==t.origin&&(i=!0),i&&this.setSize(t.size,t.origin)},e.prototype.setSize=function(t,i){i=i||this.options.origin,i.length<3&&(i[2]=.5),this.forEach(function(e,s){var o=n(s,t,i);e.setOptions({distance:o})}),this.options.size=t,this.options.origin=i},e.prototype.applyConstraint=function(t,i,e){this.forEach(function(n){n.applyConstraint(t,i,e)})},e.prototype.forEach=function(t){var i=this.options.sides;for(var e in this.sides)t(i[e],e)},e.prototype.rotateZ=function(t){this.forEach(function(i){var e=i.options.normal;e.rotateZ(t).put(e)})},e.prototype.rotateX=function(t){this.forEach(function(i){var e=i.options.normal;e.rotateX(t).put(e)})},e.prototype.rotateY=function(t){this.forEach(function(i){var e=i.options.normal;e.rotateY(t).put(e)})},i.exports=e},{"../../math/Vector":40,"./Constraint":54,"./Wall":59}],61:[function(t,i){i.exports={Collision:t("./Collision"),Constraint:t("./Constraint"),Curve:t("./Curve"),Distance:t("./Distance"),Snap:t("./Snap"),Surface:t("./Surface"),Wall:t("./Wall"),Walls:t("./Walls")}},{"./Collision":53,"./Constraint":54,"./Curve":55,"./Distance":56,"./Snap":57,"./Surface":58,"./Wall":59,"./Walls":60}],62:[function(t,i){function e(t){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),t&&this.setOptions(t),n.call(this)}var n=t("./Force");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.FORCE_FUNCTIONS={LINEAR:function(t){return t},QUADRATIC:function(t){return t.mult(t.norm())}},e.DEFAULT_OPTIONS={strength:.01,forceFunction:e.FORCE_FUNCTIONS.LINEAR},e.prototype.applyForce=function(t){for(var i=this.options.strength,e=this.options.forceFunction,n=this.force,s=0;s<t.length;s++){var o=t[s];
e(o.velocity).mult(-i).put(n),o.applyForce(n)}},e.prototype.setOptions=function(t){for(var i in t)this.options[i]=t[i]},i.exports=e},{"./Force":63}],63:[function(t,i){function e(t){this.force=new s(t),this._energy=0,this._eventOutput=null}function n(){this._eventOutput=new o,this._eventOutput.bindThis(this),o.setOutputHandler(this,this._eventOutput)}var s=t("../../math/Vector"),o=t("../../core/EventHandler");e.prototype.setOptions=function(t){for(var i in t)this.options[i]=t[i]},e.prototype.applyForce=function(t){t.applyForce(this.force)},e.prototype.getEnergy=function(){return this._energy},e.prototype.setEnergy=function(t){this._energy=t},e.prototype.on=function(){return n.call(this),this.on.apply(this,arguments)},e.prototype.addListener=function(){return n.call(this),this.addListener.apply(this,arguments)},e.prototype.pipe=function(){return n.call(this),this.pipe.apply(this,arguments)},e.prototype.removeListener=function(){return this.removeListener.apply(this,arguments)},e.prototype.unpipe=function(){return this.unpipe.apply(this,arguments)},i.exports=e},{"../../core/EventHandler":6,"../../math/Vector":40}],64:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),this.disp=new s,n.call(this)}var n=t("./Force"),s=t("../../math/Vector");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.DECAY_FUNCTIONS={LINEAR:function(t,i){return Math.max(1-1/i*t,0)},MORSE:function(t,i){var e=0===i?100:i,n=t+e*(1-Math.log(2));return Math.max(1-Math.pow(1-Math.exp(n/e-1),2),0)},INVERSE:function(t,i){return 1/(1-i+t)},GRAVITY:function(t,i){return 1/(1-i+t*t)}},e.DEFAULT_OPTIONS={strength:1,anchor:void 0,range:[0,1/0],cutoff:0,cap:1/0,decayFunction:e.DECAY_FUNCTIONS.GRAVITY},e.prototype.setOptions=function(t){void 0!==t.anchor&&(t.anchor.position instanceof s&&(this.options.anchor=t.anchor.position),t.anchor instanceof Array&&(this.options.anchor=new s(t.anchor)),delete t.anchor);for(var i in t)this.options[i]=t[i]},e.prototype.applyForce=function(t,i){var e=this.options,n=this.force,s=this.disp,o=e.strength,r=e.anchor||i.position,a=e.cap,h=e.cutoff,c=e.range[0],p=e.range[1],u=e.decayFunction;if(0!==o)for(var l in t){var f=t[l];if(f!==i){var d=f.mass,y=f.position;s.set(y.sub(r));var _=s.norm();p>_&&_>c&&(n.set(s.normalize(o*d*u(_,h)).cap(a)),f.applyForce(n))}}},i.exports=e},{"../../math/Vector":40,"./Force":63}],65:[function(t,i){function e(t){n.call(this,t)}var n=t("./Drag");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.DEFAULT_OPTIONS=n.DEFAULT_OPTIONS,e.FORCE_FUNCTIONS=n.FORCE_FUNCTIONS,e.FORCE_FUNCTIONS={LINEAR:function(t){return t},QUADRATIC:function(t){return t.mult(t.norm())}},e.prototype.applyForce=function(t){for(var i=this.options.strength,e=this.options.forceFunction,n=this.force,s=0;s<t.length;s++){var o=t[s];e(o.angularVelocity).mult(-100*i).put(n),o.applyTorque(n)}},e.prototype.setOptions=function(t){for(var i in t)this.options[i]=t[i]},i.exports=e},{"./Drag":62}],66:[function(t,i){function e(t){n.call(this,t)}var n=t("./Spring");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.DEFAULT_OPTIONS=n.DEFAULT_OPTIONS,e.FORCE_FUNCTIONS=n.FORCE_FUNCTIONS,e.prototype.applyForce=function(t){for(var i=this.force,e=this.options,n=this.disp,s=e.stiffness,o=e.damping,r=e.length,a=e.anchor,h=0;h<t.length;h++){var c=t[h];n.set(a.sub(c.orientation));var p=n.norm()-r;if(0===p)return;var u=c.mass;s*=u,o*=u,i.set(n.normalize(s*this.forceFunction(p,this.options.lMax))),o&&i.set(i.add(c.angularVelocity.mult(-o))),c.applyTorque(i)}},e.prototype.getEnergy=function(t){var i=this.options,e=i.length,n=i.anchor,s=i.stiffness,o=n.sub(t.orientation).norm()-e;return.5*s*o*o},i.exports=e},{"./Spring":67}],67:[function(t,i){function e(t){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),t&&this.setOptions(t),this.disp=new c(0,0,0),a.call(this),h.call(this)}function n(t){this.forceFunction=t}function s(){var t=this.options;t.stiffness=Math.pow(2*p/t.period,2)}function o(){var t=this.options;t.damping=4*p*t.dampingRatio/t.period}function r(t,i){return.5*t*i*i}function a(){n.call(this,this.options.forceFunction),s.call(this),o.call(this)}var h=t("./Force"),c=t("../../math/Vector");e.prototype=Object.create(h.prototype),e.prototype.constructor=e;var p=Math.PI;e.FORCE_FUNCTIONS={FENE:function(t,i){var e=.99*i,n=Math.max(Math.min(t,e),-e);return n/(1-n*n/(i*i))},HOOK:function(t){return t}},e.DEFAULT_OPTIONS={period:300,dampingRatio:.1,length:0,maxLength:1/0,anchor:void 0,forceFunction:e.FORCE_FUNCTIONS.HOOK},e.prototype.setOptions=function(t){void 0!==t.anchor&&(t.anchor.position instanceof c&&(this.options.anchor=t.anchor.position),t.anchor instanceof c&&(this.options.anchor=t.anchor),t.anchor instanceof Array&&(this.options.anchor=new c(t.anchor))),void 0!==t.period&&(this.options.period=t.period),void 0!==t.dampingRatio&&(this.options.dampingRatio=t.dampingRatio),void 0!==t.length&&(this.options.length=t.length),void 0!==t.forceFunction&&(this.options.forceFunction=t.forceFunction),void 0!==t.maxLength&&(this.options.maxLength=t.maxLength),a.call(this)},e.prototype.applyForce=function(t,i){for(var e=this.force,n=this.disp,s=this.options,o=s.stiffness,a=s.damping,h=s.length,c=s.maxLength,p=s.anchor||i.position,u=0;u<t.length;u++){var l=t[u],f=l.position,d=l.velocity;p.sub(f).put(n);var y=n.norm()-h;if(0===y)return;var _=l.mass;o*=_,a*=_,n.normalize(o*this.forceFunction(y,c)).put(e),a&&(i?e.add(d.sub(i.velocity).mult(-a)).put(e):e.add(d.mult(-a)).put(e)),l.applyForce(e),i&&i.applyForce(e.mult(-1)),this.setEnergy(r(o,y))}},e.prototype.getEnergy=function(t){var i=this.options,e=i.length,n=i.anchor,s=i.stiffness,o=n.sub(t.position).norm()-e;return.5*s*o*o},e.prototype.setAnchor=function(t){this.options.anchor||(this.options.anchor=new c),this.options.anchor.set(t)},i.exports=e},{"../../math/Vector":40,"./Force":63}],68:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),n.call(this,this.options.field),o.call(this),this.evaluation=new r(0,0,0)}function n(t){var i=e.FIELDS;switch(t){case i.CONSTANT:this.options.direction||(this.options.direction=new r(0,1,0));break;case i.POINT_ATTRACTOR:this.options.position||(this.options.position=new r(0,0,0));break;case i.SPHERE_ATTRACTOR:this.options.radius||(this.options.radius=1)}}function s(t){var i=this.evaluation,e=this.options.field;return i.set(t),e(i,this.options)}var o=t("./Force"),r=t("../../math/Vector");e.prototype=Object.create(o.prototype),e.prototype.constructor=e,e.FIELDS={CONSTANT:function(t,i){return t.set(i.direction)},LINEAR:function(t){return t},RADIAL:function(t){return t.set(t.mult(-1,t))},SPHERE_ATTRACTOR:function(t,i){return t.set(t.mult((i.radius-t.norm())/t.norm()))},POINT_ATTRACTOR:function(t,i){return t.set(i.position.sub(t))}},e.DEFAULT_OPTIONS={strength:1,field:e.FIELDS.CONSTANT},e.prototype.setOptions=function(t){for(var i in t)this.options[i]=t[i]},e.prototype.applyForce=function(t){for(var i=this.force,e=0;e<t.length;e++){var n=t[e];i.set(s.call(this,n.position).mult(n.mass*this.options.strength)),n.applyForce(i)}},i.exports=e},{"../../math/Vector":40,"./Force":63}],69:[function(t,i){i.exports={Drag:t("./Drag"),Force:t("./Force"),Repulsion:t("./Repulsion"),RotationalDrag:t("./RotationalDrag"),RotationalSpring:t("./RotationalSpring"),Spring:t("./Spring"),VectorField:t("./VectorField")}},{"./Drag":62,"./Force":63,"./Repulsion":64,"./RotationalDrag":65,"./RotationalSpring":66,"./Spring":67,"./VectorField":68}],70:[function(t,i){i.exports={PhysicsEngine:t("./PhysicsEngine"),bodies:t("./bodies"),integrators:t("./integrators"),forces:t("./forces"),constraints:t("./constraints")}},{"./PhysicsEngine":47,"./bodies":52,"./constraints":61,"./forces":69,"./integrators":72}],71:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),this._optionsManager=new n(this.options),t&&this.setOptions(t)}var n=t("../../core/OptionsManager");e.DEFAULT_OPTIONS={velocityCap:void 0,angularVelocityCap:void 0},e.prototype.setOptions=function(t){this._optionsManager.patch(t)},e.prototype.getOptions=function(){return this._optionsManager.value()},e.prototype.integrateVelocity=function(t,i){var e=t.velocity,n=t.inverseMass,s=t.force;s.isZero()||(e.add(s.mult(i*n)).put(e),s.clear())},e.prototype.integratePosition=function(t,i){var e=t.position,n=t.velocity;this.options.velocityCap&&n.cap(this.options.velocityCap).put(n),e.add(n.mult(i)).put(e)},e.prototype.integrateAngularMomentum=function(t,i){var e=t.angularMomentum,n=t.torque;n.isZero()||(this.options.angularVelocityCap&&n.cap(this.options.angularVelocityCap).put(n),e.add(n.mult(i)).put(e),n.clear())},e.prototype.integrateOrientation=function(t,i){var e=t.orientation,n=t.angularVelocity;n.isZero()||e.add(e.multiply(n).scalarMultiply(.5*i)).put(e)},i.exports=e},{"../../core/OptionsManager":9}],72:[function(t,i){i.exports={SymplecticEuler:t("./SymplecticEuler")}},{"./SymplecticEuler":71}],73:[function(t,i){function e(t){t&&t.canvasSize&&(this._canvasSize=t.canvasSize),n.apply(this,arguments),this._canvasSize||(this._canvasSize=this.getSize()),this._backBuffer=document.createElement("canvas"),this._canvasSize&&(this._backBuffer.width=this._canvasSize[0],this._backBuffer.height=this._canvasSize[1]),this._contextId=void 0}var n=t("../core/Surface");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.elementType="canvas",e.prototype.elementClass="famous-surface",e.prototype.setContent=function(){},e.prototype.deploy=function(t){this._canvasSize&&(t.width=this._canvasSize[0],t.height=this._canvasSize[1]),"2d"===this._contextId&&(t.getContext(this._contextId).drawImage(this._backBuffer,0,0),this._backBuffer.width=0,this._backBuffer.height=0)},e.prototype.recall=function(t){this.getSize();this._backBuffer.width=t.width,this._backBuffer.height=t.height,"2d"===this._contextId&&(this._backBuffer.getContext(this._contextId).drawImage(t,0,0),t.width=0,t.height=0)},e.prototype.getContext=function(t){return this._contextId=t,this._currTarget?this._currTarget.getContext(t):this._backBuffer.getContext(t)},e.prototype.setSize=function(t,i){n.prototype.setSize.apply(this,arguments),i&&(this._canvasSize=[i[0],i[1]]),this._currTarget&&(this._currTarget.width=this._canvasSize[0],this._currTarget.height=this._canvasSize[1])},i.exports=e},{"../core/Surface":13}],74:[function(t,i){function e(t){n.call(this,t),this._container=document.createElement("div"),this._container.classList.add("famous-group"),this._container.classList.add("famous-container-group"),this._shouldRecalculateSize=!1,this.context=new s(this._container),this.setContent(this._container)}var n=t("../core/Surface"),s=t("../core/Context");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.elementType="div",e.prototype.elementClass="famous-surface",e.prototype.add=function(){return this.context.add.apply(this.context,arguments)},e.prototype.render=function(){return this._sizeDirty&&(this._shouldRecalculateSize=!0),n.prototype.render.apply(this,arguments)},e.prototype.deploy=function(){return this._shouldRecalculateSize=!0,n.prototype.deploy.apply(this,arguments)},e.prototype.commit=function(){var t=this._size?[this._size[0],this._size[1]]:null,i=n.prototype.commit.apply(this,arguments);return(this._shouldRecalculateSize||t&&(this._size[0]!==t[0]||this._size[1]!==t[1]))&&(this.context.setSize(),this._shouldRecalculateSize=!1),this.context.update(),i},i.exports=e},{"../core/Context":1,"../core/Surface":13}],75:[function(t,i){function e(t){t&&(this._method=t.method||""),n.apply(this,arguments)}var n=t("./ContainerSurface");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.elementType="form",e.prototype.deploy=function(t){return this._method&&(t.method=this._method),n.prototype.deploy.apply(this,arguments)},i.exports=e},{"./ContainerSurface":74}],76:[function(t,i){function e(){this._imageUrl=void 0,n.apply(this,arguments)}var n=t("../core/Surface");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.elementType="img",e.prototype.elementClass="famous-surface",e.prototype.setContent=function(t){this._imageUrl=t,this._contentDirty=!0},e.prototype.deploy=function(t){t.src=this._imageUrl||""},e.prototype.recall=function(t){t.src=""},i.exports=e},{"../core/Surface":13}],77:[function(t,i){function e(t){this._placeholder=t.placeholder||"",this._value=t.value||"",this._type=t.type||"text",this._name=t.name||"",n.apply(this,arguments),this.on("click",this.focus.bind(this)),window.addEventListener("click",function(t){t.target!==this._currTarget&&this.blur()}.bind(this))}var n=t("../core/Surface");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.elementType="input",e.prototype.elementClass="famous-surface",e.prototype.setPlaceholder=function(t){return this._placeholder=t,this._contentDirty=!0,this},e.prototype.focus=function(){return this._currTarget&&this._currTarget.focus(),this},e.prototype.blur=function(){return this._currTarget&&this._currTarget.blur(),this},e.prototype.setValue=function(t){return this._value=t,this._contentDirty=!0,this},e.prototype.setType=function(t){return this._type=t,this._contentDirty=!0,this},e.prototype.getValue=function(){return this._currTarget?this._currTarget.value:this._value},e.prototype.setName=function(t){return this._name=t,this._contentDirty=!0,this},e.prototype.getName=function(){return this._name},e.prototype.deploy=function(t){""!==this._placeholder&&(t.placeholder=this._placeholder),t.value=this._value,t.type=this._type,t.name=this._name},i.exports=e},{"../core/Surface":13}],78:[function(t,i){function e(t){n.apply(this,arguments),this._type="submit",t&&t.onClick&&this.setOnClick(t.onClick)}var n=t("./InputSurface");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.setOnClick=function(t){this.onClick=t},e.prototype.deploy=function(t){this.onclick&&(t.onClick=this.onClick),n.prototype.deploy.apply(this,arguments)},i.exports=e},{"./InputSurface":77}],79:[function(t,i){function e(t){this._placeholder=t.placeholder||"",this._value=t.value||"",this._name=t.name||"",this._wrap=t.wrap||"",this._cols=t.cols||"",this._rows=t.rows||"",n.apply(this,arguments),this.on("click",this.focus.bind(this))}var n=t("../core/Surface");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.elementType="textarea",e.prototype.elementClass="famous-surface",e.prototype.setPlaceholder=function(t){return this._placeholder=t,this._contentDirty=!0,this},e.prototype.focus=function(){return this._currTarget&&this._currTarget.focus(),this},e.prototype.blur=function(){return this._currTarget&&this._currTarget.blur(),this},e.prototype.setValue=function(t){return this._value=t,this._contentDirty=!0,this},e.prototype.getValue=function(){return this._currTarget?this._currTarget.value:this._value},e.prototype.setName=function(t){return this._name=t,this._contentDirty=!0,this},e.prototype.getName=function(){return this._name},e.prototype.setWrap=function(t){return this._wrap=t,this._contentDirty=!0,this},e.prototype.setColumns=function(t){return this._cols=t,this._contentDirty=!0,this},e.prototype.setRows=function(t){return this._rows=t,this._contentDirty=!0,this},e.prototype.deploy=function(t){""!==this._placeholder&&(t.placeholder=this._placeholder),""!==this._value&&(t.value=this._value),""!==this._name&&(t.name=this._name),""!==this._wrap&&(t.wrap=this._wrap),""!==this._cols&&(t.cols=this._cols),""!==this._rows&&(t.rows=this._rows)},i.exports=e},{"../core/Surface":13}],80:[function(t,i){function e(t){this._videoUrl=void 0,this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),n.apply(this,arguments)}var n=t("../core/Surface");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.DEFAULT_OPTIONS={autoplay:!1},e.prototype.elementType="video",e.prototype.elementClass="famous-surface",e.prototype.setOptions=function(t){for(var i in e.DEFAULT_OPTIONS)void 0!==t[i]&&(this.options[i]=t[i])},e.prototype.setContent=function(t){this._videoUrl=t,this._contentDirty=!0},e.prototype.deploy=function(t){t.src=this._videoUrl,t.autoplay=this.options.autoplay},e.prototype.recall=function(t){t.src=""},i.exports=e},{"../core/Surface":13}],81:[function(t,i){i.exports={CanvasSurface:t("./CanvasSurface"),ContainerSurface:t("./ContainerSurface"),FormContainerSurface:t("./FormContainerSurface"),ImageSurface:t("./ImageSurface"),InputSurface:t("./InputSurface"),SubmitInputSurface:t("./SubmitInputSurface"),TextareaSurface:t("./TextareaSurface"),VideoSurface:t("./VideoSurface")}},{"./CanvasSurface":73,"./ContainerSurface":74,"./FormContainerSurface":75,"./ImageSurface":76,"./InputSurface":77,"./SubmitInputSurface":78,"./TextareaSurface":79,"./VideoSurface":80}],82:[function(t,i){function e(t){this._map=t||null,this._cachedOutput=null,this._cachedInput=Number.NaN}e.create=function(t){var i=new e(t);return i.get.bind(i)},e.prototype.get=function(t){return t!==this._cachedInput&&(this._cachedInput=t,this._cachedOutput=this._map(t)),this._cachedOutput},i.exports=e},{}],83:[function(t,i){var e={inQuad:function(t){return t*t},outQuad:function(t){return-(t-=1)*t+1},inOutQuad:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},inCubic:function(t){return t*t*t},outCubic:function(t){return--t*t*t+1},inOutCubic:function(t){return(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},inQuart:function(t){return t*t*t*t},outQuart:function(t){return-(--t*t*t*t-1)},inOutQuart:function(t){return(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},inQuint:function(t){return t*t*t*t*t},outQuint:function(t){return--t*t*t*t*t+1},inOutQuint:function(t){return(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},inSine:function(t){return-1*Math.cos(t*(Math.PI/2))+1},outSine:function(t){return Math.sin(t*(Math.PI/2))},inOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},inExpo:function(t){return 0===t?0:Math.pow(2,10*(t-1))},outExpo:function(t){return 1===t?1:-Math.pow(2,-10*t)+1},inOutExpo:function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*--t)+2)},inCirc:function(t){return-(Math.sqrt(1-t*t)-1)},outCirc:function(t){return Math.sqrt(1- --t*t)},inOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},inElastic:function(t){var i=1.70158,e=0,n=1;return 0===t?0:1===t?1:(e||(e=.3),i=e/(2*Math.PI)*Math.asin(1/n),-(n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-i)*Math.PI/e)))},outElastic:function(t){var i=1.70158,e=0,n=1;return 0===t?0:1===t?1:(e||(e=.3),i=e/(2*Math.PI)*Math.asin(1/n),n*Math.pow(2,-10*t)*Math.sin(2*(t-i)*Math.PI/e)+1)},inOutElastic:function(t){var i=1.70158,e=0,n=1;return 0===t?0:2===(t/=.5)?1:(e||(e=.3*1.5),i=e/(2*Math.PI)*Math.asin(1/n),1>t?-.5*n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-i)*Math.PI/e):n*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-i)*Math.PI/e)*.5+1)},inBack:function(t,i){return void 0===i&&(i=1.70158),t*t*((i+1)*t-i)},outBack:function(t,i){return void 0===i&&(i=1.70158),--t*t*((i+1)*t+i)+1},inOutBack:function(t,i){return void 0===i&&(i=1.70158),(t/=.5)<1?.5*t*t*(((i*=1.525)+1)*t-i):.5*((t-=2)*t*(((i*=1.525)+1)*t+i)+2)},inBounce:function(t){return 1-e.outBounce(1-t)},outBounce:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},inOutBounce:function(t){return.5>t?.5*e.inBounce(2*t):.5*e.outBounce(2*t-1)+.5}};i.exports=e},{}],84:[function(t,i){function e(t){this.method=t,this._instances=[],this.state=[]}var n=t("../utilities/Utility");e.SUPPORTS_MULTIPLE=!0,e.prototype.get=function(){for(var t=0;t<this._instances.length;t++)this.state[t]=this._instances[t].get();return this.state},e.prototype.set=function(t,i,e){for(var s=n.after(t.length,e),o=0;o<t.length;o++)this._instances[o]||(this._instances[o]=new this.method),this._instances[o].set(t[o],i,s)},e.prototype.reset=function(t){for(var i=0;i<t.length;i++)this._instances[i]||(this._instances[i]=new this.method),this._instances[i].reset(t[i])},i.exports=e},{"../utilities/Utility":94}],85:[function(t,i){function e(t){t=t||0,this.endState=new v(t),this.initState=new v,this._dimensions=1,this._restTolerance=1e-10,this._absRestTolerance=this._restTolerance,this._callback=void 0,this.PE=new y,this.particle=new _,this.spring=new g({anchor:this.endState}),this.PE.addBody(this.particle),this.PE.attach(this.spring,this.particle)}function n(){return this.particle.getEnergy()+this.spring.getEnergy(this.particle)}function s(){var t=this.endState.sub(this.initState).normSquared();this._absRestTolerance=0===t?this._restTolerance:this._restTolerance*t}function o(t){this.endState.set(t),s.call(this)}function r(){this.PE.wake()}function a(){this.PE.sleep()}function h(t){this.particle.position.set(t)}function c(t){this.particle.velocity.set(t)}function p(){return 0===this._dimensions?this.particle.getPosition1D():this.particle.getPosition()}function u(){return 0===this._dimensions?this.particle.getVelocity1D():this.particle.getVelocity()}function l(t){this._callback=t}function f(t){var i=e.DEFAULT_OPTIONS;void 0===t.period&&(t.period=i.period),void 0===t.dampingRatio&&(t.dampingRatio=i.dampingRatio),void 0===t.velocity&&(t.velocity=i.velocity),this.spring.setOptions({period:t.period,dampingRatio:t.dampingRatio}),c.call(this,t.velocity)}function d(){if(this.PE.isSleeping()){if(this._callback){var t=this._callback;this._callback=void 0,t()}}else n.call(this)<this._absRestTolerance&&(h.call(this,this.endState),c.call(this,[0,0,0]),a.call(this))}var y=t("../physics/PhysicsEngine"),_=t("../physics/bodies/Particle"),g=t("../physics/constraints/Snap"),v=t("../math/Vector");e.SUPPORTS_MULTIPLE=3,e.DEFAULT_OPTIONS={period:100,dampingRatio:.2,velocity:0},e.prototype.reset=function(t,i){this._dimensions=t instanceof Array?t.length:0,this.initState.set(t),h.call(this,t),o.call(this,t),i&&c.call(this,i),l.call(this,void 0)},e.prototype.getVelocity=function(){return u.call(this)},e.prototype.setVelocity=function(t){this.call(this,c(t))},e.prototype.isActive=function(){return!this.PE.isSleeping()},e.prototype.halt=function(){this.set(this.get())},e.prototype.get=function(){return d.call(this),p.call(this)},e.prototype.set=function(t,i,e){return i?(this._dimensions=t instanceof Array?t.length:0,r.call(this),f.call(this,i),o.call(this,t),void l.call(this,e)):(this.reset(t),void(e&&e()))},i.exports=e},{"../math/Vector":40,"../physics/PhysicsEngine":47,"../physics/bodies/Particle":50,"../physics/constraints/Snap":57}],86:[function(t,i){function e(t){t=t||0,this.endState=new v(t),this.initState=new v,this._dimensions=void 0,this._restTolerance=1e-10,this._absRestTolerance=this._restTolerance,this._callback=void 0,this.PE=new y,this.spring=new g({anchor:this.endState}),this.particle=new _,this.PE.addBody(this.particle),this.PE.attach(this.spring,this.particle)}function n(){return this.particle.getEnergy()+this.spring.getEnergy(this.particle)}function s(t){this.particle.setPosition(t)}function o(t){this.particle.setVelocity(t)}function r(){return 0===this._dimensions?this.particle.getPosition1D():this.particle.getPosition()}function a(){return 0===this._dimensions?this.particle.getVelocity1D():this.particle.getVelocity()}function h(t){this._callback=t}function c(){this.PE.wake()}function p(){this.PE.sleep()}function u(){if(this.PE.isSleeping()){if(this._callback){var t=this._callback;this._callback=void 0,t()}}else n.call(this)<this._absRestTolerance&&(s.call(this,this.endState),o.call(this,[0,0,0]),p.call(this))}function l(t){var i=e.DEFAULT_OPTIONS;void 0===t.period&&(t.period=i.period),void 0===t.dampingRatio&&(t.dampingRatio=i.dampingRatio),void 0===t.velocity&&(t.velocity=i.velocity),t.period<150&&(t.period=150,console.warn("The period of a SpringTransition is capped at 150 ms. Use a SnapTransition for faster transitions")),this.spring.setOptions({period:t.period,dampingRatio:t.dampingRatio}),o.call(this,t.velocity)}function f(){var t=this.endState.sub(this.initState).normSquared();this._absRestTolerance=0===t?this._restTolerance:this._restTolerance*t}function d(t){this.endState.set(t),f.call(this)}var y=t("../physics/PhysicsEngine"),_=t("../physics/bodies/Particle"),g=t("../physics/forces/Spring"),v=t("../math/Vector");e.SUPPORTS_MULTIPLE=3,e.DEFAULT_OPTIONS={period:300,dampingRatio:.5,velocity:0},e.prototype.reset=function(t,i){this._dimensions=t instanceof Array?t.length:0,this.initState.set(t),s.call(this,t),d.call(this,t),i&&o.call(this,i),h.call(this,void 0)},e.prototype.getVelocity=function(){return a.call(this)},e.prototype.setVelocity=function(t){this.call(this,o(t))},e.prototype.isActive=function(){return!this.PE.isSleeping()},e.prototype.halt=function(){this.set(this.get())},e.prototype.get=function(){return u.call(this),r.call(this)},e.prototype.set=function(t,i,e){return i?(this._dimensions=t instanceof Array?t.length:0,c.call(this),l.call(this,i),d.call(this,t),void h.call(this,e)):(this.reset(t),void(e&&e()))},i.exports=e},{"../math/Vector":40,"../physics/PhysicsEngine":47,"../physics/bodies/Particle":50,"../physics/forces/Spring":67}],87:[function(t,i){function e(t){this.currentAction=null,this.actionQueue=[],this.callbackQueue=[],this.state=0,this.velocity=void 0,this._callback=void 0,this._engineInstance=null,this._currentMethod=null,this.set(t)}function n(){if(this._callback){var t=this._callback;this._callback=void 0,t()}if(this.actionQueue.length<=0)return void this.set(this.get());this.currentAction=this.actionQueue.shift(),this._callback=this.callbackQueue.shift();var i=null,e=this.currentAction[0],a=this.currentAction[1];a instanceof Object&&a.method?(i=a.method,"string"==typeof i&&(i=r[i])):i=o,this._currentMethod!==i&&(this._engineInstance=!(e instanceof Object)||i.SUPPORTS_MULTIPLE===!0||e.length<=i.SUPPORTS_MULTIPLE?new i:new s(i),this._currentMethod=i),this._engineInstance.reset(this.state,this.velocity),void 0!==this.velocity&&(a.velocity=this.velocity),this._engineInstance.set(e,a,n.bind(this))}var s=t("./MultipleTransition"),o=t("./TweenTransition"),r={};e.registerMethod=function(t,i){return t in r?!1:(r[t]=i,!0)},e.unregisterMethod=function(t){return t in r?(delete r[t],!0):!1},e.prototype.set=function(t,i,e){if(!i)return this.reset(t),e&&e(),this;var s=[t,i];return this.actionQueue.push(s),this.callbackQueue.push(e),this.currentAction||n.call(this),this},e.prototype.reset=function(t,i){this._currentMethod=null,this._engineInstance=null,this._callback=void 0,this.state=t,this.velocity=i,this.currentAction=null,this.actionQueue=[],this.callbackQueue=[]},e.prototype.delay=function(t,i){this.set(this.get(),{duration:t,curve:function(){return 0}},i)},e.prototype.get=function(t){return this._engineInstance&&(this._engineInstance.getVelocity&&(this.velocity=this._engineInstance.getVelocity()),this.state=this._engineInstance.get(t)),this.state},e.prototype.isActive=function(){return!!this.currentAction},e.prototype.halt=function(){this.set(this.get())},i.exports=e},{"./MultipleTransition":84,"./TweenTransition":89}],88:[function(t,i){function e(t){this._final=o.identity.slice(),this.translate=new s([0,0,0]),this.rotate=new s([0,0,0]),this.skew=new s([0,0,0]),this.scale=new s([1,1,1]),t&&this.set(t)}function n(){return o.build({translate:this.translate.get(),rotate:this.rotate.get(),skew:this.skew.get(),scale:this.scale.get()})}var s=t("./Transitionable"),o=t("../core/Transform"),r=t("../utilities/Utility");e.prototype.setTranslate=function(t,i,e){return this.translate.set(t,i,e),this._final=this._final.slice(),this._final[12]=t[0],this._final[13]=t[1],void 0!==t[2]&&(this._final[14]=t[2]),this},e.prototype.setScale=function(t,i,e){return this.scale.set(t,i,e),this._final=this._final.slice(),this._final[0]=t[0],this._final[5]=t[1],void 0!==t[2]&&(this._final[10]=t[2]),this},e.prototype.setRotate=function(t,i,e){return this.rotate.set(t,i,e),this._final=n.call(this),this._final=o.build({translate:this.translate.get(),rotate:t,scale:this.scale.get(),skew:this.skew.get()}),this},e.prototype.setSkew=function(t,i,e){return this.skew.set(t,i,e),this._final=o.build({translate:this.translate.get(),rotate:this.rotate.get(),scale:this.scale.get(),skew:t}),this},e.prototype.set=function(t,i,e){this._final=t;var n=o.interpret(t),s=e?r.after(4,e):null;return this.translate.set(n.translate,i,s),this.rotate.set(n.rotate,i,s),this.skew.set(n.skew,i,s),this.scale.set(n.scale,i,s),this},e.prototype.setDefaultTransition=function(t){this.translate.setDefault(t),this.rotate.setDefault(t),this.skew.setDefault(t),this.scale.setDefault(t)},e.prototype.get=function(){return this.isActive()?n.call(this):this._final},e.prototype.getFinal=function(){return this._final},e.prototype.isActive=function(){return this.translate.isActive()||this.rotate.isActive()||this.scale.isActive()||this.skew.isActive()},e.prototype.halt=function(){this._final=this.get(),this.translate.halt(),this.rotate.halt(),this.skew.halt(),this.scale.halt()},i.exports=e},{"../core/Transform":14,"../utilities/Utility":94,"./Transitionable":87}],89:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),t&&this.setOptions(t),this._startTime=0,this._startValue=0,this._updateTime=0,this._endValue=0,this._curve=void 0,this._duration=0,this._active=!1,this._callback=void 0,this.state=0,this.velocity=void 0}function n(t,i,e){return(1-e)*t+e*i}function s(t){return t instanceof Object?t instanceof Array?t.slice(0):Object.create(t):t}function o(t,i){var n={curve:i.curve};return i.duration&&(n.duration=i.duration),i.speed&&(n.speed=i.speed),t instanceof Object&&(void 0!==t.duration&&(n.duration=t.duration),t.curve&&(n.curve=t.curve),t.speed&&(n.speed=t.speed)),"string"==typeof n.curve&&(n.curve=e.getCurve(n.curve)),n}function r(t,i,e,n,s){var o,r=1e-7,a=(e(s)-e(s-r))/r;if(t instanceof Array){o=[];for(var h=0;h<t.length;h++)o[h]="number"==typeof t[h]?a*(t[h]-i[h])/n:0}else o=a*(t-i)/n;return o}function a(t,i,e){var s;if(t instanceof Array){s=[];for(var o=0;o<t.length;o++)s[o]="number"==typeof t[o]?n(t[o],i[o],e):t[o]}else s=n(t,i,e);return s}e.Curves={linear:function(t){return t},easeIn:function(t){return t*t},easeOut:function(t){return t*(2-t)},easeInOut:function(t){return.5>=t?2*t*t:-2*t*t+4*t-1},easeOutBounce:function(t){return t*(3-2*t)},spring:function(t){return(1-t)*Math.sin(6*Math.PI*t)+t}},e.SUPPORTS_MULTIPLE=!0,e.DEFAULT_OPTIONS={curve:e.Curves.linear,duration:500,speed:0};var h={};e.registerCurve=function(t,i){return h[t]?!1:(h[t]=i,!0)},e.unregisterCurve=function(t){return h[t]?(delete h[t],!0):!1},e.getCurve=function(t){var i=h[t];if(void 0!==i)return i;throw new Error("curve not registered")},e.getCurves=function(){return h},e.prototype.setOptions=function(t){void 0!==t.curve&&(this.options.curve=t.curve),void 0!==t.duration&&(this.options.duration=t.duration),void 0!==t.speed&&(this.options.speed=t.speed)},e.prototype.set=function(t,i,e){if(!i)return this.reset(t),void(e&&e());if(this._startValue=s(this.get()),i=o(i,this.options),i.speed){var n=this._startValue;if(n instanceof Object){var r=0;for(var a in n)r+=(t[a]-n[a])*(t[a]-n[a]);i.duration=Math.sqrt(r)/i.speed}else i.duration=Math.abs(t-n)/i.speed}this._startTime=Date.now(),this._endValue=s(t),this._startVelocity=s(i.velocity),this._duration=i.duration,this._curve=i.curve,this._active=!0,this._callback=e},e.prototype.reset=function(t,i){if(this._callback){var e=this._callback;this._callback=void 0,e()}this.state=s(t),this.velocity=s(i),this._startTime=0,this._duration=0,this._updateTime=0,this._startValue=this.state,this._startVelocity=this.velocity,this._endValue=this.state,this._active=!1},e.prototype.getVelocity=function(){return this.velocity},e.prototype.get=function(t){return this.update(t),this.state},e.prototype.update=function(t){if(this._active){if(t||(t=Date.now()),!(this._updateTime>=t)){this._updateTime=t;var i=t-this._startTime;if(i>=this._duration)this.state=this._endValue,this.velocity=r(this.state,this._startValue,this._curve,this._duration,1),this._active=!1;else if(0>i)this.state=this._startValue,this.velocity=this._startVelocity;
else{var e=i/this._duration;this.state=a(this._startValue,this._endValue,this._curve(e)),this.velocity=r(this.state,this._startValue,this._curve,this._duration,e)}}}else if(this._callback){var n=this._callback;this._callback=void 0,n()}},e.prototype.isActive=function(){return this._active},e.prototype.halt=function(){this.reset(this.get())},e.registerCurve("linear",e.Curves.linear),e.registerCurve("easeIn",e.Curves.easeIn),e.registerCurve("easeOut",e.Curves.easeOut),e.registerCurve("easeInOut",e.Curves.easeInOut),e.registerCurve("easeOutBounce",e.Curves.easeOutBounce),e.registerCurve("spring",e.Curves.spring),e.customCurve=function(t,i){return t=t||0,i=i||0,function(e){return t*e+(-2*t-i+3)*e*e+(t+i-2)*e*e*e}},i.exports=e},{}],90:[function(t,i){function e(t){t=t||0,this.endState=new m(t),this.initState=new m,this.spring=new g({anchor:this.endState}),this.wall=new v,this._restTolerance=1e-10,this._dimensions=1,this._absRestTolerance=this._restTolerance,this._callback=void 0,this.PE=new y,this.particle=new _,this.PE.addBody(this.particle),this.PE.attach([this.wall,this.spring],this.particle)}function n(){return this.particle.getEnergy()+this.spring.getEnergy(this.particle)}function s(){var t=this.endState.sub(this.initState).normSquared();this._absRestTolerance=0===t?this._restTolerance:this._restTolerance*t}function o(){this.PE.wake()}function r(){this.PE.sleep()}function a(t){this.endState.set(t);var i=this.endState.sub(this.initState).norm();this.wall.setOptions({distance:this.endState.norm(),normal:0===i?this.particle.velocity.normalize(-1):this.endState.sub(this.initState).normalize(-1)}),s.call(this)}function h(t){this.particle.position.set(t)}function c(t){this.particle.velocity.set(t)}function p(){return 0===this._dimensions?this.particle.getPosition1D():this.particle.getPosition()}function u(){return 0===this._dimensions?this.particle.getVelocity1D():this.particle.getVelocity()}function l(t){this._callback=t}function f(){if(this.PE.isSleeping()){if(this._callback){var t=this._callback;this._callback=void 0,t()}}else{var i=n.call(this);i<this._absRestTolerance&&(r.call(this),h.call(this,this.endState),c.call(this,[0,0,0]))}}function d(t){var i=e.DEFAULT_OPTIONS;void 0===t.period&&(t.period=i.period),void 0===t.dampingRatio&&(t.dampingRatio=i.dampingRatio),void 0===t.velocity&&(t.velocity=i.velocity),void 0===t.restitution&&(t.restitution=i.restitution),this.spring.setOptions({period:t.period,dampingRatio:t.dampingRatio}),this.wall.setOptions({restitution:t.restitution}),c.call(this,t.velocity)}var y=t("../physics/PhysicsEngine"),_=t("../physics/bodies/Particle"),g=t("../physics/forces/Spring"),v=t("../physics/constraints/Wall"),m=t("../math/Vector");e.SUPPORTS_MULTIPLE=3,e.DEFAULT_OPTIONS={period:300,dampingRatio:.5,velocity:0,resitution:.5},e.prototype.reset=function(t,i){this._dimensions=t instanceof Array?t.length:0,this.initState.set(t),h.call(this,t),i&&c.call(this,i),a.call(this,t),l.call(this,void 0)},e.prototype.getVelocity=function(){return u.call(this)},e.prototype.setVelocity=function(t){this.call(this,c(t))},e.prototype.isActive=function(){return!this.PE.isSleeping()},e.prototype.halt=function(){this.set(this.get())},e.prototype.get=function(){return f.call(this),p.call(this)},e.prototype.set=function(t,i,e){return i?(this._dimensions=t instanceof Array?t.length:0,o.call(this),d.call(this,i),a.call(this,t),void l.call(this,e)):(this.reset(t),void(e&&e()))},i.exports=e},{"../math/Vector":40,"../physics/PhysicsEngine":47,"../physics/bodies/Particle":50,"../physics/constraints/Wall":59,"../physics/forces/Spring":67}],91:[function(t,i){i.exports={CachedMap:t("./CachedMap"),Easing:t("./Easing"),MultipleTransition:t("./MultipleTransition"),SnapTransition:t("./SnapTransition"),SpringTransition:t("./SpringTransition"),Transitionable:t("./Transitionable"),TransitionableTransform:t("./TransitionableTransform"),TweenTransition:t("./TweenTransition"),WallTransition:t("./WallTransition")}},{"./CachedMap":82,"./Easing":83,"./MultipleTransition":84,"./SnapTransition":85,"./SpringTransition":86,"./Transitionable":87,"./TransitionableTransform":88,"./TweenTransition":89,"./WallTransition":90}],92:[function(t,i){var e={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,ENTER:13,LEFT_ARROW:37,RIGHT_ARROW:39,UP_ARROW:38,DOWN_ARROW:40,SPACE:32,SHIFT:16,TAB:9};i.exports=e},{}],93:[function(t,i){function e(t){return c.on(p,t),t}function n(t,i){var n=u(),s=function(){var e=u();e-n>=i&&(t.apply(this,arguments),c.removeListener(p,s))};return e(s)}function s(t,i){var n=u(),s=function(){var e=u();e-n>=i&&(t.apply(this,arguments),n=u())};return e(s)}function o(t,i){if(void 0===i)return void 0;var n=function(){i--,0>=i&&(t.apply(this,arguments),a(n))};return e(n)}function r(t,i){i=i||1;var n=i,s=function(){i--,0>=i&&(t.apply(this,arguments),i=n)};return e(s)}function a(t){c.removeListener(p,t)}function h(t,i){var e,s,o,r,h;return function(){s=this,h=arguments,o=u();var c=function(){var a=u-o;i>a?e=n(c,i-a):(e=null,r=t.apply(s,h))};return a(e),e=n(c,i),r}}var c=t("../core/Engine"),p="prerender",u=window.performance?function(){return window.performance.now()}:function(){return Date.now()};i.exports={setTimeout:n,setInterval:s,debounce:h,after:o,every:r,clear:a}},{"../core/Engine":3}],94:[function(t,i){var e={};e.Direction={X:0,Y:1,Z:2},e.after=function(t,i){var e=t;return function(){e--,0===e&&i.apply(this,arguments)}},e.loadURL=function(t,i){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===this.readyState&&i&&i(this.responseText)},e.open("GET",t),e.send()},e.createDocumentFragmentFromHTML=function(t){var i=document.createElement("div");i.innerHTML=t;for(var e=document.createDocumentFragment();i.hasChildNodes();)e.appendChild(i.firstChild);return e},i.exports=e},{}],95:[function(t,i){i.exports={KeyCodes:t("./KeyCodes"),Timer:t("./Timer"),Utility:t("./Utility")}},{"./KeyCodes":92,"./Timer":93,"./Utility":94}],96:[function(t,i){function e(t){this.options=Object.create(this.constructor.DEFAULT_OPTIONS||e.DEFAULT_OPTIONS),this._optionsManager=new o(this.options),t&&this.setOptions(t),this._eventInput=new s,this._eventOutput=new s,s.setInputHandler(this,this._eventInput),s.setOutputHandler(this,this._eventOutput),this._id=n.register(this)}var n=t("../core/Entity"),s=(t("../core/Transform"),t("../core/EventHandler")),o=t("../core/OptionsManager");e.DEFAULT_OPTIONS={},e.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},e.prototype.getOptions=function(){return this._optionsManager.getOptions()},e.prototype.render=function(){return this._id},e.prototype.commit=function(){},i.exports=e},{"../core/Entity":4,"../core/EventHandler":6,"../core/OptionsManager":9,"../core/Transform":14}],97:[function(t,i){function e(){c.apply(this,arguments),this.state=new a(0),this._isOpen=!1,this.setOutputFunction(function(t,i,e){var s=n.call(this),r=this.options.direction===h.Direction.X?o.translate(s*i,0,.001*(s-1)*i):o.translate(0,s*i,.001*(s-1)*i),a=t.render();if(this.options.stackRotation){var c=this.options.stackRotation*e*(1-s);a={transform:o.rotateZ(c),origin:[.5,.5],target:a}}return{transform:r,size:t.getSize(),target:a}})}function n(t){return t?this._isOpen?1:0:this.state.get()}function s(t,i,e){this.state.halt(),this.state.set(t,i,e)}var o=t("../core/Transform"),r=t("../core/OptionsManager"),a=t("../transitions/Transitionable"),h=t("../utilities/Utility"),c=t("./SequentialLayout");e.prototype=Object.create(c.prototype),e.prototype.constructor=e,e.DEFAULT_OPTIONS=r.patch(c.DEFAULT_OPTIONS,{transition:{curve:"easeOutBounce",duration:500},stackRotation:0}),e.prototype.getSize=function(){var t=c.prototype.getSize.apply(this,arguments),i=this._items?this._items.get().getSize():[0,0];i||(i=[0,0]);var e=n.call(this),s=1-e;return[i[0]*s+t[0]*e,i[1]*s+t[1]*e]},e.prototype.isOpen=function(){return this._isOpen},e.prototype.open=function(t){this._isOpen=!0,s.call(this,1,this.options.transition,t)},e.prototype.close=function(t){this._isOpen=!1,s.call(this,0,this.options.transition,t)},e.prototype.toggle=function(t){this._isOpen?this.close(t):this.open(t)},i.exports=e},{"../core/OptionsManager":9,"../core/Transform":14,"../transitions/Transitionable":87,"../utilities/Utility":94,"./SequentialLayout":108}],98:[function(t,i){function e(t){this._currentTarget=null,this._size=[void 0,void 0],this._controller=new h(t),this._controller.inTransformFrom(s.create(n.bind(this,1e-4))),this._controller.outTransformFrom(s.create(n.bind(this,-1e-4))),this._eventInput=new r,r.setInputHandler(this,this._eventInput),this._entityId=o.register(this),t&&this.setOptions(t)}function n(t,i){return a.translate(this._size[0]*(1-i),0,t*(1-i))}var s=t("../transitions/CachedMap"),o=t("../core/Entity"),r=t("../core/EventHandler"),a=t("../core/Transform"),h=t("./RenderController");e.prototype.show=function(t){this._currentTarget&&this._eventInput.unpipe(this._currentTarget),this._currentTarget=t,this._currentTarget&&this._currentTarget.trigger&&this._eventInput.pipe(this._currentTarget),this._controller.show.apply(this._controller,arguments)},e.prototype.setOptions=function(t){this._controller.setOptions(t)},e.prototype.render=function(){return this._entityId},e.prototype.commit=function(t){return this._size[0]=t.size[0],this._size[1]=t.size[1],{transform:t.transform,opacity:t.opacity,origin:t.origin,size:t.size,target:this._controller.render()}},i.exports=e},{"../core/Entity":4,"../core/EventHandler":6,"../core/Transform":14,"../transitions/CachedMap":82,"./RenderController":104}],99:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),this.optionsManager=new r(this.options),t&&this.setOptions(t),this.id=s.register(this),this._ratios=new h(this.options.ratios),this._nodes=[],this._cachedDirection=null,this._cachedTotalLength=!1,this._cachedLengths=[],this._cachedTransforms=null,this._ratiosDirty=!1,this._eventOutput=new a,a.setOutputHandler(this,this._eventOutput)}function n(t,i,n){var s,r,a,h,c=0,p=i,u=0;for(this._cachedLengths=[],this._cachedTransforms=[],h=0;h<t.length;h++)r=t[h],a=this._nodes[h],"number"!=typeof r?p-=a.getSize()[n]||0:u+=r;for(h=0;h<t.length;h++)a=this._nodes[h],r=t[h],i="number"==typeof r?p*r/u:a.getSize()[n],s=n===e.DIRECTION_X?o.translate(c,0,0):o.translate(0,c,0),this._cachedTransforms.push(s),this._cachedLengths.push(i),c+=i}var s=t("../core/Entity"),o=t("../core/Transform"),r=t("../core/OptionsManager"),a=t("../core/EventHandler"),h=t("../transitions/Transitionable");e.DIRECTION_X=0,e.DIRECTION_Y=1,e.DEFAULT_OPTIONS={direction:e.DIRECTION_X,transition:!1,ratios:[]},e.prototype.render=function(){return this.id},e.prototype.setOptions=function(t){this.optionsManager.setOptions(t)},e.prototype.sequenceFrom=function(t){if(this._nodes=t,0===this._ratios.get().length){for(var i=[],e=0;e<this._nodes.length;e++)i.push(1);this.setRatios(i)}},e.prototype.setRatios=function(t,i,e){void 0===i&&(i=this.options.transition);var n=this._ratios;0===n.get().length&&(i=void 0),n.isActive()&&n.halt(),n.set(t,i,e),this._ratiosDirty=!0},e.prototype.commit=function(t){var i,e=t.size,s=t.transform,r=t.origin,a=this._ratios.get(),h=this.options.direction,c=e[h];(c!==this._cachedTotalLength||this._ratiosDirty||this._ratios.isActive()||h!==this._cachedDirection)&&(n.call(this,a,c,h),c!==this._cachedTotalLength&&(this._cachedTotalLength=c),h!==this._cachedDirection&&(this._cachedDirection=h),this._ratiosDirty&&(this._ratiosDirty=!1));for(var p=[],u=0;u<a.length;u++)i=[void 0,void 0],c=this._cachedLengths[u],i[h]=c,p.push({transform:this._cachedTransforms[u],size:i,target:this._nodes[u].render()});return e&&0!==r[0]&&0!==r[1]&&(s=o.moveThen([-e[0]*r[0],-e[1]*r[1],0],s)),{transform:s,size:e,target:p}},i.exports=e},{"../core/Entity":4,"../core/EventHandler":6,"../core/OptionsManager":9,"../core/Transform":14,"../transitions/Transitionable":87}],100:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),this._optionsManager=new o(this.options),t&&this.setOptions(t),this.angle=new s(0),this.frontNode=void 0,this.backNode=void 0,this.flipped=!1}var n=t("../core/Transform"),s=t("../transitions/Transitionable"),o=(t("../core/RenderNode"),t("../core/OptionsManager"));e.DIRECTION_X=0,e.DIRECTION_Y=1;var r=1;e.DEFAULT_OPTIONS={transition:!0,direction:e.DIRECTION_X},e.prototype.flip=function(t,i){var e=this.flipped?0:Math.PI;this.setAngle(e,t,i),this.flipped=!this.flipped},e.prototype.setAngle=function(t,i,e){void 0===i&&(i=this.options.transition),this.angle.isActive()&&this.angle.halt(),this.angle.set(t,i,e)},e.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},e.prototype.setFront=function(t){this.frontNode=t},e.prototype.setBack=function(t){this.backNode=t},e.prototype.render=function(){var t,i,s=this.angle.get();this.options.direction===e.DIRECTION_X?(t=n.rotateY(s),i=n.rotateY(s+Math.PI)):(t=n.rotateX(s),i=n.rotateX(s+Math.PI));var o=[];return this.frontNode&&o.push({transform:t,target:this.frontNode.render()}),this.backNode&&o.push({transform:n.moveThen([0,0,r],i),target:this.backNode.render()}),o},i.exports=e},{"../core/OptionsManager":9,"../core/RenderNode":10,"../core/Transform":14,"../transitions/Transitionable":87}],101:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),this.optionsManager=new u(this.options),t&&this.setOptions(t),this.id=r.register(this),this._modifiers=[],this._states=[],this._contextSizeCache=[0,0],this._dimensionsCache=[0,0],this._activeCount=0,this._eventOutput=new c,c.setOutputHandler(this,this._eventOutput)}function n(t,i,e){var n=[t[0],t[1]];n[0]-=this.options.gutterSize[0]*(i-1),n[1]-=this.options.gutterSize[1]*(e-1);for(var r,a=Math.round(n[1]/e),h=Math.round(n[0]/i),c=0,p=0,u=0;e>u;u++){r=0;for(var l=0;i>l;l++)void 0===this._modifiers[p]?s.call(this,p,[h,a],[r,c,0],1):o.call(this,p,[h,a],[r,c,0],1),p++,r+=h+this.options.gutterSize[0];c+=a+this.options.gutterSize[1]}for(this._dimensionsCache=[this.options.dimensions[0],this.options.dimensions[1]],this._contextSizeCache=[t[0],t[1]],this._activeCount=e*i,u=this._activeCount;u<this._modifiers.length;u++)o.call(this,u,[Math.round(h),Math.round(a)],[0,0],0);this._eventOutput.emit("reflow")}function s(t,i,e,n){var s={transform:new f(a.translate.apply(null,e)),opacity:new l(n),size:new l(i)},o=new p({transform:s.transform,opacity:s.opacity,size:s.size});this._states[t]=s,this._modifiers[t]=o}function o(t,i,e,n){var s=this._states[t],o=s.size,r=s.opacity,a=s.transform,h=this.options.transition;a.halt(),r.halt(),o.halt(),a.setTranslate(e,h),o.set(i,h),r.set(n,h)}var r=t("../core/Entity"),a=(t("../core/RenderNode"),t("../core/Transform")),h=t("../core/ViewSequence"),c=t("../core/EventHandler"),p=t("../core/Modifier"),u=t("../core/OptionsManager"),l=t("../transitions/Transitionable"),f=t("../transitions/TransitionableTransform");e.DEFAULT_OPTIONS={dimensions:[1,1],transition:!1,gutterSize:[0,0]},e.prototype.render=function(){return this.id},e.prototype.setOptions=function(t){return this.optionsManager.setOptions(t)},e.prototype.sequenceFrom=function(t){t instanceof Array&&(t=new h(t)),this.sequence=t},e.prototype.commit=function(t){var i=t.transform,e=t.opacity,s=t.origin,o=t.size,r=this.options.dimensions[0],h=this.options.dimensions[1];(o[0]!==this._contextSizeCache[0]||o[1]!==this._contextSizeCache[1]||r!==this._dimensionsCache[0]||h!==this._dimensionsCache[1])&&n.call(this,o,r,h);for(var c=this.sequence,p=[],u=0;c&&u<this._modifiers.length;){var l=c.get(),f=this._modifiers[u];u>=this._activeCount&&this._states[u].opacity.isActive()&&(this._modifiers.splice(u,1),this._states.splice(u,1)),l&&p.push(f.modify({origin:s,target:l.render()})),c=c.getNext(),u++}return o&&(i=a.moveThen([-o[0]*s[0],-o[1]*s[1],0],i)),{transform:i,opacity:e,size:o,target:p}},i.exports=e},{"../core/Entity":4,"../core/EventHandler":6,"../core/Modifier":8,"../core/OptionsManager":9,"../core/RenderNode":10,"../core/Transform":14,"../core/ViewSequence":16,"../transitions/Transitionable":87,"../transitions/TransitionableTransform":88}],102:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),this._optionsManager=new c(this.options),t&&this.setOptions(t),this._entityId=r.register(this),this.header=new a,this.footer=new a,this.content=new a}function n(t,i){var e=t.getSize();return e?e[this.options.direction]:i}function s(t){return this.options.direction===e.DIRECTION_X?h.translate(t,0,0):h.translate(0,t,0)}function o(t,i){return this.options.direction===e.DIRECTION_X?[t,i[1]]:[i[0],t]}var r=t("../core/Entity"),a=t("../core/RenderNode"),h=t("../core/Transform"),c=t("../core/OptionsManager");e.DIRECTION_X=0,e.DIRECTION_Y=1,e.DEFAULT_OPTIONS={direction:e.DIRECTION_Y,headerSize:void 0,footerSize:void 0,defaultHeaderSize:0,defaultFooterSize:0},e.prototype.render=function(){return this._entityId},e.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},e.prototype.commit=function(t){var i=t.transform,e=t.origin,r=t.size,a=t.opacity,c=void 0!==this.options.headerSize?this.options.headerSize:n.call(this,this.header,this.options.defaultHeaderSize),p=void 0!==this.options.footerSize?this.options.footerSize:n.call(this,this.footer,this.options.defaultFooterSize),u=r[this.options.direction]-c-p;r&&(i=h.moveThen([-r[0]*e[0],-r[1]*e[1],0],i));var l=[{size:o.call(this,c,r),target:this.header.render()},{transform:s.call(this,c),size:o.call(this,u,r),target:this.content.render()},{transform:s.call(this,c+u),size:o.call(this,p,r),target:this.footer.render()}];return{transform:i,opacity:a,size:r,target:l}},i.exports=e},{"../core/Entity":4,"../core/OptionsManager":9,"../core/RenderNode":10,"../core/Transform":14}],103:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),this._optionsManager=new a(this.options),t&&this.setOptions(t),this._showing=!1,this.nodes=[],this.transforms=[],this.states=[]}var n=t("../core/Transform"),s=t("../core/Modifier"),o=t("../core/RenderNode"),r=t("../utilities/Utility"),a=t("../core/OptionsManager"),h=t("../transitions/Transitionable"),c=t("../transitions/TransitionableTransform");e.DEFAULT_OPTIONS={inTransform:n.scale(.001,.001,.001),inOpacity:0,inOrigin:[.5,.5],outTransform:n.scale(.001,.001,.001),outOpacity:0,outOrigin:[.5,.5],showTransform:n.identity,showOpacity:1,showOrigin:[.5,.5],inTransition:!0,outTransition:!0,overlap:!1},e.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},e.prototype.show=function(t,i,e){if(!t)return this.hide(e);if(i instanceof Function&&(e=i,i=void 0),this._showing){if(!this.options.overlap)return this.hide(this.show.bind(this,t,i,e));this.hide()}this._showing=!0;var n={transform:new c(this.options.inTransform),origin:new h(this.options.inOrigin),opacity:new h(this.options.inOpacity)},a=new s({transform:n.transform,opacity:n.opacity,origin:n.origin}),p=new o;p.add(a).add(t),this.nodes.push(p),this.states.push(n),this.transforms.push(a);var u=e?r.after(3,e):void 0;i||(i=this.options.inTransition),n.transform.set(this.options.showTransform,i,u),n.opacity.set(this.options.showOpacity,i,u),n.origin.set(this.options.showOrigin,i,u)},e.prototype.hide=function(t,i){if(this._showing){this._showing=!1,t instanceof Function&&(i=t,t=void 0);var e=this.nodes[this.nodes.length-1],n=this.transforms[this.transforms.length-1],s=this.states[this.states.length-1],o=r.after(3,function(){this.nodes.splice(this.nodes.indexOf(e),1),this.states.splice(this.states.indexOf(s),1),this.transforms.splice(this.transforms.indexOf(n),1),i&&i.call(this)}.bind(this));t||(t=this.options.outTransition),s.transform.set(this.options.outTransform,t,o),s.opacity.set(this.options.outOpacity,t,o),s.origin.set(this.options.outOrigin,t,o)}},e.prototype.render=function(){for(var t=[],i=0;i<this.nodes.length;i++)t.push(this.nodes[i].render());return t},i.exports=e},{"../core/Modifier":8,"../core/OptionsManager":9,"../core/RenderNode":10,"../core/Transform":14,"../transitions/Transitionable":87,"../transitions/TransitionableTransform":88,"../utilities/Utility":94}],104:[function(t,i){function e(){h.apply(this,arguments),this._showing=-1,this._outgoingRenderables=[],this._nextRenderable=null,this._renderables=[],this._nodes=[],this._modifiers=[],this._states=[],this.inTransformMap=e.DefaultMap.transform,this.inOpacityMap=e.DefaultMap.opacity,this.inOriginMap=e.DefaultMap.origin,this.outTransformMap=e.DefaultMap.transform,this.outOpacityMap=e.DefaultMap.opacity,this.outOriginMap=e.DefaultMap.origin,this._output=[]}function n(t,i){return t(i.get())}var s=t("../core/Modifier"),o=t("../core/RenderNode"),r=t("../core/Transform"),a=t("../transitions/Transitionable"),h=t("../core/View");e.prototype=Object.create(h.prototype),e.prototype.constructor=e,e.DEFAULT_OPTIONS={inTransition:!0,outTransition:!0,overlap:!0},e.DefaultMap={transform:function(){return r.identity},opacity:function(t){return t},origin:null},e.prototype.inTransformFrom=function(t){if(t instanceof Function)this.inTransformMap=t;else{if(!t||!t.get)throw new Error("inTransformFrom takes only function or getter object");this.inTransformMap=t.get.bind(t)}return this},e.prototype.inOpacityFrom=function(t){if(t instanceof Function)this.inOpacityMap=t;else{if(!t||!t.get)throw new Error("inOpacityFrom takes only function or getter object");this.inOpacityMap=t.get.bind(t)}return this},e.prototype.inOriginFrom=function(t){if(t instanceof Function)this.inOriginMap=t;else{if(!t||!t.get)throw new Error("inOriginFrom takes only function or getter object");this.inOriginMap=t.get.bind(t)}return this},e.prototype.outTransformFrom=function(t){if(t instanceof Function)this.outTransformMap=t;else{if(!t||!t.get)throw new Error("inTransformFrom takes only function or getter object");this.outTransformMap=t.get.bind(t)}return this},e.prototype.outOpacityFrom=function(t){if(t instanceof Function)this.outOpacityMap=t;else{if(!t||!t.get)throw new Error("inOpacityFrom takes only function or getter object");this.outOpacityMap=t.get.bind(t)}return this},e.prototype.outOriginFrom=function(t){if(t instanceof Function)this.outOriginMap=t;else{if(!t||!t.get)throw new Error("inOriginFrom takes only function or getter object");this.outOriginMap=t.get.bind(t)}return this},e.prototype.show=function(t,i,e){if(!t)return this.hide(e);if(i instanceof Function&&(e=i,i=null),this._showing>=0){if(!this.options.overlap)return void(this._nextRenderable?this._nextRenderable=t:(this._nextRenderable=t,this.hide(function(){this._nextRenderable===t&&this.show(this._nextRenderable,e),this._nextRenderable=null})));this.hide()}var r=null,h=this._renderables.indexOf(t);if(h>=0){this._showing=h,r=this._states[h],r.halt();var c=this._outgoingRenderables.indexOf(t);c>=0&&this._outgoingRenderables.splice(c,1)}else{r=new a(0);var p=new s({transform:this.inTransformMap?n.bind(this,this.inTransformMap,r):null,opacity:this.inOpacityMap?n.bind(this,this.inOpacityMap,r):null,origin:this.inOriginMap?n.bind(this,this.inOriginMap,r):null}),u=new o;u.add(p).add(t),this._showing=this._nodes.length,this._nodes.push(u),this._modifiers.push(p),this._states.push(r),this._renderables.push(t)}i||(i=this.options.inTransition),r.set(1,i,e)},e.prototype.hide=function(t,i){if(!(this._showing<0)){var e=this._showing;this._showing=-1,t instanceof Function&&(i=t,t=void 0);var s=this._nodes[e],o=this._modifiers[e],r=this._states[e],a=this._renderables[e];o.transformFrom(this.outTransformMap?n.bind(this,this.outTransformMap,r):null),o.opacityFrom(this.outOpacityMap?n.bind(this,this.outOpacityMap,r):null),o.originFrom(this.outOriginMap?n.bind(this,this.outOriginMap,r):null),this._outgoingRenderables.indexOf(a)<0&&this._outgoingRenderables.push(a),t||(t=this.options.outTransition),r.halt(),r.set(0,t,function(t,e,n,s){if(this._outgoingRenderables.indexOf(s)>=0){var o=this._nodes.indexOf(t);this._nodes.splice(o,1),this._modifiers.splice(o,1),this._states.splice(o,1),this._renderables.splice(o,1),this._outgoingRenderables.splice(this._outgoingRenderables.indexOf(s),1),this._showing>=o&&this._showing--}i&&i.call(this)}.bind(this,s,o,r,a))}},e.prototype.render=function(){var t=this._output;t.length>this._nodes.length&&t.splice(this._nodes.length);for(var i=0;i<this._nodes.length;i++)t[i]=this._nodes[i].render();return t},i.exports=e},{"../core/Modifier":8,"../core/RenderNode":10,"../core/Transform":14,"../core/View":15,"../transitions/Transitionable":87}],105:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),this._optionsManager=new a(this.options),t&&this.setOptions(t),this.container=new n(this.options.container),this.scrollview=new o(this.options.scrollview),this.container.add(this.scrollview),s.setInputHandler(this,this.scrollview),s.setOutputHandler(this,this.scrollview),this.scrollview.subscribe(this.container)}var n=t("../surfaces/ContainerSurface"),s=t("../core/EventHandler"),o=t("./Scrollview"),r=t("../utilities/Utility"),a=t("../core/OptionsManager");e.DEFAULT_OPTIONS={container:{properties:{overflow:"hidden"}},scrollview:{direction:r.Direction.X}},e.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},e.prototype.sequenceFrom=function(){return this.scrollview.sequenceFrom.apply(this.scrollview,arguments)},e.prototype.render=function(){return this.container.render.apply(this.container,arguments)},i.exports=e},{"../core/EventHandler":6,"../core/OptionsManager":9,"../surfaces/ContainerSurface":74,"../utilities/Utility":94,"./Scrollview":107}],106:[function(t,i){function e(t){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),this._optionsManager=new p(this.options),t&&this._optionsManager.setOptions(t),this._node=null,this._position=0,this._positionOffset=0,this._positionGetter=null,this._outputFunction=null,this._masterOutputFunction=null,this.outputFrom(),this._onEdge=0,this.group=new c,this.group.add({render:a.bind(this)}),this._entityId=h.register(this),this._size=[void 0,void 0],this._contextSize=[void 0,void 0],this._eventInput=new d,this._eventOutput=new d,d.setInputHandler(this,this._eventInput),d.setOutputHandler(this,this._eventOutput)}function n(t){t||(t=this._contextSize);var i=this.options.direction===l.Direction.X?0:1;return void 0===t[i]?this._contextSize[i]:t[i]}function s(t,i,e){var s=t.getSize?t.getSize():this._contextSize,o=this._outputFunction(i);return e.push({transform:o,target:t.render()}),n.call(this,s)}function o(){return this.options.clipSize?this.options.clipSize:n.call(this,this._contextSize)}function r(){for(var t=n.call(this,this._node.getSize()),i=this._node&&this._node.getNext?this._node.getNext():null;i&&this._position+this._positionOffset>=t;)this._positionOffset-=t,this._node=i,t=n.call(this,this._node.getSize()),i=this._node&&this._node.getNext?this._node.getNext():null;for(var e=this._node&&this._node.getPrevious?this._node.getPrevious():null;e&&this._position+this._positionOffset<0;){var s=n.call(this,e.getSize());this._positionOffset+=s,this._node=e,e=this._node&&this._node.getPrevious?this._node.getPrevious():null}}function a(){var t=null,i=this._position,e=[];this._onEdge=0;for(var a=-this._positionOffset,h=o.call(this),c=this._node;c&&a-i<h+this.options.margin;)a+=s.call(this,c,a,e),c=c.getNext?c.getNext():null;var p=this._node,u=n.call(this,p.getSize());if(h>a){for(;p&&h>u;)p=p.getPrevious(),p&&(u+=n.call(this,p.getSize()));for(p=this._node;p&&h>u;)p=p.getNext(),p&&(u+=n.call(this,p.getSize()))}var l=void 0!==u&&h>u?u:h;for(!c&&l>=a-i?(this._onEdge=1,this._eventOutput.emit("edgeHit",{position:a-l})):!this._node.getPrevious()&&0>=i&&(this._onEdge=-1,this._eventOutput.emit("edgeHit",{position:0})),c=this._node&&this._node.getPrevious?this._node.getPrevious():null,a=-this._positionOffset,c&&(t=c.getSize?c.getSize():this._contextSize,a-=n.call(this,t));c&&a-i>-(o.call(this)+this.options.margin);)s.call(this,c,a,e),c=c.getPrevious?c.getPrevious():null,c&&(t=c.getSize?c.getSize():this._contextSize,a-=n.call(this,t));return r.call(this),e}var h=t("../core/Entity"),c=t("../core/Group"),p=t("../core/OptionsManager"),u=t("../core/Transform"),l=t("../utilities/Utility"),f=t("../core/ViewSequence"),d=t("../core/EventHandler");e.DEFAULT_OPTIONS={direction:l.Direction.Y,margin:0,clipSize:void 0,groupScroll:!1},e.prototype.setOptions=function(t){this._optionsManager.setOptions(t),this.options.groupScroll?this.group.pipe(this._eventOutput):this.group.unpipe(this._eventOutput)},e.prototype.onEdge=function(){return this._onEdge},e.prototype.outputFrom=function(t,i){t||(t=function(t){return this.options.direction===l.Direction.X?u.translate(t,0):u.translate(0,t)}.bind(this),i||(i=t)),this._outputFunction=t,this._masterOutputFunction=i?i:function(i){return u.inverse(t(-i))}},e.prototype.positionFrom=function(t){t instanceof Function?this._positionGetter=t:t&&t.get?this._positionGetter=t.get.bind(t):(this._positionGetter=null,this._position=t),this._positionGetter&&(this._position=this._positionGetter.call(this))},e.prototype.sequenceFrom=function(t){t instanceof Array&&(t=new f({array:t})),this._node=t,this._positionOffset=0},e.prototype.getSize=function(t){return t?this._contextSize:this._size},e.prototype.render=function(){return this._node?(this._positionGetter&&(this._position=this._positionGetter.call(this)),this._entityId):null},e.prototype.commit=function(t){var i=t.transform,e=t.opacity,n=t.origin,s=t.size;this.options.clipSize||s[0]===this._contextSize[0]&&s[1]===this._contextSize[1]||(this._onEdge=0,this._contextSize[0]=s[0],this._contextSize[1]=s[1],this.options.direction===l.Direction.X?(this._size[0]=o.call(this),this._size[1]=void 0):(this._size[0]=void 0,this._size[1]=o.call(this)));var r=this._masterOutputFunction(-this._position);return{transform:u.multiply(i,r),size:s,opacity:e,origin:n,target:this.group.render()}},i.exports=e},{"../core/Entity":4,"../core/EventHandler":6,"../core/Group":7,"../core/OptionsManager":9,"../core/Transform":14,"../core/ViewSequence":16,"../utilities/Utility":94}],107:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),this._optionsManager=new O(this.options),this._node=null,this._physicsEngine=new y,this._particle=new _,this._physicsEngine.addBody(this._particle),this.spring=new v({anchor:[0,0,0]}),this.drag=new g({forceFunction:g.FORCE_FUNCTIONS.QUADRATIC}),this.friction=new g({forceFunction:g.FORCE_FUNCTIONS.LINEAR}),this.sync=new b(["scroll","touch"],{direction:this.options.direction}),this._eventInput=new m,this._eventOutput=new m,this._eventInput.pipe(this.sync),this.sync.pipe(this._eventInput),m.setInputHandler(this,this._eventInput),m.setOutputHandler(this,this._eventOutput),this._touchCount=0,this._springState=0,this._onEdge=0,this._pageSpringPosition=0,this._edgeSpringPosition=0,this._touchVelocity=void 0,this._earlyEnd=!1,this._needsPaginationCheck=!1,this._scroller=new S,this._scroller.positionFrom(this.getPosition.bind(this)),this.setOptions(t),r.call(this)}function n(t){this._touchCount=t.count,void 0===t.count&&(this._touchCount=1),h.call(this),this.setVelocity(0),this._touchVelocity=0,this._earlyEnd=!1}function s(t){var i=-t.velocity,e=-t.delta;this._onEdge&&t.slip&&(0>i&&this._onEdge<0||i>0&&this._onEdge>0?this._earlyEnd||(o.call(this,t),this._earlyEnd=!0):this._earlyEnd&&Math.abs(i)>Math.abs(this.getVelocity())&&n.call(this,t)),this._earlyEnd||(this._touchVelocity=i,t.slip?this.setVelocity(i):this.setPosition(this.getPosition()+e))}function o(t){if(this._touchCount=t.count||0,!this._touchCount){h.call(this),this._onEdge&&l.call(this,this._edgeSpringPosition,C.EDGE),a.call(this);var i=-t.velocity,e=this.options.speedLimit;t.slip&&(e*=this.options.edgeGrip),-e>i?i=-e:i>e&&(i=e),this.setVelocity(i),this._touchVelocity=void 0,this._needsPaginationCheck=!0}}function r(){this._eventInput.bindThis(this),this._eventInput.on("start",n),this._eventInput.on("update",s),this._eventInput.on("end",o),this._scroller.on("edgeHit",function(t){this._edgeSpringPosition=t.position
}.bind(this))}function a(){this._springState?this._physicsEngine.attach([this.spring],this._particle):this._physicsEngine.attach([this.drag,this.friction],this._particle)}function h(){this._springState=C.NONE,this._physicsEngine.detachAll()}function c(t){var i=this.options.direction,e=(t.getSize()||this._scroller.getSize())[i];return e||(e=this._scroller.getSize()[i]),e}function p(t){!this._onEdge&&t?(this.sync.setOptions({scale:this.options.edgeGrip}),this._touchCount||this._springState===C.EDGE||l.call(this,this._edgeSpringPosition,C.EDGE)):this._onEdge&&!t&&(this.sync.setOptions({scale:1}),this._springState&&Math.abs(this.getVelocity())<.001&&(h.call(this),a.call(this))),this._onEdge=t}function u(){if(this._needsPaginationCheck&&!this._touchCount&&this._springState!==C.EDGE){var t=this.getVelocity();if(!(Math.abs(t)>=this.options.pageStopSpeed)){var i=this.getPosition(),e=Math.abs(t)>this.options.pageSwitchSpeed,n=c.call(this,this._node),s=i>.5*n,o=t>0;s&&!e||e&&o?this.goToNextPage():l.call(this,0,C.PAGE),this._needsPaginationCheck=!1}}}function l(t,i){var e;i===C.EDGE?(this._edgeSpringPosition=t,e={anchor:[this._edgeSpringPosition,0,0],period:this.options.edgePeriod,dampingRatio:this.options.edgeDamp}):i===C.PAGE&&(this._pageSpringPosition=t,e={anchor:[this._pageSpringPosition,0,0],period:this.options.pagePeriod,dampingRatio:this.options.pageDamp}),this.spring.setOptions(e),i&&!this._springState&&(h.call(this),this._springState=i,a.call(this)),this._springState=i}function f(){for(var t=this.getPosition(),i=c.call(this,this._node),e=this._node.getNext();t>i+x&&e;)d.call(this,-i),t-=i,this._scroller.sequenceFrom(e),this._node=e,e=this._node.getNext(),i=c.call(this,this._node);for(var n,s=this._node.getPrevious();-x>t&&s;)n=c.call(this,s),this._scroller.sequenceFrom(s),this._node=s,d.call(this,n),t+=n,s=this._node.getPrevious()}function d(t){this._edgeSpringPosition+=t,this._pageSpringPosition+=t,this.setPosition(this.getPosition()+t),this._springState===C.EDGE?this.spring.setOptions({anchor:[this._edgeSpringPosition,0,0]}):this._springState===C.PAGE&&this.spring.setOptions({anchor:[this._pageSpringPosition,0,0]})}var y=t("../physics/PhysicsEngine"),_=t("../physics/bodies/Particle"),g=t("../physics/forces/Drag"),v=t("../physics/forces/Spring"),m=t("../core/EventHandler"),O=t("../core/OptionsManager"),T=t("../core/ViewSequence"),S=t("../views/Scroller"),w=t("../utilities/Utility"),b=t("../inputs/GenericSync"),E=t("../inputs/ScrollSync"),I=t("../inputs/TouchSync");b.register({scroll:E,touch:I});var x=.5;e.DEFAULT_OPTIONS={direction:w.Direction.Y,rails:!0,friction:.001,drag:1e-4,edgeGrip:.5,edgePeriod:300,edgeDamp:1,margin:1e3,paginated:!1,pagePeriod:500,pageDamp:.8,pageStopSpeed:10,pageSwitchSpeed:.5,speedLimit:10,groupScroll:!1};var C={NONE:0,EDGE:1,PAGE:2};e.prototype.outputFrom=function(){return this._scroller.outputFrom.apply(this._scroller,arguments)},e.prototype.getPosition=function(){return this._particle.getPosition1D()},e.prototype.setPosition=function(t){this._particle.setPosition1D(t)},e.prototype.getVelocity=function(){return this._touchCount?this._touchVelocity:this._particle.getVelocity1D()},e.prototype.setVelocity=function(t){this._particle.setVelocity1D(t)},e.prototype.setOptions=function(t){t&&(void 0!==t.direction&&("x"===t.direction?t.direction=w.Direction.X:"y"===t.direction&&(t.direction=w.Direction.Y)),this._scroller.setOptions(t),this._optionsManager.setOptions(t)),this._scroller.setOptions(this.options),this.options.groupScroll?this._scroller.pipe(this._eventInput):this._scroller.unpipe(this._eventInput),this.drag.setOptions({strength:this.options.drag}),this.friction.setOptions({strength:this.options.friction}),this.spring.setOptions({period:this.options.edgePeriod,dampingRatio:this.options.edgeDamp}),this.sync.setOptions({rails:this.options.rails,direction:this.options.direction===w.Direction.X?b.DIRECTION_X:b.DIRECTION_Y})},e.prototype.goToPreviousPage=function(){if(!this._node)return null;var t=this._node.getPrevious();if(t){var i=this.getPosition(),e=c.call(this,t);this._scroller.sequenceFrom(t),this._node=t;var n=x>i?-e:0;l.call(this,n,C.PAGE),d.call(this,e)}return this._eventOutput.emit("pageChange",{direction:-1}),t},e.prototype.goToNextPage=function(){if(!this._node)return null;var t=this._node.getNext();if(t){var i=this.getPosition(),e=c.call(this,this._node),n=c.call(this,t);this._scroller.sequenceFrom(t),this._node=t;var s=i>e-x?e+n:e;l.call(this,s,C.PAGE),d.call(this,-e)}return this._eventOutput.emit("pageChange",{direction:1}),t},e.prototype.sequenceFrom=function(t){return t instanceof Array&&(t=new T({array:t})),this._node=t,this._scroller.sequenceFrom(t)},e.prototype.getSize=function(){return this._scroller.getSize.apply(this._scroller,arguments)},e.prototype.render=function(){return this._node?(f.call(this),p.call(this,this._scroller.onEdge()),this.options.paginated&&u.call(this),this._scroller.render()):null},i.exports=e},{"../core/EventHandler":6,"../core/OptionsManager":9,"../core/ViewSequence":16,"../inputs/GenericSync":26,"../inputs/ScrollSync":31,"../inputs/TouchSync":32,"../physics/PhysicsEngine":47,"../physics/bodies/Particle":50,"../physics/forces/Drag":62,"../physics/forces/Spring":67,"../utilities/Utility":94,"../views/Scroller":106}],108:[function(t,i){function e(t){this._items=null,this._size=null,this._outputFunction=e.DEFAULT_OUTPUT_FUNCTION,this.options=Object.create(this.constructor.DEFAULT_OPTIONS),this.optionsManager=new n(this.options),this._itemsCache=[],this._outputCache={size:null,target:this._itemsCache},t&&this.setOptions(t)}var n=t("../core/OptionsManager"),s=t("../core/Transform"),o=t("../core/ViewSequence"),r=t("../utilities/Utility");e.DEFAULT_OPTIONS={direction:r.Direction.Y,itemSpacing:0,defaultItemSize:[50,50]},e.DEFAULT_OUTPUT_FUNCTION=function(t,i){var e=this.options.direction===r.Direction.X?s.translate(i,0):s.translate(0,i);return{transform:e,target:t.render()}},e.prototype.getSize=function(){return this._size||this.render(),this._size},e.prototype.sequenceFrom=function(t){return t instanceof Array&&(t=new o(t)),this._items=t,this},e.prototype.setOptions=function(){return this.optionsManager.setOptions.apply(this.optionsManager,arguments),this},e.prototype.setOutputFunction=function(t){return this._outputFunction=t,this},e.prototype.render=function(){for(var t=0,i=0,e=this.options.direction===r.Direction.X?0:1,n=this.options.direction===r.Direction.X?1:0,s=this._items,o=this._itemsCache,a=0;s;){var h=s.get();if(!h)break;var c;h&&h.getSize&&(c=h.getSize()),c||(c=this.options.defaultItemSize),c[n]!==!0&&(i=Math.max(i,c[n]));var p=this._outputFunction.call(this,h,t,a);o[a]=p,c[e]&&c[e]!==!0&&(t+=c[e]+this.options.itemSpacing),s=s.getNext(),a++}return this._itemsCache.splice(a),i||(i=void 0),this._size||(this._size=[0,0]),this._size[e]=t-this.options.itemSpacing,this._size[n]=i,this._outputCache.size=this.getSize(),this._outputCache},i.exports=e},{"../core/OptionsManager":9,"../core/Transform":14,"../core/ViewSequence":16,"../utilities/Utility":94}],109:[function(t,i){i.exports={ContextualView:t("./ContextualView"),Deck:t("./Deck"),EdgeSwapper:t("./EdgeSwapper"),FlexibleLayout:t("./FlexibleLayout"),Flipper:t("./Flipper"),GridLayout:t("./GridLayout"),HeaderFooterLayout:t("./HeaderFooterLayout"),Lightbox:t("./Lightbox"),RenderController:t("./RenderController"),ScrollContainer:t("./ScrollContainer"),Scroller:t("./Scroller"),Scrollview:t("./Scrollview"),SequentialLayout:t("./SequentialLayout")}},{"./ContextualView":96,"./Deck":97,"./EdgeSwapper":98,"./FlexibleLayout":99,"./Flipper":100,"./GridLayout":101,"./HeaderFooterLayout":102,"./Lightbox":103,"./RenderController":104,"./ScrollContainer":105,"./Scroller":106,"./Scrollview":107,"./SequentialLayout":108}],110:[function(t,i){function e(){r.apply(this,arguments),this.title=new s({classes:this.options.classes,content:this.options.content}),this.back=new s({size:[this.options.size[1],this.options.size[1]],classes:this.options.classes,content:this.options.backContent}),this.back.on("click",function(){this._eventOutput.emit("back",{})}.bind(this)),this.more=new s({size:[this.options.size[1],this.options.size[1]],classes:this.options.classes,content:this.options.moreContent}),this.more.on("click",function(){this._eventOutput.emit("more",{})}.bind(this)),this.layout=new n({id:"master",size:this.options.size,target:[{transform:o.inFront,origin:[0,.5],target:this.back},{origin:[.5,.5],target:this.title},{transform:o.inFront,origin:[1,.5],target:this.more}]}),this._add(this.layout),this._optionsManager.on("change",function(t){var i=t.id,e=t.value;"size"===i?(this.layout.id.master.setSize(e),this.title.setSize(e),this.back.setSize([e[1],e[1]]),this.more.setSize([e[1],e[1]])):"backClasses"===i?this.back.setOptions({classes:this.options.classes.concat(this.options.backClasses)}):"backContent"===i?this.back.setContent(this.options.backContent):"classes"===i?(this.title.setOptions({classes:this.options.classes}),this.back.setOptions({classes:this.options.classes.concat(this.options.backClasses)}),this.more.setOptions({classes:this.options.classes.concat(this.options.moreClasses)})):"content"===i?this.setContent(this.options.content):"moreClasses"===i?this.more.setOptions({classes:this.options.classes.concat(this.options.moreClasses)}):"moreContent"===i&&this.more.setContent(this.options.content)}.bind(this))}var n=t("../core/Scene"),s=t("../core/Surface"),o=t("../core/Transform"),r=t("../core/View");e.prototype=Object.create(r.prototype),e.prototype.constructor=e,e.DEFAULT_OPTIONS={size:[void 0,50],backClasses:["back"],backContent:"&#x25c0;",classes:["navigation"],content:"",moreClasses:["more"],moreContent:"&#x271a;"},e.prototype.setContent=function(t){return this.title.setContent(t)},i.exports=e},{"../core/Scene":11,"../core/Surface":13,"../core/Transform":14,"../core/View":15}],111:[function(t,i){function e(t){this.options=Object.create(e.DEFAULT_OPTIONS),this.optionsManager=new c(this.options),t&&this.setOptions(t),this.indicator=new o({size:this.options.indicatorSize,classes:["slider-back"]}),this.label=new s({size:this.options.labelSize,content:this.options.label,properties:{pointerEvents:"none"},classes:["slider-label"]}),this.eventOutput=new a,this.eventInput=new a,a.setInputHandler(this,this.eventInput),a.setOutputHandler(this,this.eventOutput);var i=(this.options.range[1]-this.options.range[0])/this.options.indicatorSize[0];this.sync=new l(["mouse","touch"],{scale:i,direction:l.DIRECTION_X}),this.indicator.pipe(this.sync),this.sync.pipe(this),this.eventInput.on("update",function(t){this.set(t.position)}.bind(this)),this._drawPos=0,n.call(this)}function n(){this.label.setContent(this.options.label+'<span style="float: right">'+this.get().toFixed(this.options.precision)+"</span>")}var s=t("../core/Surface"),o=t("../surfaces/CanvasSurface"),r=t("../core/Transform"),a=t("../core/EventHandler"),h=t("../math/Utilities"),c=t("../core/OptionsManager"),p=t("../inputs/MouseSync"),u=t("../inputs/TouchSync"),l=t("../inputs/GenericSync");l.register({mouse:p,touch:u}),e.DEFAULT_OPTIONS={size:[200,60],indicatorSize:[200,30],labelSize:[200,30],range:[0,1],precision:2,value:0,label:"",fillColor:"rgba(170, 170, 170, 1)"},e.prototype.setOptions=function(t){return this.optionsManager.setOptions(t)},e.prototype.get=function(){return this.options.value},e.prototype.set=function(t){t!==this.options.value&&(this.options.value=h.clamp(t,this.options.range),n.call(this),this.eventOutput.emit("change",{value:t}))},e.prototype.getSize=function(){return this.options.size},e.prototype.render=function(){var t=this.options.range,i=Math.floor((this.get()-t[0])/(t[1]-t[0])*this.options.indicatorSize[0]);if(i<this._drawPos)this.indicator.getContext("2d").clearRect(i,0,this._drawPos-i+1,this.options.indicatorSize[1]);else if(i>this._drawPos){var e=this.indicator.getContext("2d");e.fillStyle=this.options.fillColor,e.fillRect(this._drawPos-1,0,i-this._drawPos+1,this.options.indicatorSize[1])}return this._drawPos=i,{size:this.options.size,target:[{origin:[0,0],target:this.indicator.render()},{transform:r.translate(0,0,1),origin:[0,0],target:this.label.render()}]}},i.exports=e},{"../core/EventHandler":6,"../core/OptionsManager":9,"../core/Surface":13,"../core/Transform":14,"../inputs/GenericSync":26,"../inputs/MouseSync":27,"../inputs/TouchSync":32,"../math/Utilities":39,"../surfaces/CanvasSurface":73}],112:[function(t,i){function e(){r.apply(this,arguments),this.layout=new a,this.buttons=[],this._buttonIds={},this._buttonCallbacks={},this.layout.sequenceFrom(this.buttons),this._add(this.layout),this._optionsManager.on("change",n.bind(this))}function n(t){var i=t.id,e=t.value;if("direction"===i)this.layout.setOptions({dimensions:s.call(this.buttons.length,this.options.direction)});else if("buttons"===i)for(var n in this.buttons)this.buttons[n].setOptions(e);else if("sections"===i)for(var o in this.options.sections)this.defineSection(o,this.options.sections[o])}function s(t,i){return i===o.Direction.X?[t,1]:[1,t]}var o=t("../utilities/Utility"),r=t("../core/View"),a=t("../views/GridLayout"),h=t("./ToggleButton");e.prototype=Object.create(r.prototype),e.prototype.constructor=e,e.DEFAULT_OPTIONS={sections:[],widget:h,size:[void 0,50],direction:o.Direction.X,buttons:{toggleMode:h.ON}},e.prototype.defineSection=function(t,i){var e,n=this._buttonIds[t];if(void 0===n){n=this.buttons.length,this._buttonIds[t]=n;var o=this.options.widget;e=new o,this.buttons[n]=e,this.layout.setOptions({dimensions:s(this.buttons.length,this.options.direction)})}else e=this.buttons[n],e.unbind("select",this._buttonCallbacks[t]);this.options.buttons&&e.setOptions(this.options.buttons),e.setOptions(i),this._buttonCallbacks[t]=this.select.bind(this,t),e.on("select",this._buttonCallbacks[t])},e.prototype.select=function(t){var i=this._buttonIds[t];this.buttons[i]&&this.buttons[i].isSelected()?this._eventOutput.emit("select",{id:t}):this.buttons[i]&&this.buttons[i].select();for(var e=0;e<this.buttons.length;e++)e!==i&&this.buttons[e].deselect()},i.exports=e},{"../core/View":15,"../utilities/Utility":94,"../views/GridLayout":101,"./ToggleButton":113}],113:[function(t,i){function e(t){this.options={content:"",offClasses:["off"],onClasses:["on"],size:void 0,outTransition:{curve:"easeInOut",duration:300},inTransition:{curve:"easeInOut",duration:300},toggleMode:e.TOGGLE,crossfade:!0},this._eventOutput=new s,s.setOutputHandler(this,this._eventOutput),this.offSurface=new n,this.offSurface.on("click",function(){this.options.toggleMode!==e.OFF&&this.select()}.bind(this)),this.offSurface.pipe(this._eventOutput),this.onSurface=new n,this.onSurface.on("click",function(){this.options.toggleMode!==e.ON&&this.deselect()}.bind(this)),this.onSurface.pipe(this._eventOutput),this.arbiter=new o({overlap:this.options.crossfade}),this.deselect(),t&&this.setOptions(t)}var n=t("../core/Surface"),s=t("../core/EventHandler"),o=t("../views/RenderController");e.OFF=0,e.ON=1,e.TOGGLE=2,e.prototype.select=function(){this.selected=!0,this.arbiter.show(this.onSurface,this.options.inTransition),this._eventOutput.emit("select")},e.prototype.deselect=function(){this.selected=!1,this.arbiter.show(this.offSurface,this.options.outTransition),this._eventOutput.emit("deselect")},e.prototype.isSelected=function(){return this.selected},e.prototype.setOptions=function(t){void 0!==t.content&&(this.options.content=t.content,this.offSurface.setContent(this.options.content),this.onSurface.setContent(this.options.content)),t.offClasses&&(this.options.offClasses=t.offClasses,this.offSurface.setClasses(this.options.offClasses)),t.onClasses&&(this.options.onClasses=t.onClasses,this.onSurface.setClasses(this.options.onClasses)),void 0!==t.size&&(this.options.size=t.size,this.onSurface.setSize(this.options.size),this.offSurface.setSize(this.options.size)),void 0!==t.toggleMode&&(this.options.toggleMode=t.toggleMode),void 0!==t.outTransition&&(this.options.outTransition=t.outTransition),void 0!==t.inTransition&&(this.options.inTransition=t.inTransition),void 0!==t.crossfade&&(this.options.crossfade=t.crossfade,this.arbiter.setOptions({overlap:this.options.crossfade}))},e.prototype.getSize=function(){return this.options.size},e.prototype.render=function(){return this.arbiter.render()},i.exports=e},{"../core/EventHandler":6,"../core/Surface":13,"../views/RenderController":104}],114:[function(t,i){i.exports={NavigationBar:t("./NavigationBar"),Slider:t("./Slider"),TabBar:t("./TabBar"),ToggleButton:t("./ToggleButton")}},{"./NavigationBar":110,"./Slider":111,"./TabBar":112,"./ToggleButton":113}]},{},[22])(22)});